/* ORYX.Plugins.SelectStencilSetPerspective */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.SelectStencilSetPerspective={facade:void 0,extensions:void 0,perspectives:void 0,construct:function(c){this.facade=c;var d=null;new Ajax.Request("/designer/stencilset/extensions/extensions.json",{method:"GET",asynchronous:!1,onSuccess:function(b){try{var a=b.responseText.evalJSON();this.extensions={};a.extensions.each(function(a){this.extensions[a.namespace]=a}.bind(this));this.perspectives={};a.perspectives.each(function(a){this.perspectives[a.namespace]=a}.bind(this));this.facade.getStencilSets().values().each(function(b){var e=
a.perspectives.findAll(function(a){return a.stencilset==b.namespace()?!0:!1});0<e.size()&&(this.createPerspectivesCombobox(b,e),d=e[0])}.bind(this))}catch(e){ORYX.Log.debug(ORYX.I18N.SSExtensionLoader.failed1),Ext.Msg.alert("Oryx",ORYX.I18N.SSExtensionLoader.failed1)}}.bind(this),onFailure:function(){Ext.Msg.alert("Oryx",ORYX.I18N.SSExtensionLoader.failed2)}.bind(this)});this._updateStencil(d.namespace)},createPerspectivesCombobox:function(c,d){var b=null,a=1<d.length;if(a){var e=[];d.each(function(a){e.push([a.namespace,
a.title,a.description])});b=new Ext.data.SimpleStore({fields:["namespace","title","tooltip"],data:e});b=new Ext.form.ComboBox({store:b,displayField:"title",forceSelection:!0,typeAhead:!0,mode:"local",width:168,triggerAction:"all",emptyText:"",selectOnFocus:!0});b.on("select",this.onSelect,this)}var f={bodyStyle:"background:#eee;font-size:11px;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;",autoScroll:!0,lines:!1,title:ORYX.I18N.View.ChangePerspective};a&&(f.items=[b]);a=new Ext.Panel(f);
this.facade.addToRegion("west",a);a.show();a.doLayout()},onSelect:function(c,d){this._updateStencil(d.json[0])},_updateStencil:function(c){var d={};this.facade.getStencilSets().values().each(function(a){a.changeTitle(this.perspectives[c].title);a.extensions().values().each(function(a){this.extensions[a.namespace]&&(d[a.namespace]=a)}.bind(this))}.bind(this));var b=[];this.perspectives[c].addExtensions&&this.perspectives[c].addExtensions.each(function(a){a.ifIsLoaded?d[a.ifIsLoaded]&&this.extensions[a.add]?
b.push(this.extensions[a.add]):a["default"]&&this.extensions[a["default"]]&&b.push(this.extensions[a["default"]]):b.push(this.extensions[a])}.bind(this));if(this.perspectives[c].removeAllExtensions)this._loadExtensions(b,void 0,!0);else{var a=[];this.perspectives[c].removeExtensions&&this.perspectives[c].removeExtensions.each(function(b){a.push(this.extensions[b])}.bind(this));this._loadExtensions(b,a,!1)}},_loadExtensions:function(c,d,b){var a=this.facade.getStencilSets(),e=!1;a.values().each(function(a){var g=
a.extensions().values().select(function(a){return void 0==c[a.namespace]});b?g.each(function(b){a.removeExtension(b.namespace);e=!0}):g.each(function(b){d.find(function(a){return b.namespace===a.namespace})&&(a.removeExtension(b.namespace),e=!0)})});c.each(function(b){var c=a[b["extends"]];c&&(c.addExtensionFromDefinition("/designer/stencilset/extensions/"+b.definition),e=!0)}.bind(this));if(e){a.values().each(function(a){this.facade.getRules().initializeRules(a)}.bind(this));this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_STENCIL_SET_LOADED});
var f=this.facade.getSelection();this.facade.setSelection();this.facade.setSelection(f)}},_createCookie:function(c,d,b){if(b){var a=new Date;a.setTime(a.getTime()+864E5*b);b="; expires="+a.toGMTString()}else b="";document.cookie=c+"="+d+b+"; path=/"},_readCookie:function(c){for(var c=c+"=",d=document.cookie.split(";"),b=0;b<d.length;b++){for(var a=d[b];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(c))return a.substring(c.length,a.length)}return null}};
ORYX.Plugins.SelectStencilSetPerspective=Clazz.extend(ORYX.Plugins.SelectStencilSetPerspective);
/* ORYX.Plugins.Toolbar */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.Toolbar=Clazz.extend({facade:void 0,plugs:[],construct:function(a,b){this.facade=a;this.groupIndex=new Hash;ORYX.CONFIG.MENU_INDEX?this.groupIndex=ORYX.CONFIG.MENU_INDEX:b.properties.each(function(a){a.group&&void 0!=a.index&&(this.groupIndex[a.group]=a.index)}.bind(this));Ext.QuickTips.init();this.buttons=[];this.facade.registerOnEvent(ORYX.CONFIG.EVENT_BUTTON_UPDATE,this.onButtonUpdate.bind(this));this.facade.registerOnEvent(ORYX.CONFIG.EVENT_STENCIL_SET_LOADED,this.onSelectionChanged.bind(this))},
onButtonUpdate:function(a){var b=this.buttons.find(function(b){return b.id===a.id});void 0!==a.pressed&&b.buttonInstance.toggle(a.pressed)},registryChanged:function(a){a=a.sortBy(function(a){return((void 0!=this.groupIndex[a.group]?this.groupIndex[a.group]:"")+a.group+""+a.index).toLowerCase()}.bind(this));a=$A(a).findAll(function(a){return a.group&&0===a.group.indexOf("footer")?!1:!this.plugs.include(a)}.bind(this));if(!(1>a.length)){this.buttons=[];ORYX.Log.trace("Creating a toolbar.");this.toolbar||
(this.toolbar=new Ext.ux.SlicedToolbar({height:24}),this.facade.addToRegion("north",this.toolbar,"Toolbar"));var b=this.plugs.last()?this.plugs.last().group:a[0].group,d={};a.each(function(a){if(a.name){this.plugs.push(a);b!=a.group&&(this.toolbar.add("-"),b=a.group,d={});var e=a.functionality;a.functionality=function(){"undefined"!=typeof pageTracker&&"function"==typeof pageTracker._trackEvent&&pageTracker._trackEvent("ToolbarButton",a.name);return e.apply(this,arguments)};if(a.dropDownGroupIcon){var f=
d[a.dropDownGroupIcon];void 0===f&&(f=d[a.dropDownGroupIcon]=new Ext.Toolbar.SplitButton({cls:"x-btn-icon",icon:a.dropDownGroupIcon,menu:new Ext.menu.Menu({items:[]}),listeners:{click:function(a){!a.menu.isVisible()&&!a.ignoreNextClick?a.showMenu():a.hideMenu()}}}),this.toolbar.add(f));var c={icon:a.icon,text:a.name,itemId:a.id,handler:a.toggle?void 0:a.functionality,checkHandler:a.toggle?a.functionality:void 0,listeners:{render:function(b){a.description&&new Ext.ToolTip({target:b.getEl(),title:a.description})}}},
c=a.toggle?new Ext.menu.CheckItem(c):new Ext.menu.Item(c);f.menu.add(c)}else c=new Ext.Toolbar.Button({icon:a.icon,cls:"x-btn-icon",itemId:a.id,tooltip:a.description,tooltipType:"title",handler:a.toggle?null:a.functionality,enableToggle:a.toggle,toggleHandler:a.toggle?a.functionality:null}),this.toolbar.add(c),c.getEl().onclick=function(){this.blur()};a.buttonInstance=c;this.buttons.push(a)}}.bind(this));this.enableButtons([]);this.toolbar.calcSlices();window.addEventListener("resize",function(){this.toolbar.calcSlices()}.bind(this),
!1);window.addEventListener("onresize",function(){this.toolbar.calcSlices()}.bind(this),!1)}},onSelectionChanged:function(a){a.elements?this.enableButtons(a.elements):this.enableButtons([])},enableButtons:function(a){this.buttons.each(function(b){b.buttonInstance.enable();b.minShape&&b.minShape>a.length&&b.buttonInstance.disable();b.maxShape&&b.maxShape<a.length&&b.buttonInstance.disable();b.isEnabled&&!b.isEnabled()&&b.buttonInstance.disable()}.bind(this))}});Ext.ns("Ext.ux");
Ext.ux.SlicedToolbar=Ext.extend(Ext.Toolbar,{currentSlice:0,iconStandardWidth:22,seperatorStandardWidth:2,toolbarStandardPadding:2,initComponent:function(){Ext.apply(this,{});Ext.ux.SlicedToolbar.superclass.initComponent.apply(this,arguments)},onRender:function(){Ext.ux.SlicedToolbar.superclass.onRender.apply(this,arguments)},onResize:function(){Ext.ux.SlicedToolbar.superclass.onResize.apply(this,arguments)},calcSlices:function(){var a=0;this.sliceMap={};var b=0,d=this.getEl().getWidth();this.items.getRange().each(function(e){if(e.helperItem)e.destroy();
else{var f=e.getEl().getWidth();if(b+f+5*this.iconStandardWidth>d){var c=this.items.indexOf(e);this.insertSlicingButton("next",a,c);0!==a&&this.insertSlicingButton("prev",a,c);this.insertSlicingSeperator(a,c);a+=1;b=0}this.sliceMap[e.id]=a;b+=f}}.bind(this));if(0<a){this.insertSlicingSeperator(a,this.items.getCount()+1);this.insertSlicingButton("prev",a,this.items.getCount()+1);var g=new Ext.Toolbar.Spacer;this.insertSlicedHelperButton(g,a,this.items.getCount()+1);Ext.get(g.id).setWidth(this.iconStandardWidth)}this.maxSlice=
a;this.setCurrentSlice(this.currentSlice)},insertSlicedButton:function(a,b,d){this.insertButton(d,a);this.sliceMap[a.id]=b},insertSlicedHelperButton:function(a,b,d){a.helperItem=!0;this.insertSlicedButton(a,b,d)},insertSlicingSeperator:function(a,b){this.insertSlicedHelperButton(new Ext.Toolbar.Fill,a,b)},insertSlicingButton:function(a,b,d){var g=function(){this.setCurrentSlice(this.currentSlice+1)}.bind(this),e=function(){this.setCurrentSlice(this.currentSlice-1)}.bind(this);this.insertSlicedHelperButton(new Ext.Toolbar.Button({cls:"x-btn-icon",
icon:ORYX.CONFIG.ROOT_PATH+"images/toolbar_"+a+".png",handler:"next"===a?g:e}),b,d)},setCurrentSlice:function(a){a>this.maxSlice||0>a||(this.currentSlice=a,this.items.getRange().each(function(b){b.setVisible(a===this.sliceMap[b.id])}.bind(this)))}});
/* ORYX.Plugins.UUIDRepositoryDummySave */
ORYX.Plugins||(ORYX.Plugins={});ORYX.Config||(ORYX.Config={});Ext.override(Ext.Button,{setIcon:function(a){this.rendered&&this.getEl().child(this.buttonSelector).setStyle("background-image","url("+a+")")}});Ext.Button.override({setTooltip:function(a){var b=this.getEl().child(this.buttonSelector);Ext.QuickTips.register({target:b.id,text:a})}});
ORYX.Plugins.UUIDRepositorySave=ORYX.Plugins.AbstractPlugin.extend({facade:void 0,construct:function(a){this.facade=a;this.facade.offer({name:ORYX.I18N.Save.save,functionality:this.save.bind(this),group:ORYX.I18N.Save.group,icon:ORYX.PATH+"images/disk.png",description:ORYX.I18N.Save.saveDesc,index:1,minShape:0,maxShape:0});void 0===ORYX.CONFIG.UUID_AUTOSAVE_DEFAULT&&(ORYX.CONFIG.UUID_AUTOSAVE_DEFAULT=!0);autosaveicon=ORYX.PATH+"images/disk_multiple_disabled.png";autosavetip=ORYX.I18N.Save.autosaveDesc_off;
ORYX.CONFIG.UUID_AUTOSAVE_DEFAULT&&(autosaveicon=ORYX.PATH+"images/disk_multiple.png",autosavetip=ORYX.I18N.Save.autosaveDesc_on);autosavecfg={name:ORYX.I18N.Save.autosave,group:ORYX.I18N.Save.group,functionality:function(a){this.setautosave(ORYX.CONFIG.UUID_AUTOSAVE_INTERVAL);this.autosaving?(a.setIcon(ORYX.PATH+"images/disk_multiple.png"),a.setTooltip(ORYX.I18N.Save.autosaveDesc_on)):(a.setIcon(ORYX.PATH+"images/disk_multiple_disabled.png"),a.setTooltip(ORYX.I18N.Save.autosaveDesc_off));a.hide();
a.show()}.bind(this),icon:autosaveicon,description:autosavetip,index:2,minShape:0,maxShape:0};this.facade.offer(autosavecfg);this.changeDifference=0;this.facade.registerOnEvent(ORYX.CONFIG.EVENT_UNDO_EXECUTE,function(){this.changeDifference++});this.facade.registerOnEvent(ORYX.CONFIG.EVENT_EXECUTE_COMMANDS,function(){this.changeDifference++});this.facade.registerOnEvent(ORYX.CONFIG.EVENT_UNDO_ROLLBACK,function(){this.changeDifference--});window.onbeforeunload=function(){if(0<this.changeDifference)return ORYX.I18N.Save.unsavedData}.bind(this);
this.autosaveFunction=function(){this._save(this,!0,!0)}.bind(this,autosavecfg);this.setautosave(ORYX.CONFIG.UUID_AUTOSAVE_INTERVAL)},setautosave:function(a){void 0===this.autosaving&&(this.autosaving=!ORYX.CONFIG.UUID_AUTOSAVE_DEFAULT);(value=!this.autosaving)?this.autosaveInternalId=self.setInterval(this.autosaveFunction,a):self.clearInterval(this.autosaveInternalId);this.autosaving=value},save:function(){this._save(this,!1,!1)},_save:function(a,b,d){this.showSaveStatus(a,b);var c=DataManager.serialize(this.facade.getCanvas().getSVGRepresentation(!0)),
e=Ext.encode(this.facade.getJSON()),f=this.getRDFFromDOM();new Ajax.Request(ORYX.CONFIG.UUID_URL(),{method:"POST",asynchronous:b,postBody:Ext.encode({data:e,svg:c,uuid:ORYX.UUID,rdf:f,profile:ORYX.PROFILE,savetype:d}),onSuccess:function(){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_LOADING_STATUS,text:ORYX.I18N.Save.saved})}.bind(this),onFailure:function(a){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_LOADING_DISABLE});Ext.Msg.alert(ORYX.I18N.Oryx.title,ORYX.I18N.Save.failed);ORYX.log.warn("Saving failed: "+
a.responseText)}.bind(this),on403:function(a){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_LOADING_DISABLE});Ext.Msg.alert(ORYX.I18N.Oryx.title,ORYX.I18N.Save.noRights);ORYX.log.warn("Saving failed (403): "+a.responseText)}.bind(this)});this.hideSaveStatus(a,b);return!0},showSaveStatus:function(a,b){b&&autosavecfg.buttonInstance.setIcon(ORYX.PATH+"images/ajax-loader.gif")},hideSaveStatus:function(a){a&&autosavecfg.buttonInstance.setIcon(ORYX.PATH+"images/disk_multiple.png")}});
ORYX.Plugins.UUIDRepositoryDummySave=ORYX.Plugins.AbstractPlugin.extend({facade:void 0,construct:function(a){this.facade=a;ORYX.CONFIG.UUID_AUTOSAVE_DEFAULT=!1},setautosave:function(){},save:function(){},_save:function(){return!0},showSaveStatus:function(){},hideSaveStatus:function(){}});
window.onOryxResourcesLoaded=function(){var a=ORYX.Utils.getParamFromUrl("stencilset")||ORYX.CONFIG.SSET,b={id:ORYX.UUID,stencilset:{url:a}};void 0!==ORYX.UUID&&new Ajax.Request(ORYX.CONFIG.UUID_URL(),{asynchronous:!1,encoding:"UTF-8",method:"get",onSuccess:function(a){response=a.responseText;if(0!=response.length)try{model=response.evalJSON(),b.model=model}catch(c){ORYX.LOG.error(c)}},onFailure:function(){ORYX.LOG.error("Could not load the model for uuid "+ORYX.UUID)}});a=new ORYX.Editor(b);ORYX.EDITOR=
a};
/* ORYX.Plugins.ShapeMenuPlugin */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.ShapeMenuPlugin={construct:function(a){this.facade=a;this.alignGroups=new Hash;a=this.facade.getCanvas().getHTMLContainer();this.shapeMenu=new ORYX.Plugins.ShapeMenu(a);this.currentShapes=[];this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DRAGDROP_START,this.hideShapeMenu.bind(this));this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DRAGDROP_END,this.showShapeMenu.bind(this));this.facade.registerOnEvent(ORYX.CONFIG.EVENT_RESIZE_START,function(){this.hideShapeMenu();this.hideMorphMenu()}.bind(this));
this.facade.registerOnEvent(ORYX.CONFIG.EVENT_RESIZE_END,this.showShapeMenu.bind(this));a=new Ext.dd.DragZone(a.parentNode,{shadow:!Ext.isMac});a.afterDragDrop=this.afterDragging.bind(this,a);a.beforeDragOver=this.beforeDragOver.bind(this,a);this.createdButtons={};this.facade.registerOnEvent(ORYX.CONFIG.EVENT_STENCIL_SET_LOADED,function(){this.registryChanged()}.bind(this));this.facade.registerOnEvent(ORYX.CONFIG.VOICE_COMMAND_ADD_TASK,this.addNode.bind(this,"Task"));this.facade.registerOnEvent(ORYX.CONFIG.VOICE_COMMAND_ADD_GATEWAY,
this.addNode.bind(this,"Exclusive_Databased_Gateway"));this.facade.registerOnEvent(ORYX.CONFIG.VOICE_COMMAND_ADD_END_EVENT,this.addNode.bind(this,"EndNoneEvent"));this.timer=null;this.resetElements=!0},addNode:function(a){this.newShape({type:"http://b3mn.org/stencilset/bpmn2.0#"+a,namespace:"http://b3mn.org/stencilset/bpmn2.0#",connectingType:!0},void 0)},hideShapeMenu:function(){window.clearTimeout(this.timer);this.timer=null;this.shapeMenu.hide()},showShapeMenu:function(a){!a||this.resetElements?
(window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){this.shapeMenu.closeAllButtons();this.showMorphButton(this.currentShapes);this.showStencilButtons(this.currentShapes);this.shapeMenu.show(this.currentShapes);this.resetElements=!1}.bind(this),300)):(window.clearTimeout(this.timer),this.timer=null,this.shapeMenu.show(this.currentShapes))},registryChanged:function(a){a&&(a=a.each(function(a){a.group=a.group?a.group:"unknown"}),this.pluginsData=a.sortBy(function(a){return a.group+
""+a.index}));this.shapeMenu.removeAllButtons();this.shapeMenu.setNumberOfButtonsPerLevel(ORYX.CONFIG.SHAPEMENU_RIGHT,2);this.createdButtons={};this.createMorphMenu();this.pluginsData||(this.pluginsData=[]);this.baseMorphStencils=this.facade.getRules().baseMorphs();var b=this.facade.getRules().containsMorphingRules();this.facade.getStencilSets().values().each(function(a){a.nodes().each(function(a){if(!a.hidden()){var d={type:a.id(),namespace:a.namespace(),connectingType:!0},b=new ORYX.Plugins.ShapeMenuButton({callback:this.newShape.bind(this,
d),icon:a.icon(),align:ORYX.CONFIG.SHAPEMENU_RIGHT,group:0,msg:a.title()+" - "+ORYX.I18N.ShapeMenuPlugin.clickDrag});this.shapeMenu.addButton(b);this.createdButtons[a.namespace()+a.type()+a.id()]=b;Ext.dd.Registry.register(b.node.lastChild,d)}}.bind(this));a.edges().each(function(a){var d={type:a.id(),namespace:a.namespace()},f=new ORYX.Plugins.ShapeMenuButton({callback:this.newShape.bind(this,d),icon:a.icon(),align:ORYX.CONFIG.SHAPEMENU_RIGHT,group:1,msg:(b?ORYX.I18N.Edge:a.title())+" - "+ORYX.I18N.ShapeMenuPlugin.drag});
this.shapeMenu.addButton(f);this.createdButtons[a.namespace()+a.type()+a.id()]=f;Ext.dd.Registry.register(f.node.lastChild,d)}.bind(this))}.bind(this))},createMorphMenu:function(){this.morphMenu=new Ext.menu.Menu({id:"Oryx_morph_menu",items:[]});this.morphMenu.on("mouseover",function(){this.morphMenuHovered=!0},this);this.morphMenu.on("mouseout",function(){this.morphMenuHovered=!1},this);var a=new ORYX.Plugins.ShapeMenuButton({hovercallback:ORYX.CONFIG.ENABLE_MORPHMENU_BY_HOVER?this.showMorphMenu.bind(this):
void 0,resetcallback:ORYX.CONFIG.ENABLE_MORPHMENU_BY_HOVER?this.hideMorphMenu.bind(this):void 0,callback:ORYX.CONFIG.ENABLE_MORPHMENU_BY_HOVER?void 0:this.toggleMorphMenu.bind(this),icon:ORYX.PATH+"images/wrench_orange.png",align:ORYX.CONFIG.SHAPEMENU_BOTTOM,group:0,msg:ORYX.I18N.ShapeMenuPlugin.morphMsg});this.shapeMenu.setNumberOfButtonsPerLevel(ORYX.CONFIG.SHAPEMENU_BOTTOM,2);this.shapeMenu.addButton(a);this.morphMenu.getEl().appendTo(a.node);this.morphButton=a},showMorphMenu:function(){this.morphMenu.show(this.morphButton.node);
this._morphMenuShown=!0},hideMorphMenu:function(){this.morphMenu.hide();this._morphMenuShown=!1},toggleMorphMenu:function(){this._morphMenuShown?this.hideMorphMenu():this.showMorphMenu()},addDictionaryItem:function(){var a="";(a=this.currentShapes[0].getLabels()[0].text())?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_DICTIONARY_ADD,entry:a}):Ext.Msg.alert("Name not specified.")},editTaskForm:function(){var a=this.currentShapes[0].properties["oryx-taskname"];a&&0<a.length?(a=a.replace(/\&/g,""),
a=a.replace(/\s/g,""),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_TASKFORM_EDIT,tn:a})):Ext.Msg.alert("Task Name not specified.")},viewNodeSource:function(){var a=ORYX.EDITOR.getSerializedJSON();Ext.Ajax.request({url:ORYX.PATH+"uuidRepository",method:"POST",success:function(a){try{var d=(new DOMParser).parseFromString(a.responseText,"text/xml"),g=d.querySelector("[id="+this.currentShapes[0].resourceId+"]");g||(g=d.querySelector("[id="+this.currentShapes[0].properties["oryx-name"]+"]"));if(g){var c=
(new XMLSerializer).serializeToString(g);this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_NODEXML_SHOW,nodesource:c})}else Ext.Msg.alert("Unable to find node source.")}catch(f){Ext.Msg.alert("Converting to BPMN2 Failed :\n"+f)}Ext.Msg.hide()}.bind(this),failure:function(){Ext.Msg.alert("Converting to BPMN2 Failed")}.bind(this),params:{action:"toXML",pp:ORYX.PREPROCESSING,profile:ORYX.PROFILE,data:a}})},onSelectionChanged:function(a){a=a.elements;this.hideShapeMenu();this.hideMorphMenu();this.currentShapes.inspect()!==
a.inspect()?(this.currentShapes=a,this.resetElements=!0,this.showShapeMenu()):this.showShapeMenu(!0)},showDictionaryButton:function(){this.dictionaryButton.prepareToShow()},showTaskFormButton:function(){this.currentShapes&&this.currentShapes[0]&&this.currentShapes[0].properties&&this.currentShapes[0].properties["oryx-tasktype"]&&"User"==this.currentShapes[0].properties["oryx-tasktype"]&&this.taskFormButton.prepareToShow()},showSourceViewButton:function(){this.sourceViewButton.group=0;this.sourceViewButton.prepareToShow()},
showMorphButton:function(a){if(1==a.length){var b=this.facade.getRules().morphStencils({stencil:a[0].getStencil()}),b=b.select(function(d){return"node"===a[0].getStencil().type()?this.facade.getRules().canContain({containingShape:a[0].parent,containedStencil:d}):this.facade.getRules().canConnect({sourceShape:a[0].dockers.first().getDockedShape(),edgeStencil:d,targetShape:a[0].dockers.last().getDockedShape()})}.bind(this));if(!(1>=b.size())){this.morphMenu.removeAll();if(a[0].getStencil().id().endsWith("#Task")){if("User"!=
a[0].properties["oryx-tasktype"]){var d=new Ext.menu.Item({text:ORYX.I18N.Diagram.UserTask,icon:ORYX.CONFIG.ROOT_PATH+"stencilsets/bpmn2.0jbpm/icons/activity/list/type.user.png",disabled:!1,disabledClass:ORYX.CONFIG.MORPHITEM_DISABLED,handler:function(){this.updateTaskType(a[0],"User")}.bind(this)});this.morphMenu.add(d)}"Script"!=a[0].properties["oryx-tasktype"]&&(d=new Ext.menu.Item({text:ORYX.I18N.Diagram.ScriptTask,icon:ORYX.CONFIG.ROOT_PATH+"stencilsets/bpmn2.0jbpm/icons/activity/list/type.script.png",
disabled:!1,disabledClass:ORYX.CONFIG.MORPHITEM_DISABLED,handler:function(){this.updateTaskType(a[0],"Script")}.bind(this)}),this.morphMenu.add(d))}b=b.sortBy(function(a){return a.position()});b.each(function(d){this.morphMenu.add(new Ext.menu.Item({text:d.title(),icon:d.icon(),disabled:d.id()==a[0].getStencil().id(),disabledClass:ORYX.CONFIG.MORPHITEM_DISABLED,handler:function(){this.morphShape(a[0],d)}.bind(this)}))}.bind(this));this.morphButton.prepareToShow()}}},showStencilButtons:function(a){if(1==
a.length){this.facade.getStencilSets();a[0].getStencil().namespace();var b=this.facade.getRules().outgoingEdgeStencils({canvas:this.facade.getCanvas(),sourceShape:a[0]}),d=[],g=[],c=this.facade.getRules().containsMorphingRules();b.each(function(e){if(c)var f=this.baseMorphStencils.include(e)?!0:!this.facade.getRules().morphStencils({stencil:e}).any(function(a){return this.baseMorphStencils.include(a)&&b.include(a)?!0:g.include(a)}.bind(this));if(f||!c)this.createdButtons[e.namespace()+e.type()+e.id()]&&
this.createdButtons[e.namespace()+e.type()+e.id()].prepareToShow(),g.push(e);d=d.concat(this.facade.getRules().targetStencils({canvas:this.facade.getCanvas(),sourceShape:a[0],edgeStencil:e}))}.bind(this));d.uniq();var f=[];d.each(function(a){if(c){if("edge"===a.type()||!this.facade.getRules().showInShapeMenu(a))return;if(!this.baseMorphStencils.include(a)){var b=this.facade.getRules().morphStencils({stencil:a});if(0==b.size()||b.any(function(a){return this.baseMorphStencils.include(a)&&d.include(a)?
!0:f.include(a)}.bind(this)))return}}this.createdButtons[a.namespace()+a.type()+a.id()]&&this.createdButtons[a.namespace()+a.type()+a.id()].prepareToShow();f.push(a)}.bind(this))}},beforeDragOver:function(a,b,d){this.shapeMenu.isVisible&&this.hideShapeMenu();var d=this.facade.eventCoordinates(d.browserEvent),g=this.facade.getCanvas().getAbstractShapesAtPosition(d);if(0>=g.length)return!1;d=g.last();if(this._lastOverElement==d)return!1;b=Ext.dd.Registry.getHandle(b.DDM.currentTarget);if(b.backupOptions){for(key in b.backupOptions)b[key]=
b.backupOptions[key];delete b.backupOptions}var c=this.facade.getStencilSets()[b.namespace].stencil(b.type),g=g.last();if("node"===c.type()){var f=this.facade.getRules().canContain({containingShape:g,containedStencil:c});if(!f)for(var c=this.facade.getRules().morphStencils({stencil:c}),e=0;e<c.size();e++)if(f=this.facade.getRules().canContain({containingShape:g,containedStencil:c[e]})){b.backupOptions=Object.clone(b);b.type=c[e].id();b.namespace=c[e].namespace();break}this._currentReference=f?g:void 0}else{for(var h=
f=g,i=!1;!i&&f&&!(f instanceof ORYX.Core.Canvas);)g=f,i=this.facade.getRules().canConnect({sourceShape:this.currentShapes.first(),edgeStencil:c,targetShape:f}),f=f.parent;if(!i){g=h;c=this.facade.getRules().morphStencils({stencil:c});for(e=0;e<c.size();e++){f=g;for(i=!1;!i&&f&&!(f instanceof ORYX.Core.Canvas);)g=f,i=this.facade.getRules().canConnect({sourceShape:this.currentShapes.first(),edgeStencil:c[e],targetShape:f}),f=f.parent;if(i){b.backupOptions=Object.clone(b);b.type=c[e].id();b.namespace=
c[e].namespace();break}else g=h}}this._currentReference=i?g:void 0}this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"shapeMenu",elements:[g],color:this._currentReference?ORYX.CONFIG.SELECTION_VALID_COLOR:ORYX.CONFIG.SELECTION_INVALID_COLOR});a=a.getProxy();a.setStatus(this._currentReference?a.dropAllowed:a.dropNotAllowed);a.sync();this._lastOverElement=d;return!1},afterDragging:function(a,b,d){if(this.currentShapes instanceof Array&&!(0>=this.currentShapes.length)){var g=
this.currentShapes;this._lastOverElement=void 0;this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"shapeMenu"});a=a.getProxy();if(a.dropStatus==a.dropNotAllowed)return this.facade.updateSelection();if(this._currentReference){b=Ext.dd.Registry.getHandle(b.DDM.currentTarget);b.parent=this._currentReference;var a=d.getXY(),a={x:a[0],y:a[1]},c=this.facade.getCanvas().node.getScreenCTM();a.x-=c.e;a.y-=c.f;a.x/=c.a;a.y/=c.d;a.x-=document.documentElement.scrollLeft;a.y-=document.documentElement.scrollTop;
c=this._currentReference.absoluteXY();a.x-=c.x;a.y-=c.y;d.ctrlKey||(d=this.currentShapes[0].bounds.center(),20>Math.abs(d.x-a.x)&&(a.x=d.x),20>Math.abs(d.y-a.y)&&(a.y=d.y));b.position=a;b.connectedShape=this.currentShapes[0];b.connectingType&&(d={sourceShape:this.currentShapes[0],targetStencil:this.facade.getStencilSets()[b.namespace].stencil(b.type)},b.connectingType=this.facade.getRules().connectMorph(d).id());!0===ORYX.CONFIG.SHAPEMENU_DISABLE_CONNECTED_EDGE&&delete b.connectingType;this.facade.executeCommands([new ORYX.Plugins.ShapeMenuPlugin.CreateCommand(Object.clone(b),
this._currentReference,a,this)]);this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_SHAPE_MENU_CLOSE,source:g,destination:this.currentShapes});if(b.backupOptions){for(key in b.backupOptions)b[key]=b.backupOptions[key];delete b.backupOptions}this._currentReference=void 0}}},newShape:function(a){var b=this.facade.getStencilSets()[a.namespace].stencil(a.type);if(this.facade.getRules().canContain({containingShape:this.currentShapes.first().parent,containedStencil:b})&&(a.connectedShape=this.currentShapes[0],
a.parent=this.currentShapes.first().parent,a.containedStencil=b,b={sourceShape:this.currentShapes[0],targetStencil:b},b=this.facade.getRules().connectMorph(b)))a.connectingType=b.id(),!0===ORYX.CONFIG.SHAPEMENU_DISABLE_CONNECTED_EDGE&&delete a.connectingType,this.facade.executeCommands([new ORYX.Plugins.ShapeMenuPlugin.CreateCommand(a,void 0,void 0,this)])},updateTaskType:function(a,b){a&&b&&(a.setProperty("oryx-tasktype",b),a.refresh())},morphShape:function(a,b){this.facade.executeCommands([new (ORYX.Core.Command.extend({construct:function(a,
b,c){this.shape=a;this.stencil=b;this.facade=c},execute:function(){var a=this.shape,b=this.stencil,c=a.resourceId,f=a.serialize();b.properties().each(function(a){a.readonly()&&(f=f.reject(function(b){return"oryx"===b.prefix&&("type"===b.name||"tasktype"===b.name)?!0:b.name==a.id()}))}.bind(this));this.newShape?(newShape=this.newShape,this.facade.getCanvas().add(newShape)):newShape=this.facade.createShape({type:b.id(),namespace:b.namespace(),resourceId:c});c=f.find(function(a){return"oryx"===a.prefix&&
"bounds"===a.name});b=null;if(this.facade.getRules().preserveBounds(a.getStencil()))b=a.bounds.height(),c=a.bounds.width(),newShape.minimumSize&&(a.bounds.height()<newShape.minimumSize.height&&(b=newShape.minimumSize.height),a.bounds.width()<newShape.minimumSize.width&&(c=newShape.minimumSize.width)),newShape.maximumSize&&(a.bounds.height()>newShape.maximumSize.height&&(b=newShape.maximumSize.height),a.bounds.width()>newShape.maximumSize.width&&(c=newShape.maximumSize.width)),b={a:{x:a.bounds.a.x,
y:a.bounds.a.y},b:{x:a.bounds.a.x+c,y:a.bounds.a.y+b}};else{var e=c.value.split(",");if(parseInt(e[0],10)>parseInt(e[2],10)){var h=e[0];e[0]=e[2];e[2]=h;h=e[1];e[1]=e[3];e[3]=h}e[2]=parseInt(e[0],10)+newShape.bounds.width();e[3]=parseInt(e[1],10)+newShape.bounds.height();c.value=e.join(",")}c=a.bounds.center();null!==b&&newShape.bounds.set(b);this.setRelatedDockers(a,newShape);e=a.node.parentNode;h=a.node.nextSibling;this.facade.deleteShape(a);newShape.deserialize(f);a.getStencil().property("oryx-bgcolor")&&
a.properties["oryx-bgcolor"]&&a.getStencil().property("oryx-bgcolor").value().toUpperCase()==a.properties["oryx-bgcolor"].toUpperCase()&&newShape.getStencil().property("oryx-bgcolor")&&newShape.setProperty("oryx-bgcolor",newShape.getStencil().property("oryx-bgcolor").value());null!==b&&newShape.bounds.set(b);("edge"===newShape.getStencil().type()||0==newShape.dockers.length||!newShape.dockers[0].getDockedShape())&&newShape.bounds.centerMoveTo(c);"node"===newShape.getStencil().type()&&(0==newShape.dockers.length||
!newShape.dockers[0].getDockedShape())&&this.setRelatedDockers(newShape,newShape);h?e.insertBefore(newShape.node,h):e.appendChild(newShape.node);this.facade.setSelection([newShape]);this.facade.getCanvas().update();this.facade.updateSelection();this.newShape=newShape},rollback:function(){this.shape&&this.newShape&&this.newShape.parent&&(this.newShape.parent.add(this.shape),this.setRelatedDockers(this.newShape,this.shape),this.facade.deleteShape(this.newShape),this.facade.setSelection([this.shape]),
this.facade.getCanvas().update(),this.facade.updateSelection())},setRelatedDockers:function(a,b){"node"===a.getStencil().type()?((a.incoming||[]).concat(a.outgoing||[]).each(function(c){c.dockers.each(function(f){if(f.getDockedShape()==a){var e=Object.clone(f.referencePoint),e={x:e.x*b.bounds.width()/a.bounds.width(),y:e.y*b.bounds.height()/a.bounds.height()};f.setDockedShape(b);f.setReferencePoint(e);if(c instanceof ORYX.Core.Edge)f.bounds.centerMoveTo(e);else{var h=a.absoluteXY();f.bounds.centerMoveTo({x:e.x+
h.x,y:e.y+h.y})}}})}),0<a.dockers.length&&a.dockers.first().getDockedShape()&&(b.dockers.first().setDockedShape(a.dockers.first().getDockedShape()),b.dockers.first().setReferencePoint(Object.clone(a.dockers.first().referencePoint)))):(b.dockers.first().setDockedShape(a.dockers.first().getDockedShape()),b.dockers.first().setReferencePoint(a.dockers.first().referencePoint),b.dockers.last().setDockedShape(a.dockers.last().getDockedShape()),b.dockers.last().setReferencePoint(a.dockers.last().referencePoint))}}))(a,
b,this.facade)])}};ORYX.Plugins.ShapeMenuPlugin=ORYX.Plugins.AbstractPlugin.extend(ORYX.Plugins.ShapeMenuPlugin);
ORYX.Plugins.ShapeMenu={construct:function(a){this.shapes=this.bounds=void 0;this.buttons=[];this.isVisible=!1;this.node=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",$(a),["div",{id:ORYX.Editor.provideId(),"class":"Oryx_ShapeMenu"}]);this.alignContainers=new Hash;this.numberOfButtonsPerLevel=new Hash},addButton:function(a){this.buttons.push(a);this.alignContainers[a.align]||(this.alignContainers[a.align]=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",this.node,["div",{"class":a.align}]),this.node.appendChild(this.alignContainers[a.align]),
this.alignContainers[a.align].addEventListener(ORYX.CONFIG.EVENT_MOUSEOVER,this.hoverAlignContainer.bind(this,a.align),!1),this.alignContainers[a.align].addEventListener(ORYX.CONFIG.EVENT_MOUSEOUT,this.resetAlignContainer.bind(this,a.align),!1),this.alignContainers[a.align].addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.hoverAlignContainer.bind(this,a.align),!1));this.alignContainers[a.align].appendChild(a.node)},deleteButton:function(a){this.buttons=this.buttons.without(a);this.node.removeChild(a.node)},
removeAllButtons:function(){this.buttons.each(function(a){a.node&&a.node.parentNode&&a.node.parentNode.removeChild(a.node)});this.buttons=[]},closeAllButtons:function(){this.buttons.each(function(a){a.prepareToHide()});this.isVisible=!1},show:function(a){if(!(0>=a.length)){this.shapes=a;var b=void 0,d=void 0;this.shapes.each(function(a){var c=a.node.getScreenCTM(),e=a.absoluteXY();c.e=c.a*e.x;c.f=c.d*e.y;d=new ORYX.Core.Bounds(c.e,c.f,c.e+c.a*a.bounds.width(),c.f+c.d*a.bounds.height());b?b.include(d):
b=d});var g=this.bounds=b,c=this.bounds.upperLeft(),f=0,e=0,h=0,i=0,k=0,m,l=0;rightButtonGroup=0;this.getWillShowButtons().sortBy(function(a){return a.group});this.getWillShowButtons().each(function(a){var b=this.getNumberOfButtonsPerLevel(a.align);if(a.align==ORYX.CONFIG.SHAPEMENU_LEFT){a.group!=e&&(f=0,e=a.group);var d=Math.floor(f/b),j=f%b;a.setLevel(d);a.setPosition(c.x-5-22*(d+1),c.y+22*b*a.group+6.6*a.group+22*j);f++}else a.align==ORYX.CONFIG.SHAPEMENU_TOP?(a.group!=i&&(h=0,i=a.group),d=h%b,
j=Math.floor(h/b),a.setLevel(j),a.setPosition(c.x+22*b*a.group+6.6*a.group+22*d,c.y-5-22*(j+1)),h++):a.align==ORYX.CONFIG.SHAPEMENU_BOTTOM?(a.group!=m&&(k=0,m=a.group),d=k%b,j=Math.floor(k/b),a.setLevel(j),a.setPosition(c.x+22*b*a.group+6.6*a.group+22*d,c.y+g.height()+5+22*j),k++):(a.group!=rightButtonGroup&&(l=0,rightButtonGroup=a.group),d=Math.floor(l/b),j=l%b,a.setLevel(d),a.setPosition(c.x+g.width()+5+22*d,c.y+22*b*a.group+6.6*a.group+22*j-5),l++);a.show()}.bind(this));this.isVisible=!0}},hide:function(){this.buttons.each(function(a){a.hide()});
this.isVisible=!1},hoverAlignContainer:function(a){this.buttons.each(function(b){b.align==a&&b.showOpaque()})},resetAlignContainer:function(a){this.buttons.each(function(b){b.align==a&&b.showTransparent()})},isHover:function(){return this.buttons.any(function(a){return a.isHover()})},getWillShowButtons:function(){return this.buttons.findAll(function(a){return a.willShow})},getButtons:function(a,b){return this.getWillShowButtons().findAll(function(d){return d.align==a&&(void 0===b||d.group==b)})},
setNumberOfButtonsPerLevel:function(a,b){this.numberOfButtonsPerLevel[a]=b},getNumberOfButtonsPerLevel:function(a){return this.numberOfButtonsPerLevel[a]?Math.min(this.getButtons(a,0).length,this.numberOfButtonsPerLevel[a]):1}};ORYX.Plugins.ShapeMenu=Clazz.extend(ORYX.Plugins.ShapeMenu);
ORYX.Plugins.ShapeMenuButton={construct:function(a){a&&(this.option=a,this.option.arguments||(this.option.arguments=[]));this.parentId=this.option.id?this.option.id:null;a=this.option.caption?"Oryx_button_with_caption":"Oryx_button";this.node=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",$(this.parentId),["div",{"class":a}]);a={src:this.option.icon};this.option.msg&&(a.title=this.option.msg);this.option.icon&&ORYX.Editor.graft("http://www.w3.org/1999/xhtml",this.node,["img",a]);this.option.caption&&
(a=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",this.node,["span"]),ORYX.Editor.graft("http://www.w3.org/1999/xhtml",a,this.option.caption));this.node.addEventListener(ORYX.CONFIG.EVENT_MOUSEOVER,this.hover.bind(this),!1);this.node.addEventListener(ORYX.CONFIG.EVENT_MOUSEOUT,this.reset.bind(this),!1);this.node.addEventListener(ORYX.CONFIG.EVENT_MOUSEDOWN,this.activate.bind(this),!1);this.node.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.hover.bind(this),!1);this.node.addEventListener("click",
this.trigger.bind(this),!1);this.node.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.move.bind(this),!1);this.align=this.option.align?this.option.align:ORYX.CONFIG.SHAPEMENU_RIGHT;this.group=this.option.group?this.option.group:0;this.hide();this.willShow=this.isVisible=this.dragStart=!1;this.resetTimer},hide:function(){this.node.style.display="none";this.isVisible=!1},show:function(){this.node.style.display="";this.node.style.opacity=this.opacity;this.isVisible=!0},showOpaque:function(){this.node.style.opacity=
1},showTransparent:function(){this.node.style.opacity=this.opacity},prepareToShow:function(){this.willShow=!0},prepareToHide:function(){this.willShow=!1;this.hide()},setPosition:function(a,b){this.node.style.left=a+"px";this.node.style.top=b+"px"},setLevel:function(a){this.opacity=0==a?0.5:1==a?0.2:0},setChildWidth:function(a){this.childNode.style.width=a+"px"},reset:function(a){window.clearTimeout(this.resetTimer);this.resetTimer=window.setTimeout(this.doReset.bind(this),100);this.option.resetcallback&&
(this.option.arguments.push(a),this.option.resetcallback.apply(this,this.option.arguments),this.option.arguments.remove(a))},doReset:function(){this.node.hasClassName("Oryx_down")&&this.node.removeClassName("Oryx_down");this.node.hasClassName("Oryx_hover")&&this.node.removeClassName("Oryx_hover")},activate:function(){this.node.addClassName("Oryx_down");this.dragStart=!0},isHover:function(){return this.node.hasClassName("Oryx_hover")?!0:!1},hover:function(a){window.clearTimeout(this.resetTimer);this.resetTimer=
null;this.node.addClassName("Oryx_hover");this.dragStart=!1;this.option.hovercallback&&(this.option.arguments.push(a),this.option.hovercallback.apply(this,this.option.arguments),this.option.arguments.remove(a))},move:function(a){this.dragStart&&this.option.dragcallback&&(this.option.arguments.push(a),this.option.dragcallback.apply(this,this.option.arguments),this.option.arguments.remove(a))},trigger:function(a){this.option.callback&&(this.option.arguments.push(a),this.option.callback.apply(this,this.option.arguments),
this.option.arguments.remove(a));this.dragStart=!1},toString:function(){return"HTML-Button "+this.id}};ORYX.Plugins.ShapeMenuButton=Clazz.extend(ORYX.Plugins.ShapeMenuButton);
ORYX.Plugins.ShapeMenuPlugin.CreateCommand=ORYX.Core.Command.extend({construct:function(a,b,d,g){this.option=a;this.currentReference=b;this.position=d;this.plugin=g;this.shape;this.edge;this.targetRefPos;this.sourceRefPos;this.connectedShape=a.connectedShape;this.connectingType=a.connectingType;this.namespace=a.namespace;this.type=a.type;this.containedStencil=a.containedStencil;this.parent=a.parent;this.currentReference=b;this.shapeOptions=a.shapeOptions},execute:function(){var a=!1;this.shape?(this.shape instanceof
ORYX.Core.Node?(this.parent.add(this.shape),this.edge&&(this.plugin.facade.getCanvas().add(this.edge),this.edge.dockers.first().setDockedShape(this.connectedShape),this.edge.dockers.first().setReferencePoint(this.sourceRefPos),this.edge.dockers.last().setDockedShape(this.shape),this.edge.dockers.last().setReferencePoint(this.targetRefPos)),this.plugin.facade.setSelection([this.shape])):this.shape instanceof ORYX.Core.Edge&&(this.plugin.facade.getCanvas().add(this.shape),this.shape.dockers.first().setDockedShape(this.connectedShape),
this.shape.dockers.first().setReferencePoint(this.sourceRefPos)),a=!0):(this.shape=this.plugin.facade.createShape(this.option),this.edge=!(this.shape instanceof ORYX.Core.Edge)?this.shape.getIncomingShapes().first():void 0);if(this.currentReference&&this.position)this.shape instanceof ORYX.Core.Edge?(this.currentReference instanceof ORYX.Core.Canvas?this.shape.dockers.last().bounds.centerMoveTo(this.position):(this.shape.dockers.last().setDockedShape(this.currentReference),this.currentReference.absoluteXY(),
this.shape.dockers.last().setReferencePoint(this.currentReference.bounds.midPoint())),this.sourceRefPos=this.shape.dockers.first().referencePoint,this.targetRefPos=this.shape.dockers.last().referencePoint):this.edge&&(this.sourceRefPos=this.edge.dockers.first().referencePoint,this.targetRefPos=this.edge.dockers.last().referencePoint);else{var b=this.containedStencil,d=this.connectedShape.bounds,g=this.shape.bounds,c=d.center();"north"===b.defaultAlign()?c.y-=d.height()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET+
g.height()/2:"northeast"===b.defaultAlign()?(c.x+=d.width()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER+g.width()/2,c.y-=d.height()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER+g.height()/2):"southeast"===b.defaultAlign()?(c.x+=d.width()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER+g.width()/2,c.y+=d.height()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER+g.height()/2):"south"===b.defaultAlign()?c.y+=d.height()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET+g.height()/2:"southwest"===b.defaultAlign()?(c.x-=
d.width()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER+g.width()/2,c.y+=d.height()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER+g.height()/2):"west"===b.defaultAlign()?c.x-=d.width()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET+g.width()/2:"northwest"===b.defaultAlign()?(c.x-=d.width()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER+g.width()/2,c.y-=d.height()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER+g.height()/2):c.x+=d.width()/2+ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET+g.width()/2;this.shape.bounds.centerMoveTo(c);
this.shape instanceof ORYX.Core.Node&&(this.shape.dockers||[]).each(function(a){a.bounds.centerMoveTo(c)});this.position=c;this.edge&&(this.sourceRefPos=this.edge.dockers.first().referencePoint,this.targetRefPos=this.edge.dockers.last().referencePoint)}this.plugin.facade.getCanvas().update();this.plugin.facade.updateSelection();a||(this.edge?this.plugin.doLayout(this.edge):this.shape instanceof ORYX.Core.Edge&&this.plugin.doLayout(this.shape))},rollback:function(){this.plugin.facade.deleteShape(this.shape);
this.edge&&this.plugin.facade.deleteShape(this.edge);this.plugin.facade.setSelection(this.plugin.facade.getSelection().without(this.shape,this.edge))}});
/* ORYX.Plugins.ShapeRepository */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.ShapeRepository={facade:void 0,construct:function(a){this.facade=a;this._currentParent;this._canAttach=this._canContain=void 0;this._patternData;this._processInfoPanel;this.shapeList=new Ext.tree.TreeNode({});a=new Ext.tree.TreePanel({cls:"shaperepository",loader:new Ext.tree.TreeLoader,root:this.shapeList,autoScroll:!0,rootVisible:!1,lines:!1,anchors:"0, -30"});new Ext.tree.TreeSorter(a,{folderSort:!0,dir:"asc",sortType:function(b){return b.text}});this.facade.addToRegion("west",a,ORYX.I18N.ShapeRepository.title);
this.loadProcessInfo();Ext.Ajax.request({url:ORYX.PATH+"stencilpatterns",method:"POST",success:function(b){try{this._patternData=Ext.decode(b.responseText)}catch(a){ORYX.Log.error("Failed to retrieve Stencil Patterns Data :\n"+a)}}.createDelegate(this),failure:function(){ORYX.Log.error("Failed to retrieve Stencil Patterns Data")},params:{profile:ORYX.PROFILE,uuid:ORYX.UUID}});a=new Ext.dd.DragZone(this.shapeList.getUI().getEl(),{shadow:!Ext.isMac});a.afterDragDrop=this.drop.bind(this,a);a.beforeDragOver=
this.beforeDragOver.bind(this,a);a.beforeDragEnter=function(){this._lastOverElement=!1;return!0}.bind(this);this.setStencilSets();this.facade.registerOnEvent(ORYX.CONFIG.EVENT_STENCIL_SET_LOADED,this.setStencilSets.bind(this))},loadProcessInfo:function(){this._processInfoPanel||(this._processInfoPanel=new Ext.Panel({bodyStyle:"background:#eee;font-size:12px;padding:3px;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;",autoScroll:!0,lines:!1,html:"",title:ORYX.I18N.View.ProcessInformation}),
this.facade.addToRegion("west",this._processInfoPanel));this._processInfoPanel.load({url:ORYX.PATH+"processinfo",method:"POST",params:{profile:ORYX.PROFILE,uuid:ORYX.UUID},text:""})},setStencilSets:function(){for(var a=this.shapeList.firstChild;a;)this.shapeList.removeChild(a),a=this.shapeList.firstChild;this.facade.getStencilSets().values().each(function(b){var a,c=b.title();b.extensions();this.shapeList.appendChild(a=new Ext.tree.TreeNode({text:c,allowDrag:!1,allowDrop:!1,iconCls:"headerShapeRepImg",
cls:"headerShapeRep",singleClickExpand:!0}));a.render();a.expand();var g=b.stencils(this.facade.getCanvas().getStencil(),this.facade.getRules()),f=new Hash,g=g.sortBy(function(a){return a.position()});g.each(function(c){if(g.length<=ORYX.CONFIG.MAX_NUM_SHAPES_NO_GROUP){var e=ORYX.CONFIG.STENCIL_GROUP_ORDER();e[b.namespace()]?a.sort(function(a,c){e[b.namespace()][a.text]||(e[b.namespace()][a.text]=ORYX.CONFIG.STENCIL_MAX_ORDER);e[b.namespace()][c.text]||(e[b.namespace()][c.text]=ORYX.CONFIG.STENCIL_MAX_ORDER);
return e[b.namespace()][a.text]-e[b.namespace()][c.text]}):a.sort(function(a,b){return a.text>b.text?1:a.text<b.text?-1:0});this.createStencilTreeNode(a,c)}else c.hidden()||(c.groups().each(function(b){f[b]||(f[b]=new Ext.tree.TreeNode({text:b,allowDrag:!1,allowDrop:!1,iconCls:"headerShapeRepImg",cls:"headerShapeRepChild",singleClickExpand:!0}),a.appendChild(f[b]),f[b].render());this.createStencilTreeNode(f[b],c)}.bind(this)),e=ORYX.CONFIG.STENCIL_GROUP_ORDER(),e[b.namespace()]?a.sort(function(a,
c){return e[b.namespace()][a.text]-e[b.namespace()][c.text]}):a.sort(function(a,b){return a.text>b.text?1:a.text<b.text?-1:0}))}.bind(this))}.bind(this))},createStencilTreeNode:function(a,b){var d=new Ext.tree.TreeNode({text:b.title(),icon:decodeURIComponent(b.icon()),allowDrag:!1,allowDrop:!1,iconCls:"ShapeRepEntreeImg",cls:"ShapeRepEntree"});a.appendChild(d);d.render();d=d.getUI();d.elNode.setAttributeNS(null,"title",b.description());Ext.dd.Registry.register(d.elNode,{node:d.node,handles:[d.elNode,
d.textNode].concat($A(d.elNode.childNodes)),isHandle:!1,type:b.id(),namespace:b.namespace()})},drop:function(a,b,d){this._lastOverElement=void 0;this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"shapeRepo.added"});this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"shapeRepo.attached"});a=a.getProxy();if(a.dropStatus!=a.dropNotAllowed&&this._currentParent){var c=Ext.dd.Registry.getHandle(b.DDM.currentTarget),b=d.getXY(),b={x:b[0],y:b[1]},a=this.facade.getCanvas().node.getScreenCTM();
b.x-=a.e;b.y-=a.f;b.x/=a.a;b.y/=a.d;b.x-=document.documentElement.scrollLeft;b.y-=document.documentElement.scrollTop;a=this._currentParent.absoluteXY();b.x-=a.x;b.y-=a.y;c.position=b;c.parent=this._canAttach&&this._currentParent instanceof ORYX.Core.Node?void 0:this._currentParent;b=ORYX.Core.Command.extend({construct:function(a,b,c,d,h){this.option=a;this.currentParent=b;this.canAttach=c;this.position=d;this.facade=h;this.selection=this.facade.getSelection();this.shape;this.parent},execute:function(){this.shape?
this.parent.add(this.shape):(this.shape=this.facade.createShape(c),this.parent=this.shape.parent);if(this.canAttach&&this.currentParent instanceof ORYX.Core.Node&&0<this.shape.dockers.length){var a=this.shape.dockers[0];this.currentParent.parent instanceof ORYX.Core.Node&&this.currentParent.parent.add(a.parent);a.bounds.centerMoveTo(this.position);a.setDockedShape(this.currentParent)}this.facade.setSelection([this.shape]);this.facade.getCanvas().update();this.facade.updateSelection();this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_DROP_SHAPE,
shape:this.shape})},rollback:function(){this.facade.deleteShape(this.shape);this.facade.setSelection(this.selection.without(this.shape));this.facade.getCanvas().update();this.facade.updateSelection()}});d=this.facade.eventCoordinates(d.browserEvent);a=c.type.split("#");a[1].startsWith("wp-")?this.facade.raiseEvent({type:ORYX.CONFIG.CREATE_PATTERN,pid:a[1],pdata:this._patternData,pos:d}):this.facade.executeCommands([new b(c,this._currentParent,this._canAttach,d,this.facade)]);this._currentParent=void 0}},
beforeDragOver:function(a,b,d){var d=this.facade.eventCoordinates(d.browserEvent),c=this.facade.getCanvas().getAbstractShapesAtPosition(d);if(0>=c.length)return a=a.getProxy(),a.setStatus(a.dropNotAllowed),a.sync(),!1;c.last();if(!(1==c.lenght&&c[0]instanceof ORYX.Core.Canvas))if(b=Ext.dd.Registry.getHandle(b.DDM.currentTarget),b=this.facade.getStencilSets()[b.namespace].stencil(b.type),"node"===b.type()){if(c=c.reverse().find(function(a){return a instanceof ORYX.Core.Canvas||a instanceof ORYX.Core.Node||
a instanceof ORYX.Core.Edge}),c!==this._lastOverElement&&(this._canContain=this._canAttach=void 0),c){if(!(c instanceof ORYX.Core.Canvas)&&c.isPointOverOffset(d.x,d.y)&&void 0==this._canAttach&&(this._canAttach=this.facade.getRules().canConnect({sourceShape:c,edgeStencil:b,targetStencil:b})))this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"shapeRepo.attached",elements:[c],style:ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_RECTANGLE,color:ORYX.CONFIG.SELECTION_VALID_COLOR}),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,
highlightId:"shapeRepo.added"}),this._canContain=void 0;!(c instanceof ORYX.Core.Canvas)&&!c.isPointOverOffset(d.x,d.y)&&(this._canAttach=!1==this._canAttach?this._canAttach:void 0);void 0==this._canContain&&!this._canAttach&&(this._canContain=this.facade.getRules().canContain({containingShape:c,containedStencil:b}),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"shapeRepo.added",elements:[c],color:this._canContain?ORYX.CONFIG.SELECTION_VALID_COLOR:ORYX.CONFIG.SELECTION_INVALID_COLOR}),
this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"shapeRepo.attached"}));this._currentParent=this._canContain||this._canAttach?c:void 0;this._lastOverElement=c;a=a.getProxy();a.setStatus(this._currentParent?a.dropAllowed:a.dropNotAllowed);a.sync()}}else this._currentParent=this.facade.getCanvas(),a=a.getProxy(),a.setStatus(a.dropAllowed),a.sync();return!1}};ORYX.Plugins.ShapeRepository=Clazz.extend(ORYX.Plugins.ShapeRepository);
/* ORYX.Plugins.PropertyWindow */
ORYX.Plugins||(ORYX.Plugins={});ORYX.FieldEditors||(ORYX.FieldEditors={});ORYX.AssociationEditors||(ORYX.AssociationEditors={});ORYX.LabelProviders||(ORYX.LabelProviders={});
ORYX.Plugins.PropertyWindow={facade:void 0,construct:function(c){this.facade=c;this.facade.registerOnEvent(ORYX.CONFIG.EVENT_SHOW_PROPERTYWINDOW,this.init.bind(this));this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADED,this.onSelectionChanged.bind(this));this.init()},init:function(){this.node=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",null,["div"]);this.currentDateFormat;this.popularProperties=[];this.simulationProperties=[];this.properties=[];this.shapeSelection=new Hash;this.shapeSelection.shapes=
[];this.shapeSelection.commonProperties=[];this.shapeSelection.commonPropertiesValues=new Hash;this.updaterFlag=!1;this.columnModel=new Ext.grid.ColumnModel([{header:ORYX.I18N.PropertyWindow.name,dataIndex:"name",width:100,sortable:!0,renderer:this.tooltipRenderer.bind(this)},{header:ORYX.I18N.PropertyWindow.value,dataIndex:"value",id:"propertywindow_column_value",width:200,editor:new Ext.form.TextField({allowBlank:!0}),renderer:this.renderer.bind(this)},{header:"Desk",dataIndex:"groupname",hidden:!0,
sortable:!0}]);this.dataSource=new Ext.data.GroupingStore({proxy:new Ext.data.MemoryProxy(this.properties),reader:new Ext.data.ArrayReader({},[{name:"groupname"},{name:"name"},{name:"value"},{name:"icons"},{name:"gridProperties"},{name:"order"}]),sortInfo:{field:"order",direction:"ASC"},groupField:"groupname"});this.dataSource.load();this.grid=new Ext.grid.EditorGridPanel({autoScroll:!0,autoHeight:!0,clicksToEdit:1,stripeRows:!0,autoExpandColumn:"propertywindow_column_value",width:"auto",colModel:this.columnModel,
enableHdMenu:!1,view:new Ext.grid.GroupingView({forceFit:!0,groupTextTpl:"{[values.rs.first().data.groupname]}"}),store:this.dataSource});region=this.facade.addToRegion("east",new Ext.Panel({width:320,layout:"anchor",autoScroll:!0,autoHeight:!0,border:!1,items:[this.grid],anchors:"0, -30"}),ORYX.I18N.PropertyWindow.title);this.grid.on("beforeedit",this.beforeEdit,this,!0);this.grid.on("afteredit",this.afterEdit,this,!0);this.grid.enableColumnMove=!1},selectDiagram:function(){this.shapeSelection.shapes=
[this.facade.getCanvas()];this.setPropertyWindowTitle();this.identifyCommonProperties();this.createProperties()},specialKeyDown:function(c,b){if(c instanceof Ext.form.TextArea&&b.button==ORYX.CONFIG.KEY_Code_enter)return!1},htmlEncodeKeepLF:function(c){return!c?c:(""+c).replace(/&(?!#10;)/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},tooltipRenderer:function(c,b,d){var a,f=d.data.gridProperties;if("propertywindow_column_value"==b.id){if((f=f.editor)&&f.valueTooltip)f=
f.valueTooltip,"function"==typeof f?a=f():"string"==typeof f&&(a=f);a||(a=d.get("value"))}else a=f.tooltip;a&&(a=this.htmlEncodeKeepLF(a),b.cellAttr='title="'+a+'"');return c},renderer:function(c,b,d){this.tooltipRenderer(c,b,d);if(d.data.gridProperties.labelProvider)return d.data.gridProperties.labelProvider(c);c instanceof Date?c=c.dateFormat(ORYX.I18N.PropertyWindow.dateFormat):0>(""+c).search("<a href='")&&(c=(""+c).gsub("<","&lt;"),c=(""+c).gsub(">","&gt;"),c=(""+c).gsub("%","&#37;"),c=(""+c).gsub("&",
"&amp;"),d.data.gridProperties.type==ORYX.CONFIG.TYPE_COLOR&&(c="<div class='prop-background-color' style='background-color:"+c+"' />"),d.data.icons.each(function(a){a.name==c&&a.icon&&(c="<img src='"+a.icon+"' /> "+c)}));return c},beforeEdit:function(c){var b=this.dataSource.getAt(c.row).data.gridProperties.editor;if(b)this.facade.disableEvent(ORYX.CONFIG.EVENT_KEYDOWN),c.grid.getColumnModel().setEditor(1,b),b.field.row=c.row,b.render(this.grid),b.setSize(c.grid.getColumnModel().getColumnWidth(1),
b.height);else return!1;var d=this.dataSource.getAt(c.row).data.gridProperties.propId;this.oldValues=new Hash;this.shapeSelection.shapes.each(function(a){this.oldValues[a.getId()]=a.properties[d]}.bind(this))},afterEdit:function(c){c.grid.getStore().commitChanges();var b=c.record.data.gridProperties.propId,d=this.shapeSelection.shapes,a=this.oldValues,f=c.value,g=this.facade;this.facade.executeCommands([new (ORYX.Core.Command.extend({construct:function(){this.key=b;this.selectedElements=d;this.oldValues=
a;this.newValue=f;this.facade=g},execute:function(){this.selectedElements.each(function(a){a.getStencil().property(this.key).readonly()||a.setProperty(this.key,this.newValue)}.bind(this));this.facade.setSelection(this.selectedElements);this.facade.getCanvas().update();this.facade.updateSelection()},rollback:function(){this.selectedElements.each(function(a){a.setProperty(this.key,this.oldValues[a.getId()])}.bind(this));this.facade.setSelection(this.selectedElements);this.facade.getCanvas().update();
this.facade.updateSelection()}}))]);this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_PROPWINDOW_PROP_CHANGED,elements:d,key:b,value:c.value})},editDirectly:function(c,b){this.shapeSelection.shapes.each(function(d){d.getStencil().property(c).readonly()||d.setProperty(c,b)}.bind(this));this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_PROPWINDOW_PROP_CHANGED,elements:this.shapeSelection.shapes,key:c,value:b});this.facade.getCanvas().update()},updateAfterInvalid:function(c){this.shapeSelection.shapes.each(function(b){b.getStencil().property(c).readonly()||
(b.setProperty(c,this.oldValues[b.getId()]),b.update())}.bind(this));this.facade.getCanvas().update()},dialogClosed:function(c){var b=this.field?this.field.row:this.row;this.scope.afterEdit({grid:this.scope.grid,record:this.scope.grid.getStore().getAt(b),value:c});this.scope.grid.startEditing(b,this.col)},dialogClosed2:function(c){var b=this.field?this.field.row:this.row;this.scope.afterEdit({grid:this.scope.grid,record:this.scope.grid.getStore().getAt(b),value:c})},setPropertyWindowTitle:function(){1==
this.shapeSelection.shapes.length?region.setTitle(ORYX.I18N.PropertyWindow.title+" ("+this.shapeSelection.shapes.first().getStencil().title()+")"):region.setTitle(ORYX.I18N.PropertyWindow.title+" ("+this.shapeSelection.shapes.length+" "+ORYX.I18N.PropertyWindow.selected+")")},setCommonPropertiesValues:function(){this.shapeSelection.commonPropertiesValues=new Hash;this.shapeSelection.commonProperties.each(function(c){var b=c.prefix()+"-"+c.id(),d=!1,a=this.shapeSelection.shapes.first();this.shapeSelection.shapes.each(function(c){a.properties[b]!=
c.properties[b]&&(d=!0)}.bind(this));d||(this.shapeSelection.commonPropertiesValues[b]=a.properties[b])}.bind(this))},getStencilSetOfSelection:function(){var c=new Hash;this.shapeSelection.shapes.each(function(b){c[b.getStencil().id()]=b.getStencil()});return c},identifyCommonProperties:function(){this.shapeSelection.commonProperties.clear();var c=this.getStencilSetOfSelection().values(),b=c.first(),c=c.without(b);if(0==c.length)this.shapeSelection.commonProperties=b.properties();else{var d=new Hash;
b.properties().each(function(a){d[a.namespace()+"-"+a.id()+"-"+a.type()]=a});c.each(function(a){var c=new Hash;a.properties().each(function(a){var b=a.namespace()+"-"+a.id()+"-"+a.type();d[b]&&(c[b]=a)});d=c});this.shapeSelection.commonProperties=d.values()}},onSelectionChanged:function(c){this.grid.stopEditing();(this.shapeSelection.shapes=c.elements)?0==c.elements.length&&(this.shapeSelection.shapes=[this.facade.getCanvas()]):this.shapeSelection.shapes=[this.facade.getCanvas()];c.subSelection&&
(this.shapeSelection.shapes=[c.subSelection]);this.setPropertyWindowTitle();this.identifyCommonProperties();this.setCommonPropertiesValues();this.createProperties()},createProperties:function(){this.properties=[];this.popularProperties=[];this.simulationProperties=[];if(this.shapeSelection.commonProperties){var c=null;if(ORYX.propertiesOrder){var b=this.shapeSelection.commonProperties.first();if(b&&(b=b.stencil())){var d=b.idWithoutNs(),c=ORYX.propertiesOrder[d];c||(b="type:"+b.type(),c=ORYX.propertiesOrder[b])}}this.shapeSelection.commonProperties.each(function(a,
b){var d=a.prefix()+"-"+a.id(),h=a.title(),j=[],i=this.shapeSelection.commonPropertiesValues[d],l=1E3;c&&(l=c[a.id()]||l);var e=void 0,n=!1,o=ORYX.FieldEditors[a.type()];if(void 0!==o){e=o.init.bind(this,d,a,j,b)();if(null==e)return;e.on("beforehide",this.facade.enableEvent.bind(this,ORYX.CONFIG.EVENT_KEYDOWN));e.on("specialkey",this.specialKeyDown.bind(this))}else if(a.readonly()){if(a.type()===ORYX.CONFIG.TYPE_URL||a.type()===ORYX.CONFIG.TYPE_DIAGRAM_LINK)i=0!==(""+i).search("http")?"http://"+i:
i,i="<a href='"+i+"' target='_blank'>"+i.split("://")[1]+"</a>"}else{switch(a.type()){case ORYX.CONFIG.TYPE_STRING:a.wrapLines()?(e=new Ext.form.TextArea({alignment:"tl-tl",allowBlank:a.optional(),msgTarget:"title",maxLength:a.length()}),e.on("keyup",function(a){this.editDirectly(d,a.getValue())}.bind(this))):(e=new Ext.form.TextField({allowBlank:a.optional(),msgTarget:"title",maxLength:a.length()}),e.on("keyup",function(a){this.editDirectly(d,a.getValue())}.bind(this)),e.on("blur",function(a){a.isValid(!1)||
this.updateAfterInvalid(d)}.bind(this)),e.on("specialkey",function(a){a.isValid(!1)||this.updateAfterInvalid(d)}.bind(this)));e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_BOOLEAN:e=new Ext.form.Checkbox;e.on("check",function(a,b){this.editDirectly(d,b)}.bind(this));e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_INTEGER:e=new Ext.form.NumberField({allowBlank:a.optional(),allowDecimals:!1,msgTarget:"title",minValue:a.min(),maxValue:a.max()});e.on("keyup",function(a){this.editDirectly(d,a.getValue())}.bind(this));
e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_FLOAT:e=new Ext.form.NumberField({allowBlank:a.optional(),allowDecimals:!0,msgTarget:"title",minValue:a.min(),maxValue:a.max()});e.on("keyup",function(a){this.editDirectly(d,a.getValue())}.bind(this));e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_COLOR:e=new Ext.ux.ColorField({allowBlank:a.optional(),msgTarget:"title",facade:this.facade});e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_CHOICE:var r=[];a.items().each(function(a){a.value()==i&&(i=a.title());
a.refToView()[0]&&(n=!0);r.push([a.icon(),a.title(),a.value()]);j.push({name:a.title(),icon:a.icon()})});e=new Ext.data.SimpleStore({fields:[{name:"icon"},{name:"title"},{name:"value"}],data:r});e=new Ext.form.ComboBox({editable:!1,tpl:'<tpl for="."><div class="x-combo-list-item">{[(values.icon) ? "<img src=\'" + values.icon + "\' />" : ""]} {title}</div></tpl>',store:e,displayField:"title",valueField:"value",typeAhead:!0,mode:"local",triggerAction:"all",selectOnFocus:!0});e.on("select",function(a){this.editDirectly(d,
a.getValue())}.bind(this));e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_DATE:e=ORYX.I18N.PropertyWindow.dateFormat;i instanceof Date||(i=Date.parseDate(i,e));e=new Ext.Editor(new Ext.form.DateField({allowBlank:a.optional(),format:e,msgTarget:"title"}));break;case ORYX.CONFIG.TYPE_TEXT:e=new Ext.form.ComplexTextField({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:b,facade:this.facade});e.on("dialogClosed",this.dialogClosed,{scope:this,row:b,col:1,field:e});e=new Ext.Editor(e);
break;case ORYX.CONFIG.TYPE_VARDEF:e=new Ext.form.ComplexVardefField({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:b,facade:this.facade});e.on("dialogClosed",this.dialogClosed,{scope:this,row:b,col:1,field:e});e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_EXPRESSION:e=new Ext.form.ComplexExpressionField({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:b,facade:this.facade});e.on("dialogClosed",this.dialogClosed,{scope:this,row:b,col:1,field:e});e=new Ext.Editor(e);
break;case ORYX.CONFIG.TYPE_CALLEDELEMENT:e=new Ext.form.ComplexCalledElementField({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:b,facade:this.facade});e.on("dialogClosed",this.dialogClosed2,{scope:this,row:b,col:1,field:e});e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_CUSTOM:e=new Ext.form.ComplexCustomField({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:b,facade:this.facade,title:a.title(),attr:i});e.on("dialogClosed",this.dialogClosed,{scope:this,
row:b,col:1,field:e});e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_ACTION:e=new Ext.form.ComplexActionsField({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:b,facade:this.facade});e.on("dialogClosed",this.dialogClosed,{scope:this,row:b,col:1,field:e});e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_GLOBAL:e=new Ext.form.ComplexGlobalsField({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:b,facade:this.facade});e.on("dialogClosed",this.dialogClosed,{scope:this,
row:b,col:1,field:e});e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_IMPORT:e=new Ext.form.ComplexImportsField({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:b,facade:this.facade});e.on("dialogClosed",this.dialogClosed,{scope:this,row:b,col:1,field:e});e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_REASSIGNMENT:e=new Ext.form.ComplexReassignmentField({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:b,facade:this.facade});e.on("dialogClosed",this.dialogClosed,
{scope:this,row:b,col:1,field:e});e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_NOTIFICATIONS:e=new Ext.form.ComplexNotificationsField({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:b,facade:this.facade});e.on("dialogClosed",this.dialogClosed,{scope:this,row:b,col:1,field:e});e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_DATAINPUT:e=new Ext.form.ComplexDataInputField({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:b,facade:this.facade});e.on("dialogClosed",
this.dialogClosed,{scope:this,row:b,col:1,field:e});e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_DATAINPUT_SINGLE:e=new Ext.form.ComplexDataInputFieldSingle({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:b,facade:this.facade});e.on("dialogClosed",this.dialogClosed,{scope:this,row:b,col:1,field:e});e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_DATAOUTPUT:e=new Ext.form.ComplexDataOutputField({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:b,facade:this.facade});
e.on("dialogClosed",this.dialogClosed,{scope:this,row:b,col:1,field:e});e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_DATAOUTPUT_SINGLE:e=new Ext.form.ComplexDataOutputFieldSingle({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:b,facade:this.facade});e.on("dialogClosed",this.dialogClosed,{scope:this,row:b,col:1,field:e});e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_DATAASSIGNMENT:e=new Ext.form.ComplexDataAssignmenField({allowBlank:a.optional(),dataSource:this.dataSource,
grid:this.grid,row:b,facade:this.facade,shapes:this.shapeSelection.shapes});e.on("dialogClosed",this.dialogClosed,{scope:this,row:b,col:1,field:e});e=new Ext.Editor(e);break;case ORYX.CONFIG.TYPE_COMPLEX:e=new Ext.form.ComplexListField({allowBlank:a.optional()},a.complexItems(),d,this.facade);e.on("dialogClosed",this.dialogClosed,{scope:this,row:b,col:1,field:e});e=new Ext.Editor(e);break;case "CPNString":e=new Ext.form.TextField({allowBlank:a.optional(),msgTarget:"title",maxLength:a.length(),enableKeyEvents:!0});
e.on("keyup",function(a){this.editDirectly(d,a.getValue())}.bind(this));e=new Ext.Editor(e);break;default:e=new Ext.form.TextField({allowBlank:a.optional(),msgTarget:"title",maxLength:a.length(),enableKeyEvents:!0}),e.on("keyup",function(a){this.editDirectly(d,a.getValue())}.bind(this)),e=new Ext.Editor(e)}e.on("beforehide",this.facade.enableEvent.bind(this,ORYX.CONFIG.EVENT_KEYDOWN));e.on("specialkey",this.specialKeyDown.bind(this))}o=a.id();if(a.visible()&&"origbordercolor"!=o&&"origbgcolor"!=o&&
"isselectable"!=o){var o=!0,m=this.shapeSelection.shapes;if(1==m.length){var m=m.first(),k=m.getStencil().idWithoutNs();if("Task"==k||"IntermediateEscalationEventThrowing"==k||"IntermediateEvent"==k||"IntermediateMessageEventThrowing"==k||"IntermediateSignalEventThrowing"==k){if(a.fortasktypes()&&0<a.fortasktypes().length){for(var p=!1,k=a.fortasktypes().split("|"),q=0;q<k.size();q++)k[q]==m.properties["oryx-tasktype"]&&(p=!0);p||(o=!1)}if(a.fordistribution()&&0<a.fordistribution().length){p=!1;k=
a.fordistribution().split("|");for(q=0;q<k.size();q++)k[q]==m.properties["oryx-distributiontype"]&&(p=!0);p||(o=!1)}}}o&&((a.refToView()[0]||n||a.popular())&&a.setPopular(),a.simulation()&&a.setSimulation(),a.popular()?this.popularProperties.push([ORYX.I18N.PropertyWindow.oftenUsed,h,i,j,{editor:e,propId:d,type:a.type(),tooltip:a.description(),renderer:null,labelProvider:this.getLabelProvider(a)},l]):a.simulation()||this.properties.push([ORYX.I18N.PropertyWindow.moreProps,h,i,j,{editor:e,propId:d,
type:a.type(),tooltip:a.description(),renderer:null,labelProvider:this.getLabelProvider(a)},l]))}}.bind(this))}this.setProperties()},getLabelProvider:function(c){var b=ORYX.LabelProviders[c.labelProvider()];return b?b(c):null},hideMoreAttrs:function(){0>=this.properties.length||this.grid.view.un("refresh",this.hideMoreAttrs,this)},setProperties:function(){this.dataSource.loadData(this.popularProperties.concat(this.properties))},buildMultiValueLabelProvider:function(c){return function(){return function(b){if(!c.dataSource)return b;
var d="";if(b&&0<b.length){var a=[],f=c.valueField||"id",g=c.displayField||"name",d=c.displaySeparator||", ",h=b.split(c.valueSeparator||",");c.dataSource.each(function(b){var c=b.get(f);0<=h.indexOf(c)&&(b=b.get(g),a.push(b))});d=a.join(d)}return d}}},buildMultiValueTooltip:function(c,b){return function(){if(!c.dataSource)return null;var d=this.dataSource.findBy(function(a){return a.get("gridProperties").propId==b});if(-1==d)return null;if((d=this.dataSource.getAt(d).get("value"))&&0<d.length){var a=
[],f=c.valueField||"id",g=c.displayField||"name",h=d.split(c.valueSeparator||",");c.dataSource.each(function(b){var c=b.get(f);0<=h.indexOf(c)&&(b=b.get(g),a.push(c+" "+b))});return a.join("&#10;")}return null}.bind(this)}};ORYX.Plugins.PropertyWindow=Clazz.extend(ORYX.Plugins.PropertyWindow);Ext.form.ComplexListField=function(c,b,d,a){Ext.form.ComplexListField.superclass.constructor.call(this,c);this.items=b;this.key=d;this.facade=a};
Ext.extend(Ext.form.ComplexListField,Ext.form.TriggerField,{triggerClass:"x-form-complex-trigger",readOnly:!0,emptyText:ORYX.I18N.PropertyWindow.clickIcon,buildValue:function(){var c=this.grid.getStore();c.commitChanges();if(0==c.getCount())return"";for(var b="[",d=0;d<c.getCount();d++){for(var a=c.getAt(d),b=b+"{",f=0;f<this.items.length;f++){var g=this.items[f].id(),b=b+(g+":"+(""+a.get(g)).toJSON());f<this.items.length-1&&(b+=", ")}b+="}";d<c.getCount()-1&&(b+=", ")}b="{'totalCount':"+c.getCount().toJSON()+
", 'items':"+(b+"]")+"}";return Object.toJSON(b.evalJSON())},getFieldKey:function(){return this.key},getValue:function(){return this.grid?this.buildValue():void 0==this.data?"":this.data},setValue:function(c){0<c.length&&void 0==this.data&&(this.data=c)},keydownHandler:function(){return!1},dialogListeners:{show:function(){this.onFocus();this.facade.registerOnEvent(ORYX.CONFIG.EVENT_KEYDOWN,this.keydownHandler.bind(this));this.facade.disableEvent(ORYX.CONFIG.EVENT_KEYDOWN)},hide:function(){var c=this.dialogListeners;
this.dialog.un("show",c.show,this);this.dialog.un("hide",c.hide,this);this.dialog.destroy(!0);this.grid.destroy(!0);delete this.grid;delete this.dialog;this.facade.unregisterOnEvent(ORYX.CONFIG.EVENT_KEYDOWN,this.keydownHandler.bind(this));this.facade.enableEvent(ORYX.CONFIG.EVENT_KEYDOWN);this.fireEvent("dialogClosed",this.data);Ext.form.ComplexListField.superclass.setValue.call(this,this.data)}},buildInitial:function(c,b){for(var d=new Hash,a=0;a<b.length;a++){var f=b[a].id();d[f]=b[a].value()}return new (Ext.data.Record.create(c))(d)},
buildColumnModel:function(c){for(var b=[],d=0;d<this.items.length;d++){var a=this.items[d].id(),f=this.items[d].name(),g=this.items[d].width(),h=this.items[d].type(),j;if(h==ORYX.CONFIG.TYPE_STRING)j=new Ext.form.TextField({allowBlank:this.items[d].optional(),width:g});else if(h==ORYX.CONFIG.TYPE_CHOICE){var h=this.items[d].items(),i=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",c,["select",{style:"display:none"}]),l=new Ext.Template('<option value="{value}">{value}</option>');h.each(function(a){l.append(i,
{value:a.value()})});j=new Ext.form.ComboBox({editable:!1,typeAhead:!0,triggerAction:"all",transform:i,lazyRender:!0,msgTarget:"title",width:g})}else h==ORYX.CONFIG.TYPE_BOOLEAN?j=new Ext.form.Checkbox({width:g}):"xpath"==h&&(j=new Ext.form.TextField({allowBlank:this.items[d].optional(),width:g}));b.push({id:a,header:f,dataIndex:a,resizable:!0,editor:j,width:g})}return new Ext.grid.ColumnModel(b)},afterEdit:function(c){c.grid.getStore().commitChanges()},beforeEdit:function(c){this.grid.getView().getScrollState();
for(var b=c.column,c=c.row,d=this.grid.getColumnModel().config[b].id,a=0;a<this.items.length;a++){var f=this.items[a],g=f.disable();if(void 0!=g)for(var f=this.grid.getStore().getAt(c).get(f.id()),h=0;h<g.length;h++){var j=g[h];if(j.value==f)for(var i=0;i<j.items.length;i++)if(j.items[i]==d){this.grid.getColumnModel().getCellEditor(b,c).disable();return}}}this.grid.getColumnModel().getCellEditor(b,c).enable()},onTriggerClick:function(){if(!this.disabled){for(var c=0,b=[],d=0;d<this.items.length;d++){var a=
this.items[d].id(),f=this.items[d].width(),g=this.items[d].type();g==ORYX.CONFIG.TYPE_CHOICE&&(g=ORYX.CONFIG.TYPE_STRING);c+=f;b[d]={name:a,type:g}}800<c&&(c=800);c+=22;d=this.data;""==d&&(d="{}");d=new Ext.data.Store({proxy:new Ext.data.MemoryProxy(eval("("+d+")")),reader:new Ext.data.JsonReader({root:"items",totalProperty:"totalCount"},b)});d.load();a=this.buildColumnModel();this.grid=new Ext.grid.EditorGridPanel({autoScroll:!0,autoHeight:!0,store:d,cm:a,stripeRows:!0,clicksToEdit:1,selModel:new Ext.grid.CellSelectionModel});
d=new Ext.Toolbar([{text:ORYX.I18N.PropertyWindow.add,handler:function(){var a=this.grid.getStore(),c=a.getCount();this.grid.stopEditing();var d=this.buildInitial(b,this.items);a.insert(c,d);a.commitChanges();this.grid.startEditing(c,0)}.bind(this)},{text:ORYX.I18N.PropertyWindow.rem,handler:function(){var a=this.grid.getStore(),b=this.grid.getSelectionModel().getSelectedCell();void 0!=b&&(this.grid.getSelectionModel().clearSelections(),this.grid.stopEditing(),b=a.getAt(b[0]),a.remove(b),a.commitChanges())}.bind(this)}]);
this.dialog=new Ext.Window({autoScroll:!0,autoCreate:!0,title:ORYX.I18N.PropertyWindow.complex,height:350,width:c,y:ORYX.CONFIG.EXT_WINDOW_Y,modal:!0,collapsible:!1,fixedcenter:!0,shadow:!0,proxyDrag:!0,keys:[{key:27,fn:function(){this.dialog.hide}.bind(this)}],items:[d,this.grid],bodyStyle:"background-color:#FFFFFF",buttons:[{text:ORYX.I18N.PropertyWindow.ok,handler:function(){this.grid.getView().refresh();this.grid.stopEditing();this.data=this.buildValue();this.dialog.hide()}.bind(this)},{text:ORYX.I18N.PropertyWindow.cancel,
handler:function(){this.dialog.hide()}.bind(this)}]});this.dialog.on(Ext.apply({},this.dialogListeners,{scope:this}));this.dialog.show();this.grid.on("beforeedit",this.beforeEdit,this,!0);this.grid.on("afteredit",this.afterEdit,this,!0);this.grid.render()}}});
Ext.form.ComplexTextField=Ext.extend(Ext.form.TriggerField,{defaultAutoCreate:{tag:"textarea",rows:1,style:"height:16px;overflow:hidden;"},onTriggerClick:function(){if(!this.disabled){var c=new Ext.form.TextArea({anchor:"100% 100%",value:this.value,listeners:{focus:function(){this.facade.disableEvent(ORYX.CONFIG.EVENT_KEYDOWN)}.bind(this)}}),b=new Ext.Window({layout:"anchor",autoCreate:!0,title:ORYX.I18N.PropertyWindow.text,height:500,width:500,y:ORYX.CONFIG.EXT_WINDOW_Y,modal:!0,collapsible:!1,fixedcenter:!0,
shadow:!0,proxyDrag:!0,keys:[{key:27,fn:function(){b.hide()}.bind(this)}],items:[c],listeners:{hide:function(){this.fireEvent("dialogClosed",this.value);b.destroy()}.bind(this)},buttons:[{text:ORYX.I18N.PropertyWindow.ok,handler:function(){var d=c.getValue();this.setValue(d);this.dataSource.getAt(this.row).set("value",d);this.dataSource.commitChanges();b.hide()}.bind(this)},{text:ORYX.I18N.PropertyWindow.cancel,handler:function(){this.setValue(this.value);b.hide()}.bind(this)}]});b.show();c.render();
this.grid.stopEditing();c.focus(!1,100)}}});
Ext.form.ComplexCustomField=Ext.extend(Ext.form.TriggerField,{onTriggerClick:function(){this.disabled||Ext.Ajax.request({url:ORYX.PATH+"customeditors",method:"POST",success:function(c){try{if(c.responseText&&0<c.responseText.length){var b=c.responseText.evalJSON().editors;if(b[this.title]){var d=new Ext.Window({layout:"anchor",autoCreate:!0,title:this.title+" "+ORYX.I18N.PropertyWindow.Editor.title.CustomEditor,height:300,width:450,y:ORYX.CONFIG.EXT_WINDOW_Y,modal:!0,collapsible:!1,fixedcenter:!0,
shadow:!0,resizable:!0,proxyDrag:!0,autoScroll:!0,keys:[{key:27,fn:function(){d.hide()}.bind(this)}],items:[{xtype:"component",id:"customeditorswindow",autoEl:{tag:"iframe",src:b[this.title],width:"100%",height:"100%"}}],listeners:{hide:function(){this.fireEvent("dialogClosed",this.value);d.destroy()}.bind(this)},buttons:[{text:ORYX.I18N.PropertyWindow.ok,handler:function(){var a=document.getElementById("customeditorswindow").contentWindow.getEditorValue();this.setValue(a);this.dataSource.getAt(this.row).set("value",
a);this.dataSource.commitChanges();d.hide()}.bind(this)},{text:ORYX.I18N.PropertyWindow.cancel,handler:function(){this.setValue(this.value);d.hide()}.bind(this)}]});d.show();this.grid.stopEditing()}else Ext.Msg.alert("Unable to find custom editor info for"+this.title)}else Ext.Msg.alert("Invalid Custom Editors data.")}catch(a){Ext.Msg.alert("Error applying Custom Editor data:\n"+a)}}.bind(this),failure:function(){Ext.Msg.alert("Error applying Custom Editor data.")},params:{profile:ORYX.PROFILE}})}});
Ext.form.ComplexNotificationsField=Ext.extend(Ext.form.TriggerField,{onTriggerClick:function(){if(!this.disabled){var c=Ext.data.Record.create([{name:"type"},{name:"expires"},{name:"from"},{name:"tousers"},{name:"togroups"},{name:"replyto"},{name:"subject"},{name:"body"}]),b=new Ext.data.MemoryProxy({root:[]}),d=new Ext.data.Store({autoDestroy:!0,reader:new Ext.data.JsonReader({root:"root"},c),proxy:b,sorters:[{property:"subject",direction:"ASC"},{property:"from",direction:"ASC"},{property:"tousers",
direction:"ASC"},{property:"togroups",direction:"ASC"}]});d.load();if(0<this.value.length){this.value=this.value.replace(/\[/g,"");this.value=this.value.replace(/\]/g,"");for(var b=this.value.split("^"),a=0;a<b.length;a++){var f=b[a];if(0<f.indexOf("@")){var g=f.split("@"),h=g[0],f=g[1],g=g[2],j="",i="",l="",e="",n="",o="";if(0<h.indexOf("|"))for(var h=h.split("|"),r=0;r<h.length;r++){var m=h[r].split(/:(.+)?/)[0],k=h[r].split(/:(.+)?/)[1];"from"==m?j=k:"tousers"==m?i=k:"togroups"==m?l=k:"replyTo"==
m?e=k:"subject"==m?n=k:"body"==m&&(o=k.replace(/<br\s?\/?>/g,"\n"))}else m=h.split(/:(.+)?/)[0],k=h.split(/:(.+)?/)[1],"from"==m?j=k:"tousers"==m?i=k:"togroups"==m?l=k:"replyTo"==m?e=k:"subject"==m?n=k:"body"==m&&(o=k.replace(/<br\s?\/?>/g,"\n"));d.add(new c({type:g,expires:f,from:j,tousers:i,togroups:l,replyto:e,subject:n,body:o}))}}}b=[];a=[];a.push("not-started");a.push("not-started");b.push(a);a=[];a.push("not-completed");a.push("not-completed");b.push(a);var a=Ext.id(),f=new Extensive.grid.ItemDeleter,
p=new Ext.grid.EditorGridPanel({autoScroll:!0,autoHeight:!0,store:d,id:a,stripeRows:!0,cm:new Ext.grid.ColumnModel([new Ext.grid.RowNumberer,{id:"type",header:ORYX.I18N.PropertyWindow.Editor.Type,width:100,dataIndex:"type",editor:new Ext.form.ComboBox({id:"typeCombo",valueField:"name",displayField:"value",labelStyle:"display:none",submitValue:!0,typeAhead:!1,queryMode:"local",mode:"local",triggerAction:"all",selectOnFocus:!0,hideTrigger:!1,forceSelection:!1,selectOnFocus:!0,autoSelect:!1,store:new Ext.data.SimpleStore({fields:["name",
"value"],data:b})})},{id:"expires",header:ORYX.I18N.PropertyWindow.Editor.ExpiresAt,width:100,dataIndex:"expires",editor:new Ext.form.TextField({allowBlank:!0,regex:/^[a-z0-9 \-\.\_]*$/i}),renderer:Ext.util.Format.htmlEncode},{id:"from",header:ORYX.I18N.PropertyWindow.Editor.From,width:100,dataIndex:"from",editor:new Ext.form.TextField({allowBlank:!0,regex:/^[a-z0-9 \-\.\_\,]*$/i}),renderer:Ext.util.Format.htmlEncode},{id:"tousers",header:ORYX.I18N.PropertyWindow.Editor.ToUsers,width:100,dataIndex:"tousers",
editor:new Ext.form.TextField({allowBlank:!0,regex:/^[a-z0-9 \-\.\_\,]*$/i}),renderer:Ext.util.Format.htmlEncode},{id:"togroups",header:ORYX.I18N.PropertyWindow.Editor.ToGroups,width:100,dataIndex:"togroups",editor:new Ext.form.TextField({allowBlank:!0,regex:/^[a-z0-9 \-\.\_\,]*$/i}),renderer:Ext.util.Format.htmlEncode},{id:"replyto",header:ORYX.I18N.PropertyWindow.Editor.ReplyTo,width:100,dataIndex:"replyto",editor:new Ext.form.TextField({allowBlank:!0,regex:/^[a-z0-9 \-\.\_\,]*$/i}),renderer:Ext.util.Format.htmlEncode},
{id:"subject",header:ORYX.I18N.PropertyWindow.Editor.Subject,width:100,dataIndex:"subject",editor:new Ext.form.TextField({allowBlank:!0,regex:/^[a-z0-9 \-\.\_\,]*$/i}),renderer:Ext.util.Format.htmlEncode},{id:"body",header:ORYX.I18N.PropertyWindow.Editor.Body,width:100,height:650,dataIndex:"body",editor:new Ext.form.TextArea({width:150,height:650,allowBlank:!0,disableKeyFilter:!0,grow:!0}),renderer:Ext.util.Format.htmlEncode},f]),selModel:f,autoHeight:!0,tbar:[{text:ORYX.I18N.PropertyWindow.Editor.AddNotification,
handler:function(){d.add(new c({expires:"",from:"",tousers:"",type:"not-started",togroups:"",replyto:"",subject:"",body:""}));p.fireEvent("cellclick",p,d.getCount()-1,1,null)}}],clicksToEdit:1,listeners:{beforeedit:function(a){if(8!=a.column)return!0;var b=new Ext.Window({autoWidth:!0,autoHeight:!0,bodyBorder:!1,closable:!0,resizable:!1,items:[{xtype:"panel",html:"<p class='instructions'>"+ORYX.I18N.PropertyWindow.Editor.EnterNotificationbodymessage+"</p>"},{xtype:"textarea",id:"notificationbodyinput",
width:350,height:300,modal:!0,value:a.value}],bbar:[{text:ORYX.I18N.PropertyWindow.ok,handler:function(){a.record.set("body",Ext.get("notificationbodyinput").getValue());b.close()}}]});b.show();return!1}}}),q=new Ext.Window({layout:"anchor",autoCreate:!0,title:ORYX.I18N.PropertyWindow.Editor.ForNotifications,height:350,width:900,y:ORYX.CONFIG.EXT_WINDOW_Y,modal:!0,collapsible:!1,fixedcenter:!0,shadow:!0,resizable:!0,proxyDrag:!0,autoScroll:!0,keys:[{key:27,fn:function(){q.hide()}.bind(this)}],items:[p],
listeners:{hide:function(){this.fireEvent("dialogClosed",this.value);q.destroy()}.bind(this)},buttons:[{text:ORYX.I18N.PropertyWindow.ok,handler:function(){var a="";p.stopEditing();p.getView().refresh();d.data.each(function(){if((0<this.data.tousers.length||0<this.data.togroups.length)&&0<this.data.subject.length&&0<this.data.body.length)a+="[from:"+this.data.from+"|tousers:"+this.data.tousers+"|togroups:"+this.data.togroups+"|replyTo:"+this.data.replyto+"|subject:"+this.data.subject+"|body:"+this.data.body.replace(/\r\n|\r|\n/g,
"<br />")+"]",a+="@["+this.data.expires+"]",a+="@"+this.data.type,a+="^"});0<a.length&&(a=a.slice(0,-1));this.setValue(a);this.dataSource.getAt(this.row).set("value",a);this.dataSource.commitChanges();q.hide()}.bind(this)},{text:ORYX.I18N.PropertyWindow.cancel,handler:function(){this.setValue(this.value);q.hide()}.bind(this)}]});q.show();p.render();this.grid.stopEditing();p.focus(!1,100)}}});
Ext.form.ComplexReassignmentField=Ext.extend(Ext.form.TriggerField,{onTriggerClick:function(){if(!this.disabled){var c=Ext.data.Record.create([{name:"users"},{name:"groups"},{name:"expires"},{name:"type"}]),b=new Ext.data.MemoryProxy({root:[]}),d=new Ext.data.Store({autoDestroy:!0,reader:new Ext.data.JsonReader({root:"root"},c),proxy:b,sorters:[{property:"users",direction:"ASC"},{property:"groups",direction:"ASC"}]});d.load();if(0<this.value.length){this.value=this.value.replace(/\[/g,"");this.value=
this.value.replace(/\]/g,"");for(var b=this.value.split("^"),a=0;a<b.length;a++){var f=b[a];if(0<f.indexOf("@")){var g=f.split("@"),h=g[0],f=g[1],g=g[2],j="",i="";if(0<h.indexOf("|")){var l=h.split("|"),h=l[1],l=l[0].split(":");"users"==l[0]?j=l[1]:"groups"==l[0]&&(i=l[1])}h=h.split(":");"users"==h[0]?j=h[1]:"groups"==h[0]&&(i=h[1]);d.add(new c({users:j,groups:i,expires:f,type:g}))}}}b=[];a=[];a.push("not-started");a.push("not-started");b.push(a);a=[];a.push("not-completed");a.push("not-completed");
b.push(a);var a=Ext.id(),f=new Extensive.grid.ItemDeleter,e=new Ext.grid.EditorGridPanel({autoScroll:!0,autoHeight:!0,store:d,id:a,stripeRows:!0,cm:new Ext.grid.ColumnModel([new Ext.grid.RowNumberer,{id:"users",header:ORYX.I18N.PropertyWindow.Editor.Users,width:150,dataIndex:"users",editor:new Ext.form.TextField({allowBlank:!0,regex:/^[a-z0-9 \-\.\_\,]*$/i}),renderer:Ext.util.Format.htmlEncode},{id:"groups",header:ORYX.I18N.PropertyWindow.Editor.Groups,width:150,dataIndex:"groups",editor:new Ext.form.TextField({allowBlank:!0,
regex:/^[a-z0-9 \-\.\_\,]*$/i}),renderer:Ext.util.Format.htmlEncode},{id:"expires",header:ORYX.I18N.PropertyWindow.Editor.ExpiresAt,width:150,dataIndex:"expires",editor:new Ext.form.TextField({allowBlank:!0,regex:/^[a-z0-9 \-\.\_]*$/i}),renderer:Ext.util.Format.htmlEncode},{id:"type",header:ORYX.I18N.PropertyWindow.Editor.Type,width:150,dataIndex:"type",editor:new Ext.form.ComboBox({id:"typeCombo",valueField:"name",displayField:"value",labelStyle:"display:none",submitValue:!0,typeAhead:!1,queryMode:"local",
mode:"local",triggerAction:"all",selectOnFocus:!0,hideTrigger:!1,forceSelection:!1,selectOnFocus:!0,autoSelect:!1,store:new Ext.data.SimpleStore({fields:["name","value"],data:b})})},f]),selModel:f,autoHeight:!0,tbar:[{text:ORYX.I18N.PropertyWindow.Editor.AddReassignment,handler:function(){d.add(new c({users:"",groups:"",expires:"",type:"not-started"}));e.fireEvent("cellclick",e,d.getCount()-1,1,null)}}],clicksToEdit:1}),n=new Ext.Window({layout:"anchor",autoCreate:!0,title:ORYX.I18N.PropertyWindow.Editor.ForReassignments,
height:350,width:700,modal:!0,collapsible:!1,fixedcenter:!0,shadow:!0,resizable:!0,proxyDrag:!0,autoScroll:!0,keys:[{key:27,fn:function(){n.hide()}.bind(this)}],items:[e],listeners:{hide:function(){this.fireEvent("dialogClosed",this.value);n.destroy()}.bind(this)},buttons:[{text:ORYX.I18N.PropertyWindow.ok,handler:function(){var a="";e.stopEditing();e.getView().refresh();d.data.each(function(){if((0<this.data.users.length||0<this.data.groups.length)&&0<this.data.expires.length&&0<this.data.type.length)a+=
"[users:"+this.data.users+"|groups:"+this.data.groups+"]",a+="@["+this.data.expires+"]",a+="@"+this.data.type,a+="^"});0<a.length&&(a=a.slice(0,-1));this.setValue(a);this.dataSource.getAt(this.row).set("value",a);this.dataSource.commitChanges();n.hide()}.bind(this)},{text:ORYX.I18N.PropertyWindow.cancel,handler:function(){this.setValue(this.value);n.hide()}.bind(this)}]});n.show();e.render();this.grid.stopEditing();e.focus(!1,100)}}});
Ext.form.ComplexImportsField=Ext.extend(Ext.form.TriggerField,{onTriggerClick:function(){if(!this.disabled){var c=Ext.data.Record.create([{name:"import"}]),b=new Ext.data.MemoryProxy({root:[]}),d=new Ext.data.Store({autoDestroy:!0,reader:new Ext.data.JsonReader({root:"root"},c),proxy:b,sorters:[{property:"import",direction:"ASC"}]});d.load();if(0<this.value.length)for(var b=this.value.split(","),a=0;a<b.length;a++)d.add(new c({"import":b[a]}));var b=new Extensive.grid.ItemDeleter,a=Ext.id(),f=new Ext.grid.EditorGridPanel({autoScroll:!0,
autoHeight:!0,store:d,id:a,stripeRows:!0,cm:new Ext.grid.ColumnModel([new Ext.grid.RowNumberer,{id:"import",header:ORYX.I18N.PropertyWindow.Editor.Import,width:360,dataIndex:"import",editor:new Ext.form.TextField({allowBlank:!0})},b]),selModel:b,autoHeight:!0,tbar:[{text:ORYX.I18N.PropertyWindow.Editor.AddImport,handler:function(){d.add(new c({"import":""}));f.fireEvent("cellclick",f,d.getCount()-1,1,null)}}],clicksToEdit:1}),g=new Ext.Window({layout:"anchor",autoCreate:!0,title:ORYX.I18N.PropertyWindow.Editor.ForImports,
height:300,width:450,y:ORYX.CONFIG.EXT_WINDOW_Y,modal:!0,collapsible:!1,fixedcenter:!0,shadow:!0,resizable:!0,proxyDrag:!0,autoScroll:!0,keys:[{key:27,fn:function(){g.hide()}.bind(this)}],items:[f],listeners:{hide:function(){this.fireEvent("dialogClosed",this.value);g.destroy()}.bind(this)},buttons:[{text:ORYX.I18N.PropertyWindow.ok,handler:function(){var a="";f.getView().refresh();f.stopEditing();d.data.each(function(){0<this.data["import"].length&&(a+=this.data["import"]+",")});0<a.length&&(a=a.slice(0,
-1));this.setValue(a);this.dataSource.getAt(this.row).set("value",a);this.dataSource.commitChanges();g.hide()}.bind(this)},{text:ORYX.I18N.PropertyWindow.cancel,handler:function(){this.setValue(this.value);g.hide()}.bind(this)}]});g.show();f.render();this.grid.stopEditing();f.focus(!1,100)}}});
Ext.form.ComplexActionsField=Ext.extend(Ext.form.TriggerField,{onTriggerClick:function(){if(!this.disabled){var c=Ext.data.Record.create([{name:"action"}]),b=new Ext.data.MemoryProxy({root:[]}),d=new Ext.data.Store({autoDestroy:!0,reader:new Ext.data.JsonReader({root:"root"},c),proxy:b,sorters:[{property:"action",direction:"ASC"}]});d.load();if(0<this.value.length)for(var b=this.value.split("|"),a=0;a<b.length;a++)d.add(new c({action:b[a]}));var b=new Extensive.grid.ItemDeleter,a=Ext.id(),f=new Ext.grid.EditorGridPanel({autoScroll:!0,
autoHeight:!0,store:d,id:a,stripeRows:!0,cm:new Ext.grid.ColumnModel([new Ext.grid.RowNumberer,{id:"action",header:ORYX.I18N.PropertyWindow.Editor.Action,width:360,dataIndex:"action",editor:new Ext.form.TextField({allowBlank:!0})},b]),selModel:b,autoHeight:!0,tbar:[{text:ORYX.I18N.PropertyWindow.Editor.AddAction,handler:function(){d.add(new c({action:""}));f.fireEvent("cellclick",f,d.getCount()-1,1,null)}}],clicksToEdit:1}),g=new Ext.Window({layout:"anchor",autoCreate:!0,title:ORYX.I18N.PropertyWindow.Editor.ForActions,
height:300,width:450,y:ORYX.CONFIG.EXT_WINDOW_Y,modal:!0,collapsible:!1,fixedcenter:!0,shadow:!0,resizable:!0,proxyDrag:!0,autoScroll:!0,keys:[{key:27,fn:function(){g.hide()}.bind(this)}],items:[f],listeners:{hide:function(){this.fireEvent("dialogClosed",this.value);g.destroy()}.bind(this)},buttons:[{text:ORYX.I18N.PropertyWindow.ok,handler:function(){var a="";f.getView().refresh();f.stopEditing();d.data.each(function(){0<this.data.action.length&&(a+=this.data.action+"|")});0<a.length&&(a=a.slice(0,
-1));this.setValue(a);this.dataSource.getAt(this.row).set("value",a);this.dataSource.commitChanges();g.hide()}.bind(this)},{text:ORYX.I18N.PropertyWindow.cancel,handler:function(){this.setValue(this.value);g.hide()}.bind(this)}]});g.show();f.render();this.grid.stopEditing();f.focus(!1,100)}}});
Ext.form.ComplexDataAssignmenField=Ext.extend(Ext.form.TriggerField,{tbarConfigCallback:null,assignTarget:null,windowTitle:ORYX.I18N.PropertyWindow.Editor.ForAssignments,assignByName:function(c,b){for(var d=this.assignmentGrid.store,a=this.dataTypeMap,f=[],g=0;g<c.length;g++)-1!=b.indexOf(c[g])&&f.push(c[g]);for(g=0;g<f.length;g++){var h=f[g],j=a[h]||"String";-1==d.findBy(function(a){return a.get("from")==h&&a.get("to")==h})&&d.add(new this.DataAssignment({from:h,type:"is mapped to",to:h,tostr:"",
dataType:j}))}},onTriggerClick:function(){if(!this.disabled){var c=ORYX.EDITOR.getSerializedJSON(),c=jsonPath(c.evalJSON(),"$.properties.vardefs"),b=[],d=this.dataTypeMap=new Hash,a=this.varNamesMap={processVars:[],dataInputs:[],dataOutputs:[]},f=[];f.push("");f.push(ORYX.I18N.PropertyWindow.Editor.DataTitle_VariableDefinitions);b.push(f);c&&c.forEach(function(c){if(0<c.length)for(var c=c.split(","),e=0;e<c.length;e++){var f=[],g=c[e];0<g.indexOf(":")?(g=g.split(":"),f.push(g[0]),f.push(g[0]),d[g[0]]=
g[1]):(f.push(g),f.push(g),d[g]="java.lang.String");a.processVars.push(f[0]);b.push(f)}});"input"===this.assignTarget&&(c=[],c.push(""),c.push(ORYX.I18N.PropertyWindow.Editor.DataTitle_DataInputs),b.push(c),Ext.each(this.dataSource.data.items,function(c){if("oryx-datainputset"==c.data.gridProperties.propId||"oryx-datainput"==c.data.gridProperties.propId)for(var c=c.data.value.split(","),e=0;e<c.length;e++){var f=c[e],g=[];0<f.indexOf(":")?(f=f.split(":"),g.push(f[0]),g.push(f[0]),d[f[0]]=f[1]):(g.push(f),
g.push(f),d[f]="java.lang.String");a.dataInputs.push(g[0]);b.push(g)}}));"output"===this.assignTarget&&(c=[],c.push(""),c.push(ORYX.I18N.PropertyWindow.Editor.DataTitle_DataOutputs),b.push(c),Ext.each(this.dataSource.data.items,function(c){if("oryx-dataoutputset"==c.data.gridProperties.propId||"oryx-dataoutput"==c.data.gridProperties.propId)for(var c=c.data.value.split(","),e=0;e<c.length;e++){var f=c[e],g=[];0<f.indexOf(":")?(f=f.split(":"),g.push(f[0]),g.push(f[0]),d[f[0]]=f[1]):(g.push(f),g.push(f),
d[f]="java.lang.String");a.dataOutputs.push(g[0]);b.push(g)}}));var g=this.DataAssignment=Ext.data.Record.create([{name:"from"},{name:"type"},{name:"to"},{name:"tostr"},{name:"dataType"}]),c=new Ext.data.MemoryProxy({root:[]}),h=new Ext.data.Store({autoDestroy:!0,reader:new Ext.data.JsonReader({root:"root"},g),proxy:c,sorters:[{property:"from",direction:"ASC"},{property:"to",direction:"ASC"},{property:"tostr",direction:"ASC"}]});h.load();if(0<this.value.length){c=this.value.split(",");for(f=0;f<c.length;f++){var j=
c[f];if(0<j.indexOf("=")){var j=j.split("="),i=d[j[0]];i||(i="java.lang.String");var l=j[1].replace(/\#\#/g,",");h.add(new g({from:j[0],type:"is equal to",to:"",tostr:l,dataType:i}))}else 0<j.indexOf("->")?(j=j.split("->"),(i=d[j[0]])||(i="java.lang.String"),h.add(new g({from:j[0],type:"is mapped to",to:j[1],tostr:"",dataType:i}))):((i=d[j])||(i="java.lang.String"),h.add(new g({from:j,type:"output"===this.assignTarget?"is mapped to":"is equal to",to:"",tostr:"",dataType:i})))}}h.on("update",function(a,
c,b){"edit"==b&&((a=d[c.get("from")])||(a="java.lang.String"),c.set("dataType",a))});var c=new Extensive.grid.ItemDeleter,f=Ext.id(),e=this.assignmentGrid=new Ext.grid.EditorGridPanel({autoScroll:!0,autoHeight:!0,store:h,id:f,stripeRows:!0,cm:new Ext.grid.ColumnModel([new Ext.grid.RowNumberer,{id:"valueType",header:ORYX.I18N.PropertyWindow.Editor.DataType,width:180,dataIndex:"dataType",hidden:"true"},{id:"from",header:ORYX.I18N.PropertyWindow.Editor.FromObject,width:180,dataIndex:"from",editor:new Ext.form.ComboBox({id:"fromCombo",
valueField:"name",displayField:"value",typeAhead:!0,mode:"local",triggerAction:"all",selectOnFocus:!0,store:new Ext.data.SimpleStore({fields:["name","value"],data:b})})},{id:"type",header:ORYX.I18N.PropertyWindow.Editor.AssignmentType,width:100,dataIndex:"type",editor:new Ext.form.ComboBox({id:"typeCombo",valueField:"name",displayField:"value",typeAhead:!0,mode:"local",triggerAction:"all",selectOnFocus:!0,store:new Ext.data.SimpleStore({fields:["name","value"],data:[["is mapped to",ORYX.I18N.PropertyWindow.Editor.isMappedTo],
["is equal to",ORYX.I18N.PropertyWindow.Editor.isEqualTo]]})}),renderer:function(a){return"is mapped to"==a?ORYX.I18N.PropertyWindow.Editor.isMappedTo:"is equal to"==a?ORYX.I18N.PropertyWindow.Editor.isEqualTo:a}},{id:"to",header:ORYX.I18N.PropertyWindow.Editor.ToObject,width:180,dataIndex:"to",editor:new Ext.form.ComboBox({id:"toCombo",valueField:"name",displayField:"value",typeAhead:!0,mode:"local",triggerAction:"all",selectOnFocus:!0,store:new Ext.data.SimpleStore({fields:["name","value"],data:b})})},
{id:"tostr",header:ORYX.I18N.PropertyWindow.Editor.ToValue,width:180,dataIndex:"tostr",editor:new Ext.form.TextField({allowBlank:!0}),renderer:Ext.util.Format.htmlEncode},c]),selModel:c,autoHeight:!0,tbar:function(){var a={text:ORYX.I18N.PropertyWindow.Editor.AddAssignment,handler:function(){h.add(new g({from:"",type:"is mapped to",to:"",tostr:""}));e.fireEvent("cellclick",e,h.getCount()-1,1,null)}},c=[a];this.tbarConfigCallback&&"function"===typeof this.tbarConfigCallback&&(c=this.tbarConfigCallback(),
c.unshift(a));return c}.call(this),clicksToEdit:1}),n=new Ext.Window({layout:"anchor",autoCreate:!0,title:this.windowTitle,height:350,width:730,y:ORYX.CONFIG.EXT_WINDOW_Y,modal:!0,collapsible:!1,fixedcenter:!0,shadow:!0,resizable:!0,proxyDrag:!0,autoScroll:!0,keys:[{key:27,fn:function(){n.hide()}.bind(this)}],items:[e],listeners:{hide:function(){this.fireEvent("dialogClosed",this.value);n.destroy()}.bind(this)},buttons:[{text:ORYX.I18N.PropertyWindow.ok,handler:function(){var a="";e.getView().refresh();
e.stopEditing();h.data.each(function(){if(0<this.data.from.length&&0<this.data.type.length)if("is mapped to"==this.data.type)a+=this.data.from+"->"+this.data.to+",";else if("is equal to"==this.data.type){var c=this.data.tostr.replace(/,/g,"##");a+=this.data.from+"="+c+","}});0<a.length&&(a=a.slice(0,-1));this.setValue(a);this.dataSource.getAt(this.row).set("value",a);this.dataSource.commitChanges();n.hide()}.bind(this)},{text:ORYX.I18N.PropertyWindow.cancel,handler:function(){this.setValue(this.value);
n.hide()}.bind(this)}]});n.show();e.render();this.grid.stopEditing();e.focus(!1,100);return e}},buildAssignmentTooltip:function(c,b){return function(){var d=this.dataSource.findBy(function(a){return a.get("gridProperties").propId==b});if(-1==d)return null;if((d=this.dataSource.getAt(d).get("value"))&&0<d.length){var a=c.valueSeparator||",",d=d.replace(/-\>/g," -> ");return d.split(a).join("&#10;")}return null}.bind(this)}});
Ext.form.NameTypeEditor=Ext.extend(Ext.form.TriggerField,{windowTitle:"",addButtonLabel:"",single:!1,tbarConfigCallback:null,_typesData:[["String",ORYX.I18N.PropertyWindow.Editor.TypeString],["Integer",ORYX.I18N.PropertyWindow.Editor.TypeInteger],["Float",ORYX.I18N.PropertyWindow.Editor.TypeFloat],["Boolean",ORYX.I18N.PropertyWindow.Editor.TypeBoolean],["Object",ORYX.I18N.PropertyWindow.Editor.TypeObject]],onTriggerClick:function(){if(!this.disabled){var c=this.VarDef=Ext.data.Record.create([{name:"name"},
{name:"stype"},{name:"ctype"}]),b=new Ext.data.MemoryProxy({root:[]}),d=new Ext.data.Store({autoDestroy:!0,reader:new Ext.data.JsonReader({root:"root"},c),proxy:b,sorters:[{property:"name",direction:"ASC"}]});d.load();if(0<this.value.length)for(var b=this.value.split(","),a=0;a<b.length;a++){var f=b[a];0<f.indexOf(":")?(f=f.split(":"),"String"==f[1]||"Integer"==f[1]||"Boolean"==f[1]||"Float"==f[1]?d.add(new c({name:f[0],stype:f[1],ctype:""})):"Object"!=f[1]?d.add(new c({name:f[0],stype:"Object",ctype:f[1]})):
d.add(new c({name:f[0],stype:f[1],ctype:""}))):d.add(new c({name:f,stype:"",ctype:""}))}b=new Extensive.grid.ItemDeleter;a=Ext.id();Ext.form.VTypes.inputNameVal=/^[a-z0-9 \-\.\_]*$/i;Ext.form.VTypes.inputNameText="Invalid name";Ext.form.VTypes.inputName=function(a){return Ext.form.VTypes.inputNameVal.test(a)};var g=this.vardefsGrid=new Ext.grid.EditorGridPanel({autoScroll:!0,autoHeight:!0,store:d,id:a,stripeRows:!0,cm:new Ext.grid.ColumnModel([new Ext.grid.RowNumberer,{id:"name",header:ORYX.I18N.PropertyWindow.Editor.Name,
width:100,dataIndex:"name",editor:new Ext.form.TextField({allowBlank:!0,vtype:"inputName",regex:/^[a-z0-9 \-\.\_]*$/i}),renderer:Ext.util.Format.htmlEncode},{id:"stype",header:ORYX.I18N.PropertyWindow.Editor.StandardType,width:100,dataIndex:"stype",editor:new Ext.form.ComboBox({id:"typeCombo",valueField:"name",displayField:"value",labelStyle:"display:none",submitValue:!0,typeAhead:!1,queryMode:"local",mode:"local",triggerAction:"all",selectOnFocus:!0,hideTrigger:!1,forceSelection:!1,selectOnFocus:!0,
autoSelect:!1,store:new Ext.data.SimpleStore({fields:["name","value"],data:this._typesData})}),renderer:function(a){for(var c=this._typesData,b=0;b<c.length;b++)if(c[b][0]===a)return c[b][1];return a}.bind(this)},{id:"ctype",header:ORYX.I18N.PropertyWindow.Editor.CustomType,width:100,dataIndex:"ctype",editor:new Ext.form.TextField({allowBlank:!0}),renderer:Ext.util.Format.htmlEncode},b]),selModel:b,autoHeight:!0,tbar:function(){var a={text:this.addButtonLabel,handler:function(){this.single&&0<d.getCount()?
Ext.Msg.alert(ORYX.I18N.PropertyWindow.Editor.OnlySingleEntryAllowed):(d.add(new c({name:"",stype:"String",ctype:""})),g.fireEvent("cellclick",g,d.getCount()-1,1,null))}.bind(this)},b=[a];this.tbarConfigCallback&&"function"===typeof this.tbarConfigCallback&&(b=this.tbarConfigCallback(),b.unshift(a));return b}.call(this),clicksToEdit:1}),h=new Ext.Window({layout:"anchor",autoCreate:!0,title:this.windowTitle,height:300,width:400,y:ORYX.CONFIG.EXT_WINDOW_Y,modal:!0,collapsible:!1,fixedcenter:!0,shadow:!0,
resizable:!0,proxyDrag:!0,autoScroll:!0,keys:[{key:27,fn:function(){h.hide()}.bind(this)}],items:[g],listeners:{hide:function(){this.fireEvent("dialogClosed",this.value);h.destroy()}.bind(this)},buttons:[{text:ORYX.I18N.PropertyWindow.ok,handler:function(){var a="";g.stopEditing();g.getView().refresh();d.data.each(function(){0<this.data.name.length&&(a=0<this.data.stype.length?"Object"==this.data.stype&&0<this.data.ctype.length?a+(this.data.name+":"+this.data.ctype+","):a+(this.data.name+":"+this.data.stype+
","):0<this.data.ctype.length?a+(this.data.name+":"+this.data.ctype+","):a+(this.data.name+","))});0<a.length&&(a=a.slice(0,-1));this.setValue(a);this.dataSource.getAt(this.row).set("value",a);this.dataSource.commitChanges();h.hide()}.bind(this)},{text:ORYX.I18N.PropertyWindow.cancel,handler:function(){this.setValue(this.value);h.hide()}.bind(this)}]});h.show();g.render();this.grid.stopEditing();g.focus(!1,100)}},buildNameTypeTooltip:function(c,b){return function(){var d=this.dataSource.findBy(function(a){return a.get("gridProperties").propId==
b});if(-1==d)return null;if((d=this.dataSource.getAt(d).get("value"))&&0<d.length){var a=c.valueSeparator||",",d=d.replace(/\:/g," ");return d.split(a).join("&#10;")}return null}.bind(this)}});Ext.form.ComplexVardefField=Ext.extend(Ext.form.NameTypeEditor,{windowTitle:ORYX.I18N.PropertyWindow.Editor.ForVariableDefinitions,addButtonLabel:ORYX.I18N.PropertyWindow.Editor.AddVariable});
Ext.form.ComplexDataInputField=Ext.extend(Ext.form.NameTypeEditor,{windowTitle:ORYX.I18N.PropertyWindow.Editor.ForDataInput,addButtonLabel:ORYX.I18N.PropertyWindow.Editor.AddDataInput});Ext.form.ComplexDataOutputField=Ext.extend(Ext.form.NameTypeEditor,{windowTitle:ORYX.I18N.PropertyWindow.Editor.ForDataOutput,addButtonLabel:ORYX.I18N.PropertyWindow.Editor.AddDataOutput});
Ext.form.ComplexDataInputFieldSingle=Ext.extend(Ext.form.NameTypeEditor,{windowTitle:ORYX.I18N.PropertyWindow.Editor.ForDataInput,addButtonLabel:ORYX.I18N.PropertyWindow.Editor.AddDataInput,single:!0});Ext.form.ComplexDataOutputFieldSingle=Ext.extend(Ext.form.NameTypeEditor,{windowTitle:ORYX.I18N.PropertyWindow.Editor.ForDataOutput,addButtonLabel:ORYX.I18N.PropertyWindow.Editor.AddDataOutput,single:!0});
Ext.form.ComplexGlobalsField=Ext.extend(Ext.form.NameTypeEditor,{windowTitle:ORYX.I18N.PropertyWindow.Editor.ForGlobals,addButtonLabel:ORYX.I18N.PropertyWindow.Editor.AddGlobals});
Ext.form.ComplexExpressionField=Ext.extend(Ext.form.TriggerField,{onTriggerClick:function(){if(!this.disabled){var c=new Ext.form.TextArea({id:Ext.id(),fieldLabel:"Expression Editor",value:this.value,autoScroll:!0}),b,d,a=new Ext.Window({layout:"anchor",autoCreate:!0,title:ORYX.I18N.PropertyWindow.Editor.ForExpression,height:430,width:550,y:ORYX.CONFIG.EXT_WINDOW_Y,modal:!0,collapsible:!1,fixedcenter:!0,shadow:!0,resizable:!0,proxyDrag:!0,autoScroll:!0,keys:[{key:27,fn:function(){a.hide()}.bind(this)}],
items:[c],listeners:{hide:function(){this.fireEvent("dialogClosed",this.value);a.destroy()}.bind(this)},buttons:[{text:ORYX.I18N.PropertyWindow.ok,handler:function(){this.setValue(b.getValue());this.dataSource.getAt(this.row).set("value",b.getValue());this.dataSource.commitChanges();a.hide()}.bind(this)},{text:ORYX.I18N.PropertyWindow.cancel,handler:function(){this.setValue(this.value);a.hide()}.bind(this)}]});a.show();this.foldFunc=CodeMirror.newFoldFunction(CodeMirror.braceRangeFinder);b=CodeMirror.fromTextArea(document.getElementById(c.getId()),
{mode:"text/x-java",lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,onGutterClick:this.foldFunc,extraKeys:{"Ctrl-Z":function(c){CodeMirror.hint(c,CodeMirror.jbpmHint,a)}},onCursorActivity:function(){b.setLineClass(d,null,null);d=b.setLineClass(b.getCursor().line,null,"activeline")}.bind(this)});d=b.setLineClass(0,"activeline");this.grid.stopEditing()}}});
Ext.form.ComplexCalledElementField=Ext.extend(Ext.form.TriggerField,{onTriggerClick:function(){if(!this.disabled){var c=ORYX.getBussinessDataLoader().loadPublishedProcesses(),b=new Ext.grid.GridPanel({autoScroll:!0,autoHeight:!0,store:c,id:Ext.id(),sm:new Ext.grid.CellSelectionModel,cm:new Ext.grid.ColumnModel([new Ext.grid.RowNumberer,{id:"pid",header:ORYX.I18N.PropertyWindow.Editor.ProcessId,width:150,dataIndex:"name"},{id:"version",header:"\u7248\u672c",width:150,dataIndex:"version"},{id:"pim",
header:"\u56fe\u7247",width:80,dataIndex:"",renderer:function(a,c,b){a=b.get("name");b=b.get("version").split(",");b=a+"@"+b[b.length-1];a=ORYX.CONFIG.PROCESS_IMAGE_URL(b);return'<center><img src="'+ORYX.PATH+'images/page_white_picture.png" onclick="new ImageViewer({title: \''+ORYX.I18N.PropertyWindow.Editor.ProcessImage+" "+b+"', width: '650', height: '450', autoScroll: true, src: '"+a+"',hideAction: 'close'}).show();\" alt=\""+ORYX.I18N.Shapes.ProcessImage+'" style="cursor:pointer;"/></center>'}}])});
b.on("afterrender",function(){if(0<this.value.length){var a=0,d=this.value;-1!=d.indexOf("@")&&(d=d.substr(0,d.indexOf("@")));c.data.each(function(){this.data.name==d&&b.getSelectionModel().select(a,1);a++})}}.bind(this));var d=new Ext.Window({layout:"anchor",autoCreate:!0,title:ORYX.I18N.PropertyWindow.Editor.SelectProcessId,height:250,width:430,y:ORYX.CONFIG.EXT_WINDOW_Y,modal:!0,collapsible:!1,fixedcenter:!0,shadow:!0,resizable:!0,proxyDrag:!0,autoScroll:!0,keys:[{key:27,fn:function(){d.hide()}.bind(this)}],
items:[b],listeners:{hide:function(){this.fireEvent("dialogClosed",this.value);d.destroy()}.bind(this)},buttons:[{text:ORYX.I18N.PropertyWindow.ok,handler:function(){var a=b.getSelectionModel().getSelectedCell();if(null!=a){var f=c.getAt(a[0]),a=f.data.name,f=f.data.version.split(","),a=a+"@"+f[f.length-1];this.setValue(a);this.dataSource.getAt(this.row).set("value",a);this.dataSource.commitChanges();d.hide()}else Ext.Msg.alert(ORYX.I18N.PropertyWindow.Editor.SelectProcessId)}.bind(this)},{text:ORYX.I18N.PropertyWindow.cancel,
handler:function(){this.setValue(this.value);d.hide()}.bind(this)}]});d.show();b.render();b.fireEvent("afterrender")}}});
/* ORYX.Plugins.CanvasResize */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.CanvasResize=Clazz.extend({construct:function(f){this.facade=f;new ORYX.Plugins.CanvasResizeButton(this.facade.getCanvas(),"N",this.resize.bind(this));new ORYX.Plugins.CanvasResizeButton(this.facade.getCanvas(),"W",this.resize.bind(this));new ORYX.Plugins.CanvasResizeButton(this.facade.getCanvas(),"E",this.resize.bind(this));new ORYX.Plugins.CanvasResizeButton(this.facade.getCanvas(),"S",this.resize.bind(this))},resize:function(f,d){resizeCanvas=function(a,d,e){var b=e.getCanvas(),f=
b.bounds,g=e.getCanvas().getHTMLContainer().parentNode.parentNode;"E"==a||"W"==a?b.setSize({width:(f.width()+d)*b.zoomLevel,height:f.height()*b.zoomLevel}):("S"==a||"N"==a)&&b.setSize({width:f.width()*b.zoomLevel,height:(f.height()+d)*b.zoomLevel});if("N"==a||"W"==a){var i="N"==a?{x:0,y:d}:{x:d,y:0};b.getChildNodes(!1,function(c){c.bounds.moveBy(i)});b.getChildEdges().findAll(function(c){return 0<c.getAllDockedShapes().length}).collect(function(c){return c.dockers.findAll(function(c){return!c.getDockedShape()})}).flatten().each(function(c){c.bounds.moveBy(i)})}else"S"==
a?g.scrollTop+=d:"E"==a&&(g.scrollLeft+=d);b.update();e.updateSelection()};var j=ORYX.Core.Command.extend({construct:function(a,d,f){this.position=a;this.extentionSize=d;this.facade=f},execute:function(){resizeCanvas(this.position,this.extentionSize,this.facade)},rollback:function(){resizeCanvas(this.position,-this.extentionSize,this.facade)},update:function(){}}),e=ORYX.CONFIG.CANVAS_RESIZE_INTERVAL;d&&(e=-e);this.facade.executeCommands([new j(f,e,this.facade)])}});
ORYX.Plugins.CanvasResizeButton=Clazz.extend({construct:function(f,d,j){this.canvas=f;var e=f.getHTMLContainer().parentNode.parentNode.parentNode;window.myParent=e;var a=e.firstChild,m=a.firstChild.firstChild,k=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",e,["div",{"class":"canvas_resize_indicator canvas_resize_indicator_grow "+d,title:ORYX.I18N.RESIZE.tipGrow+ORYX.I18N.RESIZE[d]}]),b=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",e,["div",{"class":"canvas_resize_indicator canvas_resize_indicator_shrink "+
d,title:ORYX.I18N.RESIZE.tipShrink+ORYX.I18N.RESIZE[d]}]),n=function(c){if(c.target!=e&&c.target!=a&&c.target!=a.firstChild&&c.target!=m&&c.target!=a)return!1;var b=c.layerX,c=c.layerY;if(0>b-a.scrollLeft||Ext.isSafari)b+=a.scrollLeft;if(0>c-a.scrollTop||Ext.isSafari)c+=a.scrollTop;if("N"==d)return c<60+a.firstChild.offsetTop;if("W"==d)return b<60+a.firstChild.offsetLeft;if("E"==d)return c=a.offsetWidth-(a.firstChild.offsetLeft+a.firstChild.offsetWidth),0>c&&(c=0),b>a.scrollWidth-c-60;return"S"==
d?(b=a.offsetHeight-(a.firstChild.offsetTop+a.firstChild.offsetHeight),0>b&&(b=0),c>a.scrollHeight-b-60):!1},g=function(){k.show();var c,a,e,g;try{var h=this.canvas.getRootNode().childNodes[1].getBBox();c=h.x;a=h.y;e=h.x+h.width;g=h.y+h.height}catch(i){this.canvas.getChildShapes(!0).each(function(b){var d=b.absoluteBounds(),b=d.upperLeft(),d=d.lowerRight();void 0==c?(c=b.x,a=b.y,e=d.x,g=d.y):(c=Math.min(c,b.x),a=Math.min(a,b.y),e=Math.max(e,d.x),g=Math.max(g,d.y))})}var h=f.bounds.width(),j=f.bounds.height(),
l=0==f.getChildNodes().size();"N"==d&&(a>ORYX.CONFIG.CANVAS_RESIZE_INTERVAL||l&&j>ORYX.CONFIG.CANVAS_RESIZE_INTERVAL)?b.show():"E"==d&&h-e>ORYX.CONFIG.CANVAS_RESIZE_INTERVAL?b.show():"S"==d&&j-g>ORYX.CONFIG.CANVAS_RESIZE_INTERVAL?b.show():"W"==d&&(c>ORYX.CONFIG.CANVAS_RESIZE_INTERVAL||l&&h>ORYX.CONFIG.CANVAS_RESIZE_INTERVAL)?b.show():b.hide()}.bind(this),i=function(){k.hide();b.hide()};a.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,function(a){n(a)?g():i()},!1);k.addEventListener(ORYX.CONFIG.EVENT_MOUSEOVER,
function(){g()},!0);b.addEventListener(ORYX.CONFIG.EVENT_MOUSEOVER,function(){g()},!0);e.addEventListener(ORYX.CONFIG.EVENT_MOUSEOUT,function(){i()},!0);i();k.addEventListener("click",function(){j(d);g()},!0);b.addEventListener("click",function(){j(d,!0);g()},!0)}});
/* ORYX.Plugins.View */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.View={facade:void 0,diffEditor:void 0,diffDialog:void 0,construct:function(b,a){this.facade=b;this.facade.registerOnEvent(ORYX.CONFIG.VOICE_COMMAND_GENERATE_FORMS,this.generateTaskForms.bind(this));this.facade.registerOnEvent(ORYX.CONFIG.VOICE_COMMAND_GENERATE_IMAGE,this.showAsPNG.bind(this));this.facade.registerOnEvent(ORYX.CONFIG.VOICE_COMMAND_VIEW_SOURCE,this.showProcessBPMN.bind(this));this.zoomLevel=1;this.maxFitToScreenLevel=1.5;this.minZoomLevel=0.4;this.maxZoomLevel=2;this.diff=
5;a.properties&&a.properties.each(function(a){a.zoomLevel&&(this.zoomLevel=Number(1));a.maxFitToScreenLevel&&(this.maxFitToScreenLevel=Number(a.maxFitToScreenLevel));a.minZoomLevel&&(this.minZoomLevel=Number(a.minZoomLevel));a.maxZoomLevel&&(this.maxZoomLevel=Number(a.maxZoomLevel))}.bind(this));this.facade.offer({name:ORYX.I18N.View.zoomIn,functionality:this.zoom.bind(this,[1+ORYX.CONFIG.ZOOM_OFFSET]),group:ORYX.I18N.View.group,icon:ORYX.PATH+"images/magnifier_zoom_in.png",description:ORYX.I18N.View.zoomInDesc,
index:1,minShape:0,maxShape:0,isEnabled:function(){return this.zoomLevel<this.maxZoomLevel}.bind(this)});this.facade.offer({name:ORYX.I18N.View.zoomOut,functionality:this.zoom.bind(this,[1-ORYX.CONFIG.ZOOM_OFFSET]),group:ORYX.I18N.View.group,icon:ORYX.PATH+"images/magnifier_zoom_out.png",description:ORYX.I18N.View.zoomOutDesc,index:2,minShape:0,maxShape:0,isEnabled:function(){return this._checkSize()}.bind(this)});this.facade.offer({name:ORYX.I18N.View.zoomStandard,functionality:this.setAFixZoomLevel.bind(this,
1),group:ORYX.I18N.View.group,icon:ORYX.PATH+"images/zoom_standard.png",cls:"icon-large",description:ORYX.I18N.View.zoomStandardDesc,index:3,minShape:0,maxShape:0,isEnabled:function(){return 1!=this.zoomLevel}.bind(this)});this.facade.offer({name:ORYX.I18N.View.zoomFitToModel,functionality:this.zoomFitToModel.bind(this),group:ORYX.I18N.View.group,icon:ORYX.PATH+"images/image.png",description:ORYX.I18N.View.zoomFitToModelDesc,index:4,minShape:0,maxShape:0});this.facade.offer({name:"Show in full screen",
functionality:this.showInFullScreen.bind(this),group:ORYX.I18N.View.jbpmgroup,icon:ORYX.PATH+"images/fullscreen.png",description:ORYX.I18N.View.FullScreenMode,index:2,minShape:0,maxShape:0,isEnabled:function(){profileParamName="profile";profileParamName=profileParamName.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");regexSa="[\\?&]"+profileParamName+"=([^&#]*)";regexa=RegExp(regexSa);profileParams=regexa.exec(window.location.href);profileParamValue=profileParams[1];return"jbpm"==profileParamValue}.bind(this)});
this.facade.offer({name:"ViewBPMN2Button",functionality:this.showProcessBPMN.bind(this),group:"footerViewSourceButton",text:"BPMN2",description:"View BPMN2 Source",index:1,minShape:0,maxShape:0,isEnabled:function(){profileParamName="profile";profileParamName=profileParamName.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");regexSa="[\\?&]"+profileParamName+"=([^&#]*)";regexa=RegExp(regexSa);profileParams=regexa.exec(window.location.href);profileParamValue=profileParams[1];return"jbpm"==profileParamValue}.bind(this)});
this.facade.offer({name:"ViewJSONButton",functionality:this.showProcessJSON.bind(this),group:"footerViewJSONButton",text:"JSON",description:"View JSON Source",index:2,minShape:0,maxShape:0,isEnabled:function(){profileParamName="profile";profileParamName=profileParamName.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");regexSa="[\\?&]"+profileParamName+"=([^&#]*)";regexa=RegExp(regexSa);profileParams=regexa.exec(window.location.href);profileParamValue=profileParams[1];return"jbpm"==profileParamValue}.bind(this)});
this.facade.offer({name:"ViewSVGButton",functionality:this.showProcessSVG.bind(this),group:"footerViewSVGButton",text:"SVG",description:"View SVG Source",index:3,minShape:0,maxShape:0,isEnabled:function(){profileParamName="profile";profileParamName=profileParamName.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");regexSa="[\\?&]"+profileParamName+"=([^&#]*)";regexa=RegExp(regexSa);profileParams=regexa.exec(window.location.href);profileParamValue=profileParams[1];return"jbpm"==profileParamValue}.bind(this)});
this.facade.offer({name:"ViewPNGButton",functionality:this.showAsPNG.bind(this),group:"footerViewPNGButton",text:"PNG",description:"View PNG",index:6,minShape:0,maxShape:0,isEnabled:function(){profileParamName="profile";profileParamName=profileParamName.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");regexSa="[\\?&]"+profileParamName+"=([^&#]*)";regexa=RegExp(regexSa);profileParams=regexa.exec(window.location.href);profileParamValue=profileParams[1];return"jbpm"==profileParamValue}.bind(this)})},setAFixZoomLevel:function(b){this.zoomLevel=
b;this._checkZoomLevelRange();this.zoom(1)},showInPopout:function(){uuidParamName="uuid";uuidParamName=uuidParamName.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");regexS="[\\?&]"+uuidParamName+"=([^&#]*)";regex=RegExp(regexS);uuidParams=regex.exec(window.location.href);uuidParamValue=uuidParams[1];window.open(ORYX.EXTERNAL_PROTOCOL+"://"+ORYX.EXTERNAL_HOST+"/"+ORYX.EXTERNAL_SUBDOMAIN+"/org.drools.guvnor.Guvnor/standaloneEditorServlet?assetsUUIDs="+uuidParamValue+"&client=oryx","Process Editor","status=0,toolbar=0,menubar=0,resizable=0,location=no,width=1400,height=1000")},
showInFullScreen:function(){this.goFullscreen("jbpmdesigner")},importFromBPMN2:function(){var b=new Ext.form.FormPanel({baseCls:"x-plain",labelWidth:50,defaultType:"textfield",items:[{text:ORYX.I18N.FromBPMN2Support.selectFile,style:"font-size:12px;margin-bottom:10px;display:block;",anchor:"100%",xtype:"label"},{fieldLabel:ORYX.I18N.FromBPMN2Support.file,name:"subject",inputType:"file",style:"margin-bottom:10px;display:block;",itemCls:"ext_specific_window_overflow"},{xtype:"textarea",hideLabel:!0,
name:"msg",anchor:"100% -63"}]}),a=new Ext.Window({autoCreate:!0,layout:"fit",plain:!0,bodyStyle:"padding:5px;",title:ORYX.I18N.FromBPMN2Support.impBPMN2,height:350,width:500,modal:!0,fixedcenter:!0,shadow:!0,proxyDrag:!0,resizable:!0,items:[b],buttons:[{text:ORYX.I18N.FromBPMN2Support.impBtn,handler:function(){var c=new Ext.LoadMask(Ext.getBody(),{msg:ORYX.I18N.FromBPMN2Support.impProgress});c.show();var d=b.items.items[2].getValue();Ext.Ajax.request({url:ORYX.PATH+"transformer",method:"POST",success:function(b){if(1>
b.responseText.length)c.hide(),a.hide(),Ext.Msg.minWidth=400,Ext.Msg.alert("Failed to import BPMN2. Check server logs for more details.");else{try{this._loadJSON(b.responseText)}catch(d){Ext.Msg.minWidth=400,Ext.Msg.alert("Failed to import BPMN2: "+d)}c.hide();a.hide()}}.createDelegate(this),failure:function(){c.hide();Ext.Msg.minWidth=400;Ext.Msg.alert("Failed to import BPMN2.")},params:{profile:ORYX.PROFILE,uuid:ORYX.UUID,pp:ORYX.PREPROCESSING,bpmn2:d,transformto:"bpmn2json",uuid:ORYX.UUID}})}.bind(this)},
{text:ORYX.I18N.FromBPMN2Support.close,handler:function(){a.hide()}.bind(this)}]});a.on("hide",function(){a.destroy(!0);delete a});a.show();b.items.items[1].getEl().dom.addEventListener("change",function(a){var d=new FileReader;d.onload=function(a){b.items.items[2].setValue(a.target.result)};d.readAsText(a.target.files[0],"UTF-8")},!0)},importFromJSON:function(){var b=new Ext.form.FormPanel({baseCls:"x-plain",labelWidth:50,defaultType:"textfield",items:[{text:ORYX.I18N.FromJSONSupport.selectFile,
style:"font-size:12px;margin-bottom:10px;display:block;",anchor:"100%",xtype:"label"},{fieldLabel:ORYX.I18N.FromJSONSupport.file,name:"subject",inputType:"file",style:"margin-bottom:10px;display:block;",itemCls:"ext_specific_window_overflow"},{xtype:"textarea",hideLabel:!0,name:"msg",anchor:"100% -63"}]}),a=new Ext.Window({autoCreate:!0,layout:"fit",plain:!0,bodyStyle:"padding:5px;",title:ORYX.I18N.FromJSONSupport.impBPMN2,height:350,width:500,modal:!0,fixedcenter:!0,shadow:!0,proxyDrag:!0,resizable:!0,
items:[b],buttons:[{text:ORYX.I18N.FromJSONSupport.impBtn,handler:function(){var c=new Ext.LoadMask(Ext.getBody(),{msg:ORYX.I18N.FromJSONSupport.impProgress});c.show();var d=b.items.items[2].getValue();try{this._loadJSON(d)}catch(e){Ext.Msg.alert("Failed to import JSON :\n"+e)}c.hide();a.hide()}.bind(this)},{text:ORYX.I18N.FromJSONSupport.close,handler:function(){a.hide()}.bind(this)}]});a.on("hide",function(){a.destroy(!0);delete a});a.show();b.items.items[1].getEl().dom.addEventListener("change",
function(a){var d=new FileReader;d.onload=function(a){b.items.items[2].setValue(a.target.result)};d.readAsText(a.target.files[0],"UTF-8")},!0)},shareEmbeddableProcess:function(){Ext.Ajax.request({url:ORYX.PATH+"transformer",method:"POST",success:function(b){try{var a=new Ext.form.TextArea({id:"sharedEmbeddableArea",fieldLabel:"Embeddable Process",width:400,height:250,value:b.responseText});(new Ext.Window({width:400,id:"sharedEmbeddableURL",height:250,autoScroll:!0,title:"Embeddable Process",items:[a]})).show()}catch(c){Ext.Msg.alert("Failed to create embeddable process code :\n"+
c)}Ext.Msg.hide()}.createDelegate(this),failure:function(){Ext.Msg.alert("Failed to create embeddable process code.")},params:{profile:ORYX.PROFILE,uuid:ORYX.UUID,respaction:"showembeddable"}})},shareProcessPdf:function(){var b=new Ext.LoadMask(Ext.getBody(),{msg:"Creating the process PDF..."});b.show();var a=DataManager.serialize(ORYX.EDITOR.getCanvas().getSVGRepresentation(!1)),c=DataManager.serialize(ORYX.EDITOR.getCanvas().getRootNode().cloneNode(!0));Ext.Ajax.request({url:ORYX.PATH+"transformer",
method:"POST",success:function(a){try{b.hide();var c=new Ext.form.TextArea({id:"sharedPDFArea",fieldLabel:"Process Image PDF",width:400,height:250,value:a.responseText});(new Ext.Window({width:400,id:"sharedPDFURL",height:250,autoScroll:!0,title:"Process PDF URL",items:[c]})).show()}catch(f){b.hide(),Ext.Msg.alert("Failed to create the process PDF :\n"+f)}Ext.Msg.hide()}.createDelegate(this),failure:function(){b.hide();Ext.Msg.alert("Failed to create the process PDF.")},params:{profile:ORYX.PROFILE,
uuid:ORYX.UUID,fsvg:a,rsvg:c,transformto:"pdf",respaction:"showurl"}})},shareProcessImage:function(){var b=new Ext.LoadMask(Ext.getBody(),{msg:"Creating the process image..."});b.show();var a=DataManager.serialize(ORYX.EDITOR.getCanvas().getSVGRepresentation(!1)),c=DataManager.serialize(ORYX.EDITOR.getCanvas().getRootNode().cloneNode(!0));Ext.Ajax.request({url:ORYX.PATH+"transformer",method:"POST",success:function(a){try{b.hide();var c=new Ext.form.TextArea({id:"sharedImageArea",fieldLabel:"Process Image URL",
width:400,height:250,value:a.responseText});(new Ext.Window({width:400,id:"sharedImageURL",height:250,autoScroll:!0,title:"Process Image URL",items:[c]})).show()}catch(f){b.hide(),Ext.Msg.alert("Failed to create the process image :\n"+f)}Ext.Msg.hide()}.createDelegate(this),failure:function(){b.hide();Ext.Msg.alert("Failed to create the process image.")},params:{profile:ORYX.PROFILE,uuid:ORYX.UUID,fsvg:a,rsvg:c,transformto:"png",respaction:"showurl"}})},shareProcess:function(){alert("sharing process")},
diffprocess:function(){var b=new Ext.LoadMask(Ext.getBody(),{msg:ORYX.I18N.View.viewDiffLoadingVersions});b.show();Ext.Ajax.request({url:ORYX.PATH+"processdiff",method:"POST",success:function(a){try{b.hide(),this._showProcessDiffDialog(a.responseText)}catch(c){b.hide(),Ext.Msg.alert("Failed to retrieve process version information:\n"+c)}}.createDelegate(this),failure:function(){b.hide();Ext.Msg.alert("Failed to retrieve process version information.")},params:{action:"versions",profile:ORYX.PROFILE,
uuid:ORYX.UUID}})},_showProcessDiffDialog:function(b){var a=b.evalJSON(),b=[],c=0,d;for(d in a)a.hasOwnProperty(d)&&(b.push(parseInt(d)),c++);if(0==c)Ext.Msg.minWidth=300,Ext.Msg.alert("Diff","Unable to find proces versions.");else{b.sort(function(a,b){return a-b});d=[];for(a=0;a<b.length;a++)d[a]=[b[a]+""];b=new Ext.data.SimpleStore({fields:["name"],data:d});b=new Ext.form.ComboBox({fieldLabel:"Select process version",labelStyle:"width:180px",hiddenName:"version_name",emptyText:"Select process version...",
store:b,displayField:"name",valueField:"name",mode:"local",typeAhead:!0,triggerAction:"all",listeners:{select:{fn:function(a){var b=ORYX.EDITOR.getSerializedJSON();Ext.Ajax.request({url:ORYX.PATH+"uuidRepository",method:"POST",success:function(b){try{var c=b.responseText;Ext.Ajax.request({url:ORYX.PATH+"processdiff",method:"POST",success:function(a){try{var b=new Ext.LoadMask(Ext.getBody(),{msg:"Creating diff..."});b.show();var d=a.responseText,f=new diff_match_patch;f.Diff_Timeout=0;var e=f.diff_main(d,
c);f.diff_cleanupSemantic(e);var g=f.diff_prettyHtml(e);b.hide();this.diffDialog.remove(this.diffEditor,!0);this.diffEditor=new Ext.form.HtmlEditor({id:"diffeditor",value:g,enableSourceEdit:!1,enableAlignments:!1,enableColors:!1,enableFont:!1,enableFontSize:!1,enableFormat:!1,enableLinks:!1,enableLists:!1,autoScroll:!0,width:520,height:310});this.diffDialog.add(this.diffEditor);this.diffDialog.doLayout()}catch(h){Ext.Msg.alert("Failed to retrieve process version source:\n"+h)}}.bind(this),failure:function(){Ext.Msg.alert("Failed to retrieve process version source.")}.bind(this),
params:{action:"getversion",version:a.getValue(),profile:ORYX.PROFILE,uuid:ORYX.UUID}})}catch(d){Ext.Msg.alert("Converting to BPMN2 Failed :\n"+d)}}.bind(this),failure:function(){Ext.Msg.alert("Converting to BPMN2 Failed")},params:{action:"toXML",pp:ORYX.PREPROCESSING,profile:ORYX.PROFILE,data:b}})}.bind(this)}}});this.diffEditor=new Ext.form.HtmlEditor({id:"diffeditor",value:"",enableSourceEdit:!1,enableAlignments:!1,enableColors:!1,enableFont:!1,enableFontSize:!1,enableFormat:!1,enableLinks:!1,
enableLists:!1,autoScroll:!0,width:520,height:310});this.diffDialog=new Ext.Window({autoCreate:!0,autoScroll:!1,plain:!0,bodyStyle:"padding:5px;",title:"Compare process BPMN2 with previous versions",height:410,width:550,modal:!0,fixedcenter:!0,shadow:!0,proxyDrag:!0,resizable:!0,items:[this.diffEditor],tbar:[b],buttons:[{text:"Close",handler:function(){this.diffDialog.hide()}.bind(this)}]});this.diffDialog.show();this.diffDialog.doLayout()}},_loadJSON:function(b){b?(b.evalJSON(),this.facade.importJSON(b)):
this._showErrorMessageBox(ORYX.I18N.Oryx.title,ORYX.I18N.jPDLSupport.impFailedJson)},_showErrorMessageBox:function(b,a){Ext.MessageBox.show({title:b,msg:a,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})},showAsPDF:function(){var b=DataManager.serialize(ORYX.EDITOR.getCanvas().getSVGRepresentation(!1)),a=DataManager.serialize(ORYX.EDITOR.getCanvas().getRootNode().cloneNode(!0)),c=document.createElement("form");c.setAttribute("name","transformerform");c.setAttribute("method","post");c.setAttribute("action",
ORYX.CONFIG.TRANSFORMER_URL());c.setAttribute("target","_blank");var d=document.createElement("input");d.setAttribute("type","hidden");d.setAttribute("name","fsvg");d.setAttribute("value",b);c.appendChild(d);b=document.createElement("input");b.setAttribute("type","hidden");b.setAttribute("name","rsvg");b.setAttribute("value",a);c.appendChild(b);a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("name","uuid");a.setAttribute("value",ORYX.UUID);c.appendChild(a);a=document.createElement("input");
a.setAttribute("type","hidden");a.setAttribute("name","profile");a.setAttribute("value",ORYX.PROFILE);c.appendChild(a);a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("name","transformto");a.setAttribute("value","pdf");c.appendChild(a);a=ORYX.EDITOR.getSerializedJSON();a=jsonPath(a.evalJSON(),"$.properties.id");b=document.createElement("input");b.setAttribute("type","hidden");b.setAttribute("name","processid");b.setAttribute("value",a);c.appendChild(b);document.body.appendChild(c);
c.submit()},showProcessSVG:function(){var b=DataManager.serialize(ORYX.EDITOR.getCanvas().getSVGRepresentation(!1)),a=new Ext.form.TextArea({id:"svgSourceTextArea",fieldLabel:"SVG Source",value:b,autoScroll:!0}),c=new Ext.Window({width:600,id:"processSVGSource",height:550,layout:"fit",title:"Process SVG Source",items:[a],buttons:[{text:"Close",handler:function(){c.close();a=c=null}.bind(this)}]});c.show();this.foldFunc=CodeMirror.newFoldFunction(CodeMirror.tagRangeFinder);CodeMirror.fromTextArea(document.getElementById("svgSourceTextArea"),
{mode:"application/xml",lineNumbers:!0,lineWrapping:!0,onGutterClick:this.foldFunc})},showProcessERDF:function(){var b=ORYX.EDITOR.getERDF(),a=new Ext.form.TextArea({id:"erdfSourceTextArea",fieldLabel:"ERDF Source",value:b,autoScroll:!0,height:"80%"}),c=new Ext.Window({width:600,id:"processERDFSource",height:550,layout:"fit",title:"ERDF Source",items:[a],buttons:[{text:"Close",handler:function(){c.close();a=c=null}.bind(this)}]});c.show();this.foldFunc=CodeMirror.newFoldFunction(CodeMirror.tagRangeFinder);
CodeMirror.fromTextArea(document.getElementById("erdfSourceTextArea"),{mode:"application/xml",lineNumbers:!0,lineWrapping:!0,onGutterClick:this.foldFunc})},showProcessJSON:function(){var b=ORYX.EDITOR.getSerializedJSON(),a=new Ext.form.TextArea({id:"jsonSourceTextArea",fieldLabel:"JSON Source",value:b,autoScroll:!0}),c=new Ext.Window({width:600,id:"processJSONSource",height:550,layout:"fit",title:"JSON Source",items:[a],buttons:[{text:"Close",handler:function(){c.close();a=c=null}.bind(this)}]});
c.show();this.foldFunc=CodeMirror.newFoldFunction(CodeMirror.braceRangeFinder);CodeMirror.fromTextArea(document.getElementById("jsonSourceTextArea"),{mode:"application/json",lineNumbers:!0,lineWrapping:!0,onGutterClick:this.foldFunc})},showProcessBPMN:function(){var b=ORYX.EDITOR.getSerializedJSON();Ext.Ajax.request({url:ORYX.PATH+"uuidRepository",method:"POST",success:function(a){try{var b=new Ext.form.TextArea({id:"bpmnSourceTextArea",fieldLabel:"BPMN2 Source",value:a.responseText,autoScroll:!0}),
d=new Ext.Window({width:600,id:"processBPMNSource",height:550,layout:"fit",title:"BPMN2 Source",items:[b],buttons:[{text:"Save to file",handler:function(){var a=ORYX.EDITOR.getSerializedJSON(),d=jsonPath(a.evalJSON(),"$.properties.name"),e=jsonPath(a.evalJSON(),"$.properties.package"),g=jsonPath(a.evalJSON(),"$.properties.version"),a="";e&&""!=e&&(a+=e);d&&""!=d&&(""!=a&&(a+="."),a+=d);g&&""!=g&&(""!=a&&(a+="."),a+="v"+g);""==a&&(a="processbpmn2");d=b.getValue();e=document.createElement("form");e.setAttribute("name",
"storetofileform");e.setAttribute("method","post");e.setAttribute("action",ORYX.PATH+"filestore");e.setAttribute("target","_blank");g=document.createElement("input");g.setAttribute("type","hidden");g.setAttribute("name","fname");g.setAttribute("value",a);e.appendChild(g);a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("name","fext");a.setAttribute("value","bpmn2");e.appendChild(a);a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("name",
"data");a.setAttribute("value",d);e.appendChild(a);document.body.appendChild(e);e.submit()}},{text:"Close",handler:function(){d.close();b=d=null}.bind(this)}]});d.show();this.foldFunc=CodeMirror.newFoldFunction(CodeMirror.tagRangeFinder);CodeMirror.fromTextArea(document.getElementById("bpmnSourceTextArea"),{mode:"application/xml",lineNumbers:!0,lineWrapping:!0,onGutterClick:this.foldFunc})}catch(e){Ext.Msg.alert("Converting to BPMN2 Failed :\n"+e)}Ext.Msg.hide()}.createDelegate(this),failure:function(){Ext.Msg.alert("Converting to BPMN2 Failed")},
params:{action:"toXML",pp:ORYX.PREPROCESSING,profile:ORYX.PROFILE,data:b}})},showAsPNG:function(){var b=DataManager.serialize(ORYX.EDITOR.getCanvas().getSVGRepresentation(!1)),a=DataManager.serialize(ORYX.EDITOR.getCanvas().getRootNode().cloneNode(!0)),c=document.createElement("form");c.setAttribute("name","transformerform");c.setAttribute("method","post");c.setAttribute("action",ORYX.CONFIG.TRANSFORMER_URL());c.setAttribute("target","_blank");var d=document.createElement("input");d.setAttribute("type",
"hidden");d.setAttribute("name","fsvg");d.setAttribute("value",b);c.appendChild(d);b=document.createElement("input");b.setAttribute("type","hidden");b.setAttribute("name","rsvg");b.setAttribute("value",a);c.appendChild(b);a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("name","uuid");a.setAttribute("value",ORYX.UUID);c.appendChild(a);a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("name","profile");a.setAttribute("value",ORYX.PROFILE);
c.appendChild(a);a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("name","transformto");a.setAttribute("value","png");c.appendChild(a);a=ORYX.EDITOR.getSerializedJSON();a=jsonPath(a.evalJSON(),"$.properties.id");b=document.createElement("input");b.setAttribute("type","hidden");b.setAttribute("name","processid");b.setAttribute("value",a);c.appendChild(b);document.body.appendChild(c);c.submit()},generateTaskForms:function(){var b=ORYX.EDITOR.getSerializedJSON(),a=ORYX.PREPROCESSING,
c=document.createElement("form");c.setAttribute("name","taskformsform");c.setAttribute("method","post");c.setAttribute("action",ORYX.CONFIG.TASKFORMS_URL());c.setAttribute("target","_blank");var d=document.createElement("input");d.setAttribute("type","hidden");d.setAttribute("name","json");d.setAttribute("value",b);c.appendChild(d);d=document.createElement("input");d.setAttribute("type","hidden");d.setAttribute("name","ppdata");d.setAttribute("value",a);c.appendChild(d);b=document.createElement("input");
b.setAttribute("type","hidden");b.setAttribute("name","uuid");b.setAttribute("value",ORYX.UUID);c.appendChild(b);b=document.createElement("input");b.setAttribute("type","hidden");b.setAttribute("name","profile");b.setAttribute("value",ORYX.PROFILE);c.appendChild(b);document.body.appendChild(c);c.submit()},zoom:function(b){this.zoomLevel*=b;var b=this.facade.getCanvas().getHTMLContainer().parentNode.parentNode,a=this.facade.getCanvas(),c=a.bounds.width()*this.zoomLevel,d=a.bounds.height()*this.zoomLevel,
e=(a.node.parentNode.parentNode.parentNode.offsetHeight-d)/2,e=20<e?e-20:0;a.node.parentNode.parentNode.style.marginTop=e+"px";e+=5;a.getHTMLContainer().style.top=e+"px";var e=b.scrollTop-Math.round((a.getHTMLContainer().parentNode.getHeight()-d)/2)+this.diff,f=b.scrollLeft-Math.round((a.getHTMLContainer().parentNode.getWidth()-c)/2)+this.diff;a.setSize({width:c,height:d},!0);a.node.setAttributeNS(null,"transform","scale("+this.zoomLevel+")");this.facade.updateSelection();b.scrollTop=e;b.scrollLeft=
f;a.zoomLevel=this.zoomLevel},zoomFitToModel:function(){var b=this.facade.getCanvas().getHTMLContainer().parentNode.parentNode,a=b.getHeight()-30,c=b.getWidth()-30,d=this.facade.getCanvas().getChildShapes();if(!d||1>d.length)return!1;var e=d[0].absoluteBounds().clone();d.each(function(a){e.include(a.absoluteBounds().clone())});c/=e.width();a/=e.height();a=a<c?a:c;a>this.maxFitToScreenLevel&&(a=this.maxFitToScreenLevel);this.setAFixZoomLevel(a);b.scrollTop=Math.round(e.upperLeft().y*this.zoomLevel)-
5;b.scrollLeft=Math.round(e.upperLeft().x*this.zoomLevel)-5},_checkSize:function(){var b=this.facade.getCanvas().getHTMLContainer().parentNode;return 0.7>Math.min(b.parentNode.getWidth()/b.getWidth(),b.parentNode.getHeight()/b.getHeight())},_checkZoomLevelRange:function(){this.zoomLevel<this.minZoomLevel&&(this.zoomLevel=this.minZoomLevel);this.zoomLevel>this.maxZoomLevel&&(this.zoomLevel=this.maxZoomLevel)},goFullscreen:function(b){if(parent&&parent.frames)if(2>parent.frames.length){var a=document.getElementById(b);
a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen?a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):(Ext.Msg.minWidth=400,Ext.Msg.alert("Browser does not support full screen mode."))}else{if(parent.frameElement){var c=parent.frameElement;c.setAttribute("allowFullScreen","true");c.setAttribute("mozallowfullscreen","true");c.setAttribute("webkitallowfullscreen","true")}for(c=0;c<parent.frames.length;c++)parent.frames[c].ORYX&&(a=
parent.frames[c].frameElement,a.setAttribute("allowFullScreen","true"),a.setAttribute("mozallowfullscreen","true"),a.setAttribute("webkitallowfullscreen","true"),a=a.contentDocument.getElementById(b),a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen?a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):(Ext.Msg.minWidth=400,Ext.Msg.alert("Browser does not support full screen mode.")))}}};ORYX.Plugins.View=Clazz.extend(ORYX.Plugins.View);
/* ORYX.Plugins.DragDropResize */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.DragDropResize=ORYX.Plugins.AbstractPlugin.extend({construct:function(a){this.facade=a;this.currentShapes=[];this.toMoveShapes=[];this.distPoints=[];this.dragIntialized=this.dragEnable=this.isResizing=!1;this.edgesMovable=!0;this.offSetPosition={x:0,y:0};this.faktorXY={x:1,y:1};this.containmentParentNode;this.isAttachingAllowed=this.isAddingAllowed=!1;this.callbackMouseMove=this.handleMouseMove.bind(this);this.callbackMouseUp=this.handleMouseUp.bind(this);a=this.facade.getCanvas().getSvgContainer();
this.selectedRect=new ORYX.Plugins.SelectedRect(a);ORYX.CONFIG.SHOW_GRIDLINE&&(this.vLine=new ORYX.Plugins.GridLine(a,ORYX.Plugins.GridLine.DIR_VERTICAL),this.hLine=new ORYX.Plugins.GridLine(a,ORYX.Plugins.GridLine.DIR_HORIZONTAL));a=this.facade.getCanvas().getHTMLContainer();this.scrollNode=this.facade.getCanvas().rootNode.parentNode.parentNode;this.resizerSE=new ORYX.Plugins.Resizer(a,"southeast",this.facade);this.resizerSE.registerOnResize(this.onResize.bind(this));this.resizerSE.registerOnResizeEnd(this.onResizeEnd.bind(this));
this.resizerSE.registerOnResizeStart(this.onResizeStart.bind(this));this.resizerNW=new ORYX.Plugins.Resizer(a,"northwest",this.facade);this.resizerNW.registerOnResize(this.onResize.bind(this));this.resizerNW.registerOnResizeEnd(this.onResizeEnd.bind(this));this.resizerNW.registerOnResizeStart(this.onResizeStart.bind(this));this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this))},handleMouseDown:function(a,b){if(this.dragBounds&&this.currentShapes.member(b)&&this.toMoveShapes.length){this.edgesMovable=
this.dragIntialized=this.dragEnable=!0;var c=this.facade.getCanvas().node.getScreenCTM();this.faktorXY.x=c.a;this.faktorXY.y=c.d;c=this.dragBounds.upperLeft();this.offSetPosition={x:Event.pointerX(a)-c.x*this.faktorXY.x,y:Event.pointerY(a)-c.y*this.faktorXY.y};this.offsetScroll={x:this.scrollNode.scrollLeft,y:this.scrollNode.scrollTop};document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.callbackMouseMove,!1);document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,
this.callbackMouseUp,!0)}},handleMouseUp:function(a){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"dragdropresize.contain"});this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"dragdropresize.attached"});if(this.dragEnable){if(!this.dragIntialized){this.afterDrag();if(this.isAttachingAllowed&&1==this.toMoveShapes.length&&this.toMoveShapes[0]instanceof ORYX.Core.Node&&0<this.toMoveShapes[0].dockers.length){var a=this.facade.eventCoordinates(a),b=
this.toMoveShapes[0].dockers[0];this.facade.executeCommands([new (ORYX.Core.Command.extend({construct:function(a,b,e,f){this.docker=a;this.newPosition=b;this.newDockedShape=e;this.newParent=e.parent||f.getCanvas();this.oldPosition=a.parent.bounds.center();this.oldDockedShape=a.getDockedShape();this.oldParent=a.parent.parent||f.getCanvas();this.facade=f;this.oldDockedShape&&(this.oldPosition=a.parent.absoluteBounds().center())},execute:function(){this.dock(this.newDockedShape,this.newParent,this.newPosition);
this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_ARRANGEMENT_TOP,excludeCommand:!0})},rollback:function(){this.dock(this.oldDockedShape,this.oldParent,this.oldPosition)},dock:function(a,b,e){b.add(this.docker.parent);this.docker.setDockedShape(void 0);this.docker.bounds.centerMoveTo(e);this.docker.setDockedShape(a);this.facade.setSelection([this.docker.parent]);this.facade.getCanvas().update();this.facade.updateSelection()}}))(b,a,this.containmentParentNode,this.facade)])}else this.isAddingAllowed&&
this.refreshSelectedShapes();this.facade.updateSelection();this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_DRAGDROP_END})}this.vLine&&this.vLine.hide();this.hLine&&this.hLine.hide()}this.dragEnable=!1;document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.callbackMouseUp,!0);document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.callbackMouseMove,!1)},handleMouseMove:function(a){if(this.dragEnable){this.dragIntialized&&(this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_DRAGDROP_START}),
this.dragIntialized=!1,this.resizerSE.hide(),this.resizerNW.hide(),this._onlyEdges=this.currentShapes.all(function(a){return a instanceof ORYX.Core.Edge}),this.beforeDrag(),this._currentUnderlyingNodes=[]);var b={x:Event.pointerX(a)-this.offSetPosition.x,y:Event.pointerY(a)-this.offSetPosition.y};b.x-=this.offsetScroll.x-this.scrollNode.scrollLeft;b.y-=this.offsetScroll.y-this.scrollNode.scrollTop;var c=a.shiftKey||a.ctrlKey;ORYX.CONFIG.GRID_ENABLED&&!c?b=this.snapToGrid(b):(this.vLine&&this.vLine.hide(),
this.hLine&&this.hLine.hide());b.x/=this.faktorXY.x;b.y/=this.faktorXY.y;b.x=Math.max(0,b.x);b.y=Math.max(0,b.y);c=this.facade.getCanvas();b.x=Math.min(c.bounds.width()-this.dragBounds.width(),b.x);b.y=Math.min(c.bounds.height()-this.dragBounds.height(),b.y);offset={x:b.x-this.dragBounds.upperLeft().x,y:b.y-this.dragBounds.upperLeft().y};this.dragBounds.moveBy(offset);this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_DRAG_TRACKER_DRAG,shapes:this.currentShapes,bounds:this.dragBounds});this.resizeRectangle(this.dragBounds);
this.isAttachingAllowed=!1;b=$A(this.facade.getCanvas().getAbstractShapesAtPosition(this.facade.eventCoordinates(a)));if((c=(c=1==this.toMoveShapes.length&&this.toMoveShapes[0]instanceof ORYX.Core.Node&&0<this.toMoveShapes[0].dockers.length)&&1!=b.length)||!(b.length===this._currentUnderlyingNodes.length&&b.all(function(a,b){return this._currentUnderlyingNodes[b]===a}.bind(this))))this._onlyEdges?(this.isAddingAllowed=!0,this.containmentParentNode=this.facade.getCanvas()):this.checkRules({event:a,
underlyingNodes:b,checkIfAttachable:c}),this._currentUnderlyingNodes=b.reverse(),this.isAttachingAllowed?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"dragdropresize.attached",elements:[this.containmentParentNode],style:ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_RECTANGLE,color:ORYX.CONFIG.SELECTION_VALID_COLOR}):this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"dragdropresize.attached"}),this.isAttachingAllowed?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,
highlightId:"dragdropresize.contain"}):this.isAddingAllowed?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"dragdropresize.contain",elements:[this.containmentParentNode],color:ORYX.CONFIG.SELECTION_VALID_COLOR}):this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"dragdropresize.contain",elements:[this.containmentParentNode],color:ORYX.CONFIG.SELECTION_INVALID_COLOR})}},checkRules:function(a){var b=a.event,c=a.checkIfAttachable,d=a.noEdges;this.containmentParentNode=
a.underlyingNodes.reverse().find(function(a){return a instanceof ORYX.Core.Canvas||(a instanceof ORYX.Core.Node||a instanceof ORYX.Core.Edge&&!d)&&!(this.currentShapes.member(a)||this.currentShapes.any(function(b){return 0<b.children.length&&b.getChildNodes(!0).member(a)}))}.bind(this));if(c&&this.containmentParentNode&&(this.isAttachingAllowed=this.facade.getRules().canConnect({sourceShape:this.containmentParentNode,edgeShape:this.toMoveShapes[0],targetShape:this.toMoveShapes[0]})))b=this.facade.eventCoordinates(b),
this.isAttachingAllowed=this.containmentParentNode.isPointOverOffset(b.x,b.y);this.isAttachingAllowed||(this.isAddingAllowed=this.toMoveShapes.all(function(a){return a instanceof ORYX.Core.Edge||a instanceof ORYX.Core.Controls.Docker||this.containmentParentNode===a.parent||this.containmentParentNode!==a&&(!(this.containmentParentNode instanceof ORYX.Core.Edge)||!d)&&this.facade.getRules().canContain({containingShape:this.containmentParentNode,containedShape:a})?!0:!1}.bind(this)));!this.isAttachingAllowed&&
!this.isAddingAllowed&&this.containmentParentNode instanceof ORYX.Core.Edge&&(a.noEdges=!0,a.underlyingNodes.reverse(),this.checkRules(a))},refreshSelectedShapes:function(){if(this.dragBounds){var a=this.dragBounds.upperLeft(),b=this.oldDragBounds.upperLeft(),a=[new ORYX.Core.Command.Move(this.toMoveShapes,{x:a.x-b.x,y:a.y-b.y},null,this.containmentParentNode,this.currentShapes,this,!0)];this._undockedEdgesCommand instanceof ORYX.Core.Command&&a.unshift(this._undockedEdgesCommand);this.facade.executeCommands(a);
this.dragBounds&&(this.oldDragBounds=this.dragBounds.clone())}},onResize:function(a){this.dragBounds&&(this.dragBounds=a,this.isResizing=!0,this.resizeRectangle(this.dragBounds))},onResizeStart:function(){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_RESIZE_START})},onResizeEnd:function(){if(this.currentShapes instanceof Array&&!(0>=this.currentShapes.length)&&this.isResizing){var a=ORYX.Core.Command.extend({construct:function(a,b,c){this.shape=a;this.oldBounds=a.bounds.clone();this.newBounds=b;
this.plugin=c},execute:function(){this.shape.bounds.set(this.newBounds.a,this.newBounds.b);this.update(this.getOffset(this.oldBounds,this.newBounds))},rollback:function(){this.shape.bounds.set(this.oldBounds.a,this.oldBounds.b);this.update(this.getOffset(this.newBounds,this.oldBounds))},getOffset:function(a,b){return{x:b.a.x-a.a.x,y:b.a.y-a.a.y,xs:b.width()/a.width(),ys:b.height()/a.height()}},update:function(a){this.shape.getLabels().each(function(a){a.changed()});this.plugin.layoutEdges(this.shape,
[].concat(this.shape.getIncomingShapes()).concat(this.shape.getOutgoingShapes()).findAll(function(a){return a instanceof ORYX.Core.Edge}.bind(this)),a);this.plugin.doLayout([this.shape]);this.plugin.facade.setSelection([this.shape]);this.plugin.facade.getCanvas().update();this.plugin.facade.updateSelection()}}),b=this.dragBounds.clone(),c=this.currentShapes[0];if(c.parent){var d=c.parent.absoluteXY();b.moveBy(-d.x,-d.y)}this.facade.executeCommands([new a(c,b,this)]);this.isResizing=!1;this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_RESIZE_END,
shapes:[c]})}},beforeDrag:function(){this._undockedEdgesCommand=new (ORYX.Core.Command.extend({construct:function(a){this.dockers=a.collect(function(a){return a instanceof ORYX.Core.Controls.Docker?{docker:a,dockedShape:a.getDockedShape(),refPoint:a.referencePoint}:void 0}).compact()},execute:function(){this.dockers.each(function(a){a.docker.setDockedShape(void 0)})},rollback:function(){this.dockers.each(function(a){a.docker.setDockedShape(a.dockedShape);a.docker.setReferencePoint(a.refPoint)})}}))(this.toMoveShapes);
this._undockedEdgesCommand.execute()},hideAllLabels:function(a){a.getLabels().each(function(a){a.hide()});a.getAllDockedShapes().each(function(a){a=a.getLabels();0<a.length&&a.each(function(a){a.hide()})});a.getChildren().each(function(a){a instanceof ORYX.Core.Shape&&this.hideAllLabels(a)}.bind(this))},afterDrag:function(){},showAllLabels:function(a){for(var b=0;b<a.length;b++)a[b].show();for(var c=a.getAllDockedShapes(),b=0;b<c.length;b++){var d=c[b].getLabels();0<d.length&&d.each(function(a){a.show()})}for(b=
0;b<a.children.length;b++)c=a.children[b],c instanceof ORYX.Core.Shape&&this.showAllLabels(c)},onSelectionChanged:function(a){this.resizerSE.onSelectionChanged(a);this.resizerNW.onSelectionChanged(a);var b=a.elements;this.dragIntialized=this.dragEnable=!1;this.resizerSE.hide();this.resizerNW.hide();if(!b||0==b.length)this.selectedRect.hide(),this.currentShapes=[],this.toMoveShapes=[],this.oldDragBounds=this.dragBounds=void 0;else{this.currentShapes=b;this.toMoveShapes=this.facade.getCanvas().getShapesWithSharedParent(b);
this.toMoveShapes=this.toMoveShapes.findAll(function(a){return a instanceof ORYX.Core.Node&&(0===a.dockers.length||!b.member(a.dockers.first().getDockedShape()))});b.each(function(a){if(a instanceof ORYX.Core.Edge){var c=a.getDockers(),f=b.member(c.first().getDockedShape()),g=b.member(c.last().getDockedShape());!f&&!g&&!c.first().getDockedShape()&&!c.last().getDockedShape()&&(this.toMoveShapes=this.toMoveShapes.concat(c));2<a.dockers.length&&f&&g&&(this.toMoveShapes=this.toMoveShapes.concat(c.findAll(function(a,
b){return 0<b&&b<c.length-1})))}}.bind(this));var c=void 0;this.toMoveShapes.each(function(a){var b=a;a instanceof ORYX.Core.Controls.Docker&&(b=a.parent);c?c.include(b.absoluteBounds()):c=b.absoluteBounds()}.bind(this));c||b.each(function(a){c?c.include(a.absoluteBounds()):c=a.absoluteBounds()});this.dragBounds=c;this.oldDragBounds=c.clone();this.resizeRectangle(c);this.selectedRect.show();1==b.length&&b[0].isResizable?(a=b[0].getStencil().fixedAspectRatio()?b[0].bounds.width()/b[0].bounds.height():
void 0,this.resizerSE.setBounds(this.dragBounds,b[0].minimumSize,b[0].maximumSize,a),this.resizerSE.show(),this.resizerNW.setBounds(this.dragBounds,b[0].minimumSize,b[0].maximumSize,a),this.resizerNW.show()):(this.resizerSE.setBounds(void 0),this.resizerNW.setBounds(void 0));ORYX.CONFIG.GRID_ENABLED&&(this.distPoints=[],this.distPointTimeout&&window.clearTimeout(this.distPointTimeout),this.distPointTimeout=window.setTimeout(function(){this.facade.getCanvas().getChildShapes(!0).findAll(function(a){for(a=
a.parent;a;){if(b.member(a))return!1;a=a.parent}return!0}).each(function(a){if(!(a instanceof ORYX.Core.Edge)){var b=a.absoluteXY(),c=a.bounds.width(),a=a.bounds.height();this.distPoints.push({ul:{x:b.x,y:b.y},c:{x:b.x+c/2,y:b.y+a/2},lr:{x:b.x+c,y:b.y+a}})}}.bind(this))}.bind(this),10))}},snapToGrid:function(a){var b=this.dragBounds,c=this.vLine?this.vLine.getScale():1,d={x:a.x/c,y:a.y/c},e=a.x/c+b.width()/2,f=a.y/c+b.height()/2;b.width();b.height();var g,h,i,j;this.distPoints.each(function(a){var b,
c,d,k;10>Math.abs(a.c.x-e)&&(b=a.c.x-e,d=a.c.x);10>Math.abs(a.c.y-f)&&(c=a.c.y-f,k=a.c.y);void 0!==b&&(g=void 0===g?b:Math.abs(b)<Math.abs(g)?b:g,g===b&&(i=d));void 0!==c&&(h=void 0===h?c:Math.abs(c)<Math.abs(h)?c:h,h===c&&(j=k))});void 0!==g?(d.x+=g,d.x*=c,this.vLine&&i&&this.vLine.update(i)):(d.x=a.x-a.x%(ORYX.CONFIG.GRID_DISTANCE/2),this.vLine&&this.vLine.hide());void 0!==h?(d.y+=h,d.y*=c,this.hLine&&j&&this.hLine.update(j)):(d.y=a.y-a.y%(ORYX.CONFIG.GRID_DISTANCE/2),this.hLine&&this.hLine.hide());
return d},showGridLine:function(){},resizeRectangle:function(a){this.selectedRect.resize(a)}});
ORYX.Plugins.SelectedRect=Clazz.extend({construct:function(a){this.parentId=a;this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",$(a),["g"]);this.dashedArea=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["rect",{x:0,y:0,"stroke-width":1,stroke:"#777777",fill:"none","stroke-dasharray":"2,2","pointer-events":"none"}]);this.hide()},hide:function(){this.node.setAttributeNS(null,"display","none")},show:function(){this.node.setAttributeNS(null,"display","inherit")},resize:function(a){var b=
a.upperLeft(),c=ORYX.CONFIG.SELECTED_AREA_PADDING;this.dashedArea.setAttributeNS(null,"width",a.width()+2*c);this.dashedArea.setAttributeNS(null,"height",a.height()+2*c);this.node.setAttributeNS(null,"transform","translate("+(b.x-c)+", "+(b.y-c)+")")}});
ORYX.Plugins.GridLine=Clazz.extend({construct:function(a,b){ORYX.Plugins.GridLine.DIR_HORIZONTAL!==b&&ORYX.Plugins.GridLine.DIR_VERTICAL!==b&&(b=ORYX.Plugins.GridLine.DIR_HORIZONTAL);this.parent=$(a);this.direction=b;this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.parent,["g"]);this.line=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["path",{"stroke-width":1,stroke:"silver",fill:"none","stroke-dasharray":"5,5","pointer-events":"none"}]);this.hide()},hide:function(){this.node.setAttributeNS(null,
"display","none")},show:function(){this.node.setAttributeNS(null,"display","inherit")},getScale:function(){try{return this.parent.parentNode.transform.baseVal.getItem(0).matrix.a}catch(a){return 1}},update:function(a){if(this.direction===ORYX.Plugins.GridLine.DIR_HORIZONTAL){var a=a instanceof Object?a.y:a,b=this.parent.parentNode.parentNode.width.baseVal.value/this.getScale();this.line.setAttributeNS(null,"d","M 0 "+a+" L "+b+" "+a)}else a=a instanceof Object?a.x:a,b=this.parent.parentNode.parentNode.height.baseVal.value/
this.getScale(),this.line.setAttributeNS(null,"d","M"+a+" 0 L "+a+" "+b);this.show()}});ORYX.Plugins.GridLine.DIR_HORIZONTAL="hor";ORYX.Plugins.GridLine.DIR_VERTICAL="ver";
ORYX.Plugins.Resizer=Clazz.extend({construct:function(a,b,c){this.parentId=a;this.orientation=b;this.facade=c;this.node=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",$(this.parentId),["div",{"class":"resizer_"+this.orientation,style:"left:0px; top:0px;"}]);this.node.addEventListener(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this),!0);document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.handleMouseUp.bind(this),!0);document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,
this.handleMouseMove.bind(this),!1);this.dragEnable=!1;this.offSetPosition={x:0,y:0};this.bounds=void 0;this.canvasNode=this.facade.getCanvas().node;this.aspectRatio=this.maxSize=this.minSize=void 0;this.resizeCallbacks=[];this.resizeStartCallbacks=[];this.resizeEndCallbacks=[];this.hide();this.scrollNode=this.node.parentNode.parentNode.parentNode},onSelectionChanged:function(a){a=a.elements;this.currentShapes=!a||0==a.length?[]:a},handleMouseDown:function(a){this.dragEnable=!0;this.offsetScroll=
{x:this.scrollNode.scrollLeft,y:this.scrollNode.scrollTop};this.offSetPosition={x:Event.pointerX(a)-this.position.x,y:Event.pointerY(a)-this.position.y};this.resizeStartCallbacks.each(function(a){a(this.bounds)}.bind(this))},handleMouseUp:function(){this.dragEnable=!1;this.containmentParentNode=null;this.resizeEndCallbacks.each(function(a){a(this.bounds)}.bind(this))},handleMouseMove:function(a){if(this.dragEnable){this.aspectRatio=a.shiftKey||a.ctrlKey?this.bounds.width()/this.bounds.height():void 0;
var b=Event.pointerX(a)-this.offSetPosition.x,c=Event.pointerY(a)-this.offSetPosition.y,b=b-(this.offsetScroll.x-this.scrollNode.scrollLeft),c=c-(this.offsetScroll.y-this.scrollNode.scrollTop),b=Math.min(b,this.facade.getCanvas().bounds.width()),c=Math.min(c,this.facade.getCanvas().bounds.height()),b={x:b-this.position.x,y:c-this.position.y};this.aspectRatio&&(newAspectRatio=(this.bounds.width()+b.x)/(this.bounds.height()+b.y),newAspectRatio>this.aspectRatio?b.x=this.aspectRatio*(this.bounds.height()+
b.y)-this.bounds.width():newAspectRatio<this.aspectRatio&&(b.y=(this.bounds.width()+b.x)/this.aspectRatio-this.bounds.height()));"northwest"===this.orientation?(this.bounds.width()-b.x>this.maxSize.width&&(b.x=-(this.maxSize.width-this.bounds.width()),this.aspectRatio&&(b.y=this.aspectRatio*b.x)),this.bounds.width()-b.x<this.minSize.width&&(b.x=-(this.minSize.width-this.bounds.width()),this.aspectRatio&&(b.y=this.aspectRatio*b.x)),this.bounds.height()-b.y>this.maxSize.height&&(b.y=-(this.maxSize.height-
this.bounds.height()),this.aspectRatio&&(b.x=b.y/this.aspectRatio)),this.bounds.height()-b.y<this.minSize.height&&(b.y=-(this.minSize.height-this.bounds.height()),this.aspectRatio&&(b.x=b.y/this.aspectRatio))):(this.bounds.width()+b.x>this.maxSize.width&&(b.x=this.maxSize.width-this.bounds.width(),this.aspectRatio&&(b.y=this.aspectRatio*b.x)),this.bounds.width()+b.x<this.minSize.width&&(b.x=this.minSize.width-this.bounds.width(),this.aspectRatio&&(b.y=this.aspectRatio*b.x)),this.bounds.height()+b.y>
this.maxSize.height&&(b.y=this.maxSize.height-this.bounds.height(),this.aspectRatio&&(b.x=b.y/this.aspectRatio)),this.bounds.height()+b.y<this.minSize.height&&(b.y=this.minSize.height-this.bounds.height(),this.aspectRatio&&(b.x=b.y/this.aspectRatio)));"northwest"===this.orientation?(this.bounds.lowerRight(),this.bounds.lowerRight(),this.bounds.extend({x:-b.x,y:-b.y}),this.bounds.moveBy(b)):this.bounds.extend(b);this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_DRAG_TRACKER_RESIZE,shapes:this.currentShapes,
bounds:this.bounds});this.update();this.resizeCallbacks.each(function(a){a(this.bounds)}.bind(this));Event.stop(a)}},registerOnResizeStart:function(a){this.resizeStartCallbacks.member(a)||this.resizeStartCallbacks.push(a)},unregisterOnResizeStart:function(a){this.resizeStartCallbacks.member(a)&&(this.resizeStartCallbacks=this.resizeStartCallbacks.without(a))},registerOnResizeEnd:function(a){this.resizeEndCallbacks.member(a)||this.resizeEndCallbacks.push(a)},unregisterOnResizeEnd:function(a){this.resizeEndCallbacks.member(a)&&
(this.resizeEndCallbacks=this.resizeEndCallbacks.without(a))},registerOnResize:function(a){this.resizeCallbacks.member(a)||this.resizeCallbacks.push(a)},unregisterOnResize:function(a){this.resizeCallbacks.member(a)&&(this.resizeCallbacks=this.resizeCallbacks.without(a))},hide:function(){this.node.style.display="none"},show:function(){this.bounds&&(this.node.style.display="")},setBounds:function(a,b,c,d){this.bounds=a;b||(b={width:ORYX.CONFIG.MINIMUM_SIZE,height:ORYX.CONFIG.MINIMUM_SIZE});c||(c={width:ORYX.CONFIG.MAXIMUM_SIZE,
height:ORYX.CONFIG.MAXIMUM_SIZE});this.minSize=b;this.maxSize=c;this.aspectRatio=d;this.update()},update:function(){if(this.bounds){var a=this.bounds.upperLeft();this.bounds.width()<this.minSize.width&&this.bounds.set(a.x,a.y,a.x+this.minSize.width,a.y+this.bounds.height());this.bounds.height()<this.minSize.height&&this.bounds.set(a.x,a.y,a.x+this.bounds.width(),a.y+this.minSize.height);this.bounds.width()>this.maxSize.width&&this.bounds.set(a.x,a.y,a.x+this.maxSize.width,a.y+this.bounds.height());
this.bounds.height()>this.maxSize.height&&this.bounds.set(a.x,a.y,a.x+this.bounds.width(),a.y+this.maxSize.height);var b=this.canvasNode.getScreenCTM();a.x*=b.a;a.y*=b.d;"northwest"===this.orientation?(a.x-=19,a.y-=45):(a.x+=b.a*this.bounds.width()+8,a.y+=b.d*this.bounds.height()-9);this.position=a;this.node.style.left=this.position.x+"px";this.node.style.top=this.position.y+"px"}}});
ORYX.Core.Command.Move=ORYX.Core.Command.extend({construct:function(a,b,c,d,e,f,g){this.moveShapes=a;this.selectedShapes=e;this.offset=b;this.newLocation=c;this.plugin=f;this.doLayout=g;this.newParents=a.collect(function(a){return d||a.parent});this.oldParents=a.collect(function(a){return a.parent});this.dockedNodes=a.findAll(function(a){return a instanceof ORYX.Core.Node&&1==a.dockers.length}).collect(function(a){return{docker:a.dockers[0],dockedShape:a.dockers[0].getDockedShape(),refPoint:a.dockers[0].referencePoint}})},
execute:function(){this.dockAllShapes();this.move(this.offset,this.newLocation,this.doLayout);this.addShapeToParent(this.newParents);this.selectCurrentShapes();this.plugin&&(this.plugin.facade.getCanvas().update(),this.plugin.facade.updateSelection())},rollback:function(){this.move({x:-this.offset.x,y:-this.offset.y});this.addShapeToParent(this.oldParents);this.dockAllShapes(!0);this.selectCurrentShapes();this.plugin&&(this.plugin.facade.getCanvas().update(),this.plugin.facade.updateSelection())},
move:function(a,b,c){if(this.plugin){for(var d=0;d<this.moveShapes.length;d++){var e=this.moveShapes[d];a?e.bounds.moveBy(a):e.bounds.moveTo(b);if(e instanceof ORYX.Core.Node){(e.dockers||[]).each(function(b){a&&b.bounds.moveBy(a)});var f=[].concat(e.getIncomingShapes()).concat(e.getOutgoingShapes()).findAll(function(a){return a instanceof ORYX.Core.Edge&&!this.moveShapes.any(function(b){return b==a||b instanceof ORYX.Core.Controls.Docker&&b.parent==a})}.bind(this)).findAll(function(a){return(a.dockers.first().getDockedShape()==
e||!this.moveShapes.include(a.dockers.first().getDockedShape()))&&(a.dockers.last().getDockedShape()==e||!this.moveShapes.include(a.dockers.last().getDockedShape()))}.bind(this));this.plugin.layoutEdges(e,f,a);for(var f=[].concat(e.getIncomingShapes()).concat(e.getOutgoingShapes()).findAll(function(a){return a instanceof ORYX.Core.Edge&&a.dockers.first().isDocked()&&a.dockers.last().isDocked()&&!this.moveShapes.include(a)&&!this.moveShapes.any(function(b){return b==a||b instanceof ORYX.Core.Controls.Docker&&
b.parent==a})}.bind(this)).findAll(function(a){return this.moveShapes.indexOf(a.dockers.first().getDockedShape())>d||this.moveShapes.indexOf(a.dockers.last().getDockedShape())>d}.bind(this)),g=0;g<f.length;g++)for(var h=1;h<f[g].dockers.length-1;h++){var i=f[g].dockers[h];!i.getDockedShape()&&!this.moveShapes.include(i)&&i.bounds.moveBy(a)}}}c&&this.plugin.doLayout(this.moveShapes)}},dockAllShapes:function(a){for(var b=0;b<this.dockedNodes.length;b++){var c=this.dockedNodes[b].docker;c.setDockedShape(a?
this.dockedNodes[b].dockedShape:void 0);c.getDockedShape()&&c.setReferencePoint(this.dockedNodes[b].refPoint)}},addShapeToParent:function(a){for(var b=0;b<this.moveShapes.length;b++){var c=this.moveShapes[b];if(c instanceof ORYX.Core.Node&&c.parent!==a[b])try{var d=a[b].absoluteXY(),e=c.absoluteXY(),f=e.x-d.x,g=e.y-d.y;a[b].add(c);c.getOutgoingShapes(function(c){c instanceof ORYX.Core.Node&&!this.moveShapes.member(c)&&a[b].add(c)}.bind(this));if(c instanceof ORYX.Core.Node&&1==c.dockers.length){var h=
c.bounds,f=f+h.width()/2,g=g+h.height()/2;c.dockers.first().bounds.centerMoveTo(f,g)}else c.bounds.moveTo(f,g)}catch(i){}}},selectCurrentShapes:function(){this.plugin&&this.plugin.facade.setSelection(this.selectedShapes)}});
/* ORYX.Plugins.RenameShapes */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.RenameShapes=Clazz.extend({facade:void 0,construct:function(b){this.facade=b;this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DBLCLICK,this.actOnDBLClick.bind(this));this.facade.registerOnEvent(ORYX.CONFIG.EVENT_CLICK,this.actOnClick.bind(this));this.facade.offer({keyCodes:[{keyCode:113,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.renamePerF2.bind(this)})},renamePerF2:function(){this.actOnDBLClick(void 0,this.facade.getSelection().first())},getEditableProperties:function(b){return b.getStencil().properties().findAll(function(a){return a.refToView()&&
0<a.refToView().length&&a.directlyEditable()}).findAll(function(a){return!a.readonly()&&a.type()==ORYX.CONFIG.TYPE_STRING})},getPropertyForLabel:function(b,a,c){return b.find(function(b){return b.refToView().any(function(b){return c.id==a.id+b})})},actOnClick:function(b,a){!(a instanceof ORYX.Core.Shape)&&this.shownComboBox&&(this.hide(),this.destroy())},actOnDBLClick:function(b,a){if(a instanceof ORYX.Core.Shape&&!((a instanceof ORYX.Core.Node||a instanceof ORYX.Core.Edge)&&"false"==a.properties["oryx-isselectable"])){this.hide();
this.destroy();var c=this.getEditableProperties(a),g=c.collect(function(a){return a.refToView()}).flatten().compact(),d=a.getLabels().findAll(function(a){return g.any(function(b){return a.id.endsWith(b)})});if(0!=d.length){var e=1==d.length?d[0]:null;if(!e&&(e=d.find(function(a){return a.node==b.target||a.node==b.target.parentNode}),!e)){var f=this.facade.eventCoordinates(b),e=this.facade.getCanvas().rootNode.lastChild.getScreenCTM();f.x*=e.a;f.y*=e.d;!a instanceof ORYX.Core.Node?(d=d.collect(function(a){var b=
this.getCenterPosition(a.node);return{diff:Math.sqrt(Math.pow(b.x-f.x,2)+Math.pow(b.y-f.y,2)),label:a}}.bind(this)),d.sort(function(a,b){return a.diff>b.diff})):(d=d.collect(function(a){var b=this.getDifferenceCenterForNode(a.node);return{diff:Math.sqrt(Math.pow(b.x-f.x,2)+Math.pow(b.y-f.y,2)),label:a}}.bind(this)),d.sort(function(a,b){return a.diff>b.diff}));e=d[0].label}c=this.getPropertyForLabel(c,a,e);this.showTextField(a,c,e)}}},showTextField:function(b,a,c){var g=this.facade.getCanvas().getHTMLContainer().id,
d;b instanceof ORYX.Core.Node?d=b.bounds.width():(d=c.node.getBoundingClientRect(),d=Math.max(150,d.width));c=!b instanceof ORYX.Core.Node?this.getCenterPosition(c.node):b.absoluteBounds().center();c.x-=d/2;var e=a.prefix()+"-"+a.id();this.comboId=Ext.id();a={id:this.comboId,renderTo:g,value:b.properties[e],maxLength:a.length(),emptyText:a.title(),listeners:{specialkey:this._specialKeyPressed.bind(this),blur:function(){}.bind(this),change:function(a,c,d){if(this.shownComboBox){var d=b.properties[e],
c=this.shownComboBox.getRawValue(),g=this.facade;d!=c&&this.facade.executeCommands([new (ORYX.Core.Command.extend({construct:function(){this.el=b;this.propId=e;this.oldValue=d;this.newValue=c;this.facade=g},execute:function(){this.el.setProperty(this.propId,this.newValue);this.facade.setSelection([this.el]);this.facade.getCanvas().update();this.facade.updateSelection()},rollback:function(){this.el.setProperty(this.propId,this.oldValue);this.facade.setSelection([this.el]);this.facade.getCanvas().update();
this.facade.updateSelection()}}))])}}.bind(this)},hideTrigger:!0,typeAhead:!0,queryMode:"local",minChars:1,labelStyle:"display:none",store:ORYX.Dictionary.Dictionaryitems,displayField:"name",valueField:"name",mode:"local",triggerAction:"all",forceSelection:!1,caseSensitive:!1,autoSelect:!1};this.shownComboBox=new Ext.form.ComboBox(a);this.shownComboBox.setPosition(10>c.x?10:c.x,c.y-16);this.shownComboBox.setSize(Math.max(100,d),40);this.shownComboBox.show();this.shownComboBox.focus("",40);this.facade.disableEvent(ORYX.CONFIG.EVENT_KEYDOWN)},
_specialKeyPressed:function(b,a){var c=a.getKey();13==c&&(a.shiftKey||!b.initialConfig.grow)?(b.fireEvent("change",null,b.getValue()),this.destroy()):c==a.ESC&&this.destroy()},getCenterPosition:function(b){var a={x:0,y:0},c=b.getTransformToElement(this.facade.getCanvas().rootNode.lastChild),g=this.facade.getCanvas().rootNode.lastChild.getScreenCTM(),d=b.getTransformToElement(b.parentNode),e=void 0;a.x=c.e-d.e;a.y=c.f-d.f;try{e=b.getBBox()}catch(f){}if(null===e||"undefined"===typeof e||0==e.width||
0==e.height)e={x:Number(b.getAttribute("x")),y:Number(b.getAttribute("y")),width:0,height:0};a.x+=e.x;a.y+=e.y;a.x+=e.width/2;a.y+=e.height/2;a.x*=g.a;a.y*=g.d;return a},getDifferenceCenterForNode:function(b){b=this.getCenterPosition(b);b.x=0;b.y+=10;return b},hide:function(){this.shownComboBox&&(this.shownComboBox.fireEvent("change"),this.shownComboBox.fireEvent("blur"))},destroy:function(){this.shownComboBox&&(this.shownComboBox.hide(),delete this.shownComboBox,this.facade.enableEvent(ORYX.CONFIG.EVENT_KEYDOWN))}});
/* ORYX.Plugins.Undo */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.Undo=Clazz.extend({facade:void 0,undoStack:[],redoStack:[],construct:function(a){this.facade=a;this.facade.offer({name:ORYX.I18N.Undo.undo,description:ORYX.I18N.Undo.undoDesc,icon:ORYX.PATH+"images/arrow_undo.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:90,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.doUndo.bind(this),group:ORYX.I18N.Undo.group,isEnabled:function(){return 0<this.undoStack.length}.bind(this),index:0});this.facade.offer({name:ORYX.I18N.Undo.redo,
description:ORYX.I18N.Undo.redoDesc,icon:ORYX.PATH+"images/arrow_redo.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:89,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.doRedo.bind(this),group:ORYX.I18N.Undo.group,isEnabled:function(){return 0<this.redoStack.length}.bind(this),index:1});this.facade.registerOnEvent(ORYX.CONFIG.EVENT_EXECUTE_COMMANDS,this.handleExecuteCommands.bind(this))},handleExecuteCommands:function(a){a.commands&&(this.undoStack.push(a.commands),this.redoStack=
[])},doUndo:function(){var a=this.undoStack.pop();a&&(this.redoStack.push(a),a.each(function(a){a.rollback()}));this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_UNDO_ROLLBACK,commands:a})},doRedo:function(){var a=this.redoStack.pop();a&&(this.undoStack.push(a),a.each(function(a){a.execute()}));this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_UNDO_EXECUTE,commands:a})}});
/* ORYX.Plugins.Arrangement */
Array.prototype.insertFrom=function(c,a){var a=Math.max(0,a),c=Math.min(Math.max(0,c),this.length-1),d=this[c],f=this.without(d),e=f.slice(0,a);e.push(d);f.length>a&&(e=e.concat(f.slice(a)));return e};ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.Arrangement=Clazz.extend({facade:void 0,construct:function(c){this.facade=c;this.facade.offer({name:ORYX.I18N.Arrangement.btf,functionality:this.setZLevel.bind(this,this.setToTop),group:ORYX.I18N.Arrangement.groupZ,icon:ORYX.PATH+"images/shape_move_front.png",description:ORYX.I18N.Arrangement.btfDesc,index:1,minShape:1});this.facade.offer({name:ORYX.I18N.Arrangement.btb,functionality:this.setZLevel.bind(this,this.setToBack),group:ORYX.I18N.Arrangement.groupZ,icon:ORYX.PATH+"images/shape_move_back.png",
description:ORYX.I18N.Arrangement.btbDesc,index:2,minShape:1});this.facade.offer({name:ORYX.I18N.Arrangement.bf,functionality:this.setZLevel.bind(this,this.setForward),group:ORYX.I18N.Arrangement.groupZ,icon:ORYX.PATH+"images/shape_move_forwards.png",description:ORYX.I18N.Arrangement.bfDesc,index:3,minShape:1});this.facade.offer({name:ORYX.I18N.Arrangement.bb,functionality:this.setZLevel.bind(this,this.setBackward),group:ORYX.I18N.Arrangement.groupZ,icon:ORYX.PATH+"images/shape_move_backwards.png",
description:ORYX.I18N.Arrangement.bbDesc,index:4,minShape:1});this.facade.offer({name:ORYX.I18N.Arrangement.ab,functionality:this.alignShapes.bind(this,[ORYX.CONFIG.EDITOR_ALIGN_BOTTOM]),group:ORYX.I18N.Arrangement.groupA,icon:ORYX.PATH+"images/shape_align_bottom.png",description:ORYX.I18N.Arrangement.abDesc,index:1,minShape:2});this.facade.offer({name:ORYX.I18N.Arrangement.am,functionality:this.alignShapes.bind(this,[ORYX.CONFIG.EDITOR_ALIGN_MIDDLE]),group:ORYX.I18N.Arrangement.groupA,icon:ORYX.PATH+
"images/shape_align_middle.png",description:ORYX.I18N.Arrangement.amDesc,index:2,minShape:2});this.facade.offer({name:ORYX.I18N.Arrangement.at,functionality:this.alignShapes.bind(this,[ORYX.CONFIG.EDITOR_ALIGN_TOP]),group:ORYX.I18N.Arrangement.groupA,icon:ORYX.PATH+"images/shape_align_top.png",description:ORYX.I18N.Arrangement.atDesc,index:3,minShape:2});this.facade.offer({name:ORYX.I18N.Arrangement.al,functionality:this.alignShapes.bind(this,[ORYX.CONFIG.EDITOR_ALIGN_LEFT]),group:ORYX.I18N.Arrangement.groupA,
icon:ORYX.PATH+"images/shape_align_left.png",description:ORYX.I18N.Arrangement.alDesc,index:4,minShape:2});this.facade.offer({name:ORYX.I18N.Arrangement.ac,functionality:this.alignShapes.bind(this,[ORYX.CONFIG.EDITOR_ALIGN_CENTER]),group:ORYX.I18N.Arrangement.groupA,icon:ORYX.PATH+"images/shape_align_center.png",description:ORYX.I18N.Arrangement.acDesc,index:5,minShape:2});this.facade.offer({name:ORYX.I18N.Arrangement.ar,functionality:this.alignShapes.bind(this,[ORYX.CONFIG.EDITOR_ALIGN_RIGHT]),group:ORYX.I18N.Arrangement.groupA,
icon:ORYX.PATH+"images/shape_align_right.png",description:ORYX.I18N.Arrangement.arDesc,index:6,minShape:2});this.facade.offer({name:ORYX.I18N.Arrangement.as,functionality:this.alignShapes.bind(this,[ORYX.CONFIG.EDITOR_ALIGN_SIZE]),group:ORYX.I18N.Arrangement.groupA,icon:ORYX.PATH+"images/shape_align_size.png",description:ORYX.I18N.Arrangement.asDesc,index:7,minShape:2});this.facade.registerOnEvent(ORYX.CONFIG.EVENT_ARRANGEMENT_TOP,this.setZLevel.bind(this,this.setToTop));this.facade.registerOnEvent(ORYX.CONFIG.EVENT_ARRANGEMENT_BACK,
this.setZLevel.bind(this,this.setToBack));this.facade.registerOnEvent(ORYX.CONFIG.EVENT_ARRANGEMENT_FORWARD,this.setZLevel.bind(this,this.setForward));this.facade.registerOnEvent(ORYX.CONFIG.EVENT_ARRANGEMENT_BACKWARD,this.setZLevel.bind(this,this.setBackward))},setZLevel:function(c,a){var d=new (ORYX.Core.Command.extend({construct:function(a,d,b){this.callback=a;this.elements=d;this.elAndIndex=d.map(function(b){return{el:b,previous:b.parent.children[b.parent.children.indexOf(b)-1]}});this.facade=
b},execute:function(){this.callback(this.elements);this.facade.setSelection(this.elements)},rollback:function(){for(var a=this.elAndIndex.sortBy(function(b){b=b.el;return $A(b.node.parentNode.childNodes).indexOf(b.node)}),d=0;d<a.length;d++){var b=a[d].el,c=b.parent,h=c.children.indexOf(b),g=c.children.indexOf(a[d].previous),g=g||0;c.children=c.children.insertFrom(h,g);b.node.parentNode.insertBefore(b.node,b.node.parentNode.childNodes[g+1])}this.facade.setSelection(this.elements)}}))(c,this.facade.getSelection(),
this.facade);a.excludeCommand?d.execute():this.facade.executeCommands([d])},setToTop:function(c){c.sortBy(function(a){return $A(a.node.parentNode.childNodes).indexOf(a.node)}).each(function(a){var d=a.parent;d.children=d.children.without(a);d.children.push(a);a.node.parentNode.appendChild(a.node)})},setToBack:function(c){c=c.sortBy(function(a){return $A(a.node.parentNode.childNodes).indexOf(a.node)});c=c.reverse();c.each(function(a){var d=a.parent;d.children=d.children.without(a);d.children.unshift(a);
a.node.parentNode.insertBefore(a.node,a.node.parentNode.firstChild)})},setBackward:function(c){var a=c.sortBy(function(a){return $A(a.node.parentNode.childNodes).indexOf(a.node)}),a=a.reverse();a.findAll(function(d){return!a.some(function(a){return a.node==d.node.previousSibling})}).each(function(a){if(null!==a.node.previousSibling){var c=a.parent,e=c.children.indexOf(a);c.children=c.children.insertFrom(e,e-1);a.node.parentNode.insertBefore(a.node,a.node.previousSibling)}})},setForward:function(c){var a=
c.sortBy(function(a){return $A(a.node.parentNode.childNodes).indexOf(a.node)});a.findAll(function(d){return!a.some(function(a){return a.node==d.node.nextSibling})}).each(function(a){var c=a.node.nextSibling;if(null!==c){var e=a.parent.children.indexOf(a),b=a.parent;b.children=b.children.insertFrom(e,e+1);a.node.parentNode.insertBefore(c,a.node)}})},alignShapes:function(c){var a=this.facade.getSelection(),a=this.facade.getCanvas().getShapesWithSharedParent(a),a=a.findAll(function(b){return b instanceof
ORYX.Core.Node}),a=a.findAll(function(b){b=b.getIncomingShapes();return 0==b.length||!a.include(b[0])});if(!(2>a.length)){var d=a[0].absoluteBounds().clone();a.each(function(b){d.include(b.absoluteBounds().clone())});var f=0,e=0;a.each(function(b){f=Math.max(b.bounds.width(),f);e=Math.max(b.bounds.height(),e)});this.facade.executeCommands([new (ORYX.Core.Command.extend({construct:function(b,a,c,d,e,f){this.elements=b;this.bounds=a;this.maxHeight=c;this.maxWidth=d;this.way=e;this.facade=f;this.orgPos=
[]},setBounds:function(b,a){a||(a={width:ORYX.CONFIG.MAXIMUM_SIZE,height:ORYX.CONFIG.MAXIMUM_SIZE});if(!b.bounds)throw"Bounds not definined.";var c={a:{x:b.bounds.upperLeft().x-(this.maxWidth-b.bounds.width())/2,y:b.bounds.upperLeft().y-(this.maxHeight-b.bounds.height())/2},b:{x:b.bounds.lowerRight().x+(this.maxWidth-b.bounds.width())/2,y:b.bounds.lowerRight().y+(this.maxHeight-b.bounds.height())/2}};this.maxWidth>a.width&&(c.a.x=b.bounds.upperLeft().x-(a.width-b.bounds.width())/2,c.b.x=b.bounds.lowerRight().x+
(a.width-b.bounds.width())/2);this.maxHeight>a.height&&(c.a.y=b.bounds.upperLeft().y-(a.height-b.bounds.height())/2,c.b.y=b.bounds.lowerRight().y+(a.height-b.bounds.height())/2);b.bounds.set(c)},execute:function(){this.elements.each(function(a,c){this.orgPos[c]=a.bounds.upperLeft();var d=this.bounds.clone();if(a.parent&&!(a.parent instanceof ORYX.Core.Canvas)){var e=a.parent.absoluteBounds().upperLeft();d.moveBy(-e.x,-e.y)}switch(this.way){case ORYX.CONFIG.EDITOR_ALIGN_BOTTOM:a.bounds.moveTo({x:a.bounds.upperLeft().x,
y:d.b.y-a.bounds.height()});break;case ORYX.CONFIG.EDITOR_ALIGN_MIDDLE:a.bounds.moveTo({x:a.bounds.upperLeft().x,y:(d.a.y+d.b.y-a.bounds.height())/2});break;case ORYX.CONFIG.EDITOR_ALIGN_TOP:a.bounds.moveTo({x:a.bounds.upperLeft().x,y:d.a.y});break;case ORYX.CONFIG.EDITOR_ALIGN_LEFT:a.bounds.moveTo({x:d.a.x,y:a.bounds.upperLeft().y});break;case ORYX.CONFIG.EDITOR_ALIGN_CENTER:a.bounds.moveTo({x:(d.a.x+d.b.x-a.bounds.width())/2,y:a.bounds.upperLeft().y});break;case ORYX.CONFIG.EDITOR_ALIGN_RIGHT:a.bounds.moveTo({x:d.b.x-
a.bounds.width(),y:a.bounds.upperLeft().y});break;case ORYX.CONFIG.EDITOR_ALIGN_SIZE:a.isResizable&&(this.orgPos[c]={a:a.bounds.upperLeft(),b:a.bounds.lowerRight()},this.setBounds(a,a.maximumSize))}}.bind(this));this.facade.getCanvas().update();this.facade.updateSelection()},rollback:function(){this.elements.each(function(a,c){this.way==ORYX.CONFIG.EDITOR_ALIGN_SIZE?a.isResizable&&a.bounds.set(this.orgPos[c]):a.bounds.moveTo(this.orgPos[c])}.bind(this));this.facade.getCanvas().update();this.facade.updateSelection()}}))(a,
d,e,f,parseInt(c),this.facade)])}}});
/* ORYX.Plugins.Grouping */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.Grouping=Clazz.extend({facade:void 0,construct:function(a){this.facade=a;this.facade.offer({name:ORYX.I18N.Grouping.group,functionality:this.createGroup.bind(this),group:ORYX.I18N.Grouping.grouping,icon:ORYX.PATH+"images/shape_group.png",description:ORYX.I18N.Grouping.groupDesc,index:1,minShape:2,isEnabled:this.isEnabled.bind(this,!1)});this.facade.offer({name:ORYX.I18N.Grouping.ungroup,functionality:this.deleteGroup.bind(this),group:ORYX.I18N.Grouping.grouping,icon:ORYX.PATH+"images/shape_ungroup.png",
description:ORYX.I18N.Grouping.ungroupDesc,index:2,minShape:2,isEnabled:this.isEnabled.bind(this,!0)});this.selectedElements=[];this.groups=[]},isEnabled:function(a){var b=this.selectedElements;return a===this.groups.any(function(a){return a.length===b.length&&a.all(function(a){return b.member(a)})})},onSelectionChanged:function(a){var b=a.elements;this.selectedElements=this.groups.findAll(function(a){return a.any(function(a){return b.member(a)})});this.selectedElements.push(b);this.selectedElements=
this.selectedElements.flatten().uniq();this.selectedElements.length!==b.length&&this.facade.setSelection(this.selectedElements)},createGroup:function(){var a=this.facade.getSelection();this.facade.executeCommands([new (ORYX.Core.Command.extend({construct:function(a,c,d,e){this.selectedElements=a;this.groups=c;this.callback=d;this.facade=e},execute:function(){var b=this.groups.findAll(function(b){return!b.any(function(b){return a.member(b)})});b.push(a);this.callback(b.clone());this.facade.setSelection(this.selectedElements)},
rollback:function(){this.callback(this.groups.clone());this.facade.setSelection(this.selectedElements)}}))(a,this.groups.clone(),this.setGroups.bind(this),this.facade)])},deleteGroup:function(){var a=this.facade.getSelection();this.facade.executeCommands([new (ORYX.Core.Command.extend({construct:function(a,c,d,e){this.selectedElements=a;this.groups=c;this.callback=d;this.facade=e},execute:function(){this.callback(this.groups.partition(function(b){return b.length!==a.length||!b.all(function(b){return a.member(b)})})[0]);
this.facade.setSelection(this.selectedElements)},rollback:function(){this.callback(this.groups.clone());this.facade.setSelection(this.selectedElements)}}))(a,this.groups.clone(),this.setGroups.bind(this),this.facade)])},setGroups:function(a){this.groups=a}});
/* ORYX.Plugins.DragDocker */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.DragDocker=Clazz.extend({construct:function(a){this.facade=a;this.VALIDCOLOR=ORYX.CONFIG.SELECTION_VALID_COLOR;this.INVALIDCOLOR=ORYX.CONFIG.SELECTION_INVALID_COLOR;this.isEndDocker=this.isStartDocker=this.lastUIObj=this.dockerTarget=this.dockerSource=this.dockerParent=this.docker=this.shapeSelection=void 0;this.undockTreshold=10;this.outerDockerNotMoved=this.initialDockerPosition=void 0;this.isValid=!1;this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this));
this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DOCKERDRAG,this.handleDockerDrag.bind(this));this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEOVER,this.handleMouseOver.bind(this));this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEOUT,this.handleMouseOut.bind(this))},handleMouseOut:function(a,b){!this.docker&&b instanceof ORYX.Core.Controls.Docker?b.hide():!this.docker&&b instanceof ORYX.Core.Edge&&b.dockers.each(function(a){a.hide()})},handleMouseOver:function(a,b){!this.docker&&b instanceof ORYX.Core.Controls.Docker?
b.show():!this.docker&&b instanceof ORYX.Core.Edge&&b.dockers.each(function(a){a.show()})},handleDockerDrag:function(a,b){this.handleMouseDown(a.uiEvent,b)},handleMouseDown:function(a,b){if(b instanceof ORYX.Core.Controls.Docker&&b.isMovable){this.shapeSelection=this.facade.getSelection();this.facade.setSelection();this.docker=b;this.initialDockerPosition=this.docker.bounds.center();this.outerDockerNotMoved=!1;this.dockerParent=b.parent;this._commandArg={docker:b,dockedShape:b.getDockedShape(),refPoint:b.referencePoint||
b.bounds.center()};this.docker.show();b.parent instanceof ORYX.Core.Edge&&(b.parent.dockers.first()==b||b.parent.dockers.last()==b)?b.parent.dockers.first()==b&&b.parent.dockers.last().getDockedShape()?this.dockerTarget=b.parent.dockers.last().getDockedShape():b.parent.dockers.last()==b&&b.parent.dockers.first().getDockedShape()&&(this.dockerSource=b.parent.dockers.first().getDockedShape()):this.dockerTarget=this.dockerSource=void 0;this.isStartDocker=this.docker.parent.dockers.first()===this.docker;
this.isEndDocker=this.docker.parent.dockers.last()===this.docker;this.facade.getCanvas().add(this.docker.parent);this.docker.parent.getLabels().each(function(a){a.hide()});!this.isStartDocker&&!this.isEndDocker||!this.docker.isDocked()?(this.docker.setDockedShape(void 0),this.docker.bounds.centerMoveTo(this.facade.eventCoordinates(a)),this.dockerParent._update()):this.outerDockerNotMoved=!0;var h={movedCallback:this.dockerMoved.bind(this),upCallback:this.dockerMovedFinished.bind(this)};ORYX.Core.UIEnableDrag(a,
b,h)}},dockerMoved:function(a){this.outerDockerNotMoved=!1;var b=void 0;if(this.docker.parent&&(this.isStartDocker||this.isEndDocker)){var h=this.facade.eventCoordinates(a);if(this.docker.isDocked()){if(ORYX.Core.Math.getDistancePointToPoint(h,this.initialDockerPosition)<this.undockTreshold){this.outerDockerNotMoved=!0;return}this.docker.setDockedShape(void 0);this.dockerParent._update()}var d=this.facade.getCanvas().getAbstractShapesAtPosition(h),c=d.pop();this.docker.parent===c&&(c=d.pop());if(this.lastUIObj!=
c)if(c instanceof ORYX.Core.Shape){this.docker.parent.getStencil().stencilSet();if(this.docker.parent instanceof ORYX.Core.Edge){d=this.getHighestParentBeforeCanvas(c);if(d instanceof ORYX.Core.Edge&&this.docker.parent===d){this.isValid=!1;this.dockerParent._update();return}this.isValid=!1;for(var i=d=c;!this.isValid&&d&&!(d instanceof ORYX.Core.Canvas);)c=d,this.isValid=this.facade.getRules().canConnect({sourceShape:this.dockerSource?this.dockerSource:this.isStartDocker?c:void 0,edgeShape:this.docker.parent,
targetShape:this.dockerTarget?this.dockerTarget:this.isEndDocker?c:void 0}),d=d.parent;this.isValid||(c=i)}else this.isValid=this.facade.getRules().canConnect({sourceShape:c,edgeShape:this.docker.parent,targetShape:this.docker.parent});this.lastUIObj&&this.hideMagnets(this.lastUIObj);this.isValid&&this.showMagnets(c);this.showHighlight(c,this.isValid?this.VALIDCOLOR:this.INVALIDCOLOR);this.lastUIObj=c}else this.hideHighlight(),this.lastUIObj&&this.hideMagnets(this.lastUIObj),this.lastUIObj=void 0,
this.isValid=!1;this.lastUIObj&&this.isValid&&!a.shiftKey&&!a.ctrlKey&&(b=this.lastUIObj.magnets.find(function(a){return a.absoluteBounds().isIncluded(h)}))&&this.docker.bounds.centerMoveTo(b.absoluteCenterXY())}if(!a.shiftKey&&!a.ctrlKey&&!b){var a=ORYX.CONFIG.DOCKER_SNAP_OFFSET,e=a+1,f=a+1,g=this.docker.bounds.center();if(this.docker.parent)if(this.docker.parent.dockers.each(function(a){this.docker!=a&&(a=a.referencePoint?a.getAbsoluteReferencePoint():a.bounds.center(),e=Math.abs(e)>Math.abs(a.x-
g.x)?a.x-g.x:e,f=Math.abs(f)>Math.abs(a.y-g.y)?a.y-g.y:f)}.bind(this)),Math.abs(e)<a||Math.abs(f)<a)e=Math.abs(e)<a?e:0,f=Math.abs(f)<a?f:0,this.docker.bounds.centerMoveTo(g.x+e,g.y+f);else if(a=this.docker.parent.dockers[Math.max(this.docker.parent.dockers.indexOf(this.docker)-1,0)],b=this.docker.parent.dockers[Math.min(this.docker.parent.dockers.indexOf(this.docker)+1,this.docker.parent.dockers.length-1)],a&&b&&a!==this.docker&&b!==this.docker&&(a=a.bounds.center(),c=b.bounds.center(),b=this.docker.bounds.center(),
ORYX.Core.Math.isPointInLine(b.x,b.y,a.x,a.y,c.x,c.y,10))){c=(Number(c.y)-Number(a.y))/(Number(c.x)-Number(a.x));b=(a.y-a.x*c-(b.y-b.x*-Math.pow(c,-1)))/(-Math.pow(c,-1)-c);a=a.y-a.x*c+c*b;if(isNaN(b)||isNaN(a))return;this.docker.bounds.centerMoveTo(b,a)}}this.dockerParent._update()},dockerMovedFinished:function(a){this.facade.setSelection(this.shapeSelection);this.hideHighlight();this.dockerParent.getLabels().each(function(a){a.show()});if(this.lastUIObj&&(this.isStartDocker||this.isEndDocker))this.isValid&&
(this.docker.setDockedShape(this.lastUIObj),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_DRAGDOCKER_DOCKED,docker:this.docker,parent:this.docker.parent,target:this.lastUIObj})),this.hideMagnets(this.lastUIObj);this.docker.hide();if(this.outerDockerNotMoved){var a=this.facade.eventCoordinates(a),a=this.facade.getCanvas().getAbstractShapesAtPosition(a),b=a.findAll(function(a){return a instanceof ORYX.Core.Node}),a=b.length?b:a;this.facade.setSelection(a)}else a=ORYX.Core.Command.extend({construct:function(a,
b,c,i,e,f){this.docker=a;this.index=a.parent.dockers.indexOf(a);this.newPosition=b;this.newDockedShape=i;this.oldPosition=c;this.oldDockedShape=e;this.facade=f;this.index=a.parent.dockers.indexOf(a);this.shape=a.parent},execute:function(){this.docker.parent||(this.docker=this.shape.dockers[this.index]);this.dock(this.newDockedShape,this.newPosition);this.removedDockers=this.shape.removeUnusedDockers();this.facade.updateSelection()},rollback:function(){this.dock(this.oldDockedShape,this.oldPosition);
(this.removedDockers||$H({})).each(function(a){this.shape.add(a.value,Number(a.key));this.shape._update(!0)}.bind(this));this.facade.updateSelection()},dock:function(a,b){this.docker.setDockedShape(void 0);a?(this.docker.setDockedShape(a),this.docker.setReferencePoint(b)):this.docker.bounds.centerMoveTo(b);this.facade.getCanvas().update()}}),this.docker.parent&&this.facade.executeCommands([new a(this.docker,this.docker.getDockedShape()?this.docker.referencePoint:this.docker.bounds.center(),this._commandArg.refPoint,
this.docker.getDockedShape(),this._commandArg.dockedShape,this.facade)]);this.lastUIObj=this.dockerTarget=this.dockerSource=this.dockerParent=this.docker=void 0},hideHighlight:function(){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"validDockedShape"})},showHighlight:function(a,b){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"validDockedShape",elements:[a],color:b})},showMagnets:function(a){a.magnets.each(function(a){a.show()})},hideMagnets:function(a){a.magnets.each(function(a){a.hide()})},
getHighestParentBeforeCanvas:function(a){if(a instanceof ORYX.Core.Shape){for(a=a.parent;a&&!(a.parent instanceof ORYX.Core.Canvas);)a=a.parent;return a}}});
/* ORYX.Plugins.SelectionFrame */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.SelectionFrame=Clazz.extend({construct:function(a){this.facade=a;this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this));document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.handleMouseUp.bind(this),!0);this.position={x:0,y:0};this.size={width:0,height:0};this.offsetPosition={x:0,y:0};this.moveCallback=void 0;this.offsetScroll={x:0,y:0};this.node=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",this.facade.getCanvas().getHTMLContainer(),["div",
{"class":"Oryx_SelectionFrame"}]);this.hide()},handleMouseDown:function(a,b){if(b instanceof ORYX.Core.Canvas){var c=b.rootNode.parentNode.parentNode,d=this.facade.getCanvas().node.getScreenCTM();this.offsetPosition={x:d.e,y:d.f};this.setPos({x:Event.pointerX(a)-this.offsetPosition.x,y:Event.pointerY(a)-this.offsetPosition.y});this.resize({width:0,height:0});this.moveCallback=this.handleMouseMove.bind(this);document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.moveCallback,!1);
this.offsetScroll={x:c.scrollLeft,y:c.scrollTop};this.show()}Event.stop(a)},handleMouseUp:function(){if(this.moveCallback){this.hide();document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.moveCallback,!1);this.moveCallback=void 0;var a=this.facade.getCanvas().node.getScreenCTM(),b=0<this.size.width?this.position.x:this.position.x+this.size.width,c=0<this.size.height?this.position.y:this.position.y+this.size.height,d=b+Math.abs(this.size.width),f=c+Math.abs(this.size.height),
b=b/a.a,c=c/a.d,d=d/a.a,f=f/a.d;this.facade.setSelection(this.facade.getCanvas().getChildShapes(!0).findAll(function(a){var e=a.absoluteBounds(),a=e.upperLeft(),e=e.lowerRight();return a.x>b&&a.y>c&&e.x<d&&e.y<f?!0:!1}))}},handleMouseMove:function(a){var b={width:Event.pointerX(a)-this.position.x-this.offsetPosition.x,height:Event.pointerY(a)-this.position.y-this.offsetPosition.y},c=this.facade.getCanvas().rootNode.parentNode.parentNode;b.width-=this.offsetScroll.x-c.scrollLeft;b.height-=this.offsetScroll.y-
c.scrollTop;this.resize(b);Event.stop(a)},hide:function(){this.node.style.display="none"},show:function(){this.node.style.display=""},setPos:function(a){this.node.style.top=a.y+"px";this.node.style.left=a.x+"px";this.position=a},resize:function(a){this.setPos(this.position);this.size=Object.clone(a);0>a.width&&(this.node.style.left=this.position.x+a.width+"px",a.width=-a.width);0>a.height&&(this.node.style.top=this.position.y+a.height+"px",a.height=-a.height);this.node.style.width=a.width+"px";this.node.style.height=
a.height+"px"}});
/* ORYX.Plugins.ShapeHighlighting */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.ShapeHighlighting=Clazz.extend({construct:function(a){this.parentNode=a.getCanvas().getSvgContainer();this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.parentNode,["g"]);this.highlightNodes={};a.registerOnEvent(ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,this.setHighlight.bind(this));a.registerOnEvent(ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,this.hideHighlight.bind(this))},setHighlight:function(a){if(a&&a.highlightId){var b=this.highlightNodes[a.highlightId];b||(b=ORYX.Editor.graft("http://www.w3.org/2000/svg",
this.node,["path",{"stroke-width":2,fill:"none"}]),this.highlightNodes[a.highlightId]=b);a.elements&&0<a.elements.length?(this.setAttributesByStyle(b,a),this.show(b)):this.hide(b)}},hideHighlight:function(a){a&&a.highlightId&&this.highlightNodes[a.highlightId]&&this.hide(this.highlightNodes[a.highlightId])},hide:function(a){a.setAttributeNS(null,"display","none")},show:function(a){a.setAttributeNS(null,"display","inherit")},setAttributesByStyle:function(a,b){if(b.style&&b.style==ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_RECTANGLE){var c=
b.elements[0].absoluteBounds(),d=b.strokewidth?b.strokewidth:ORYX.CONFIG.BORDER_OFFSET;a.setAttributeNS(null,"d",this.getPathRectangle(c.a,c.b,d));a.setAttributeNS(null,"stroke",b.color?b.color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR);a.setAttributeNS(null,"stroke-opacity",b.opacity?b.opacity:0.2);a.setAttributeNS(null,"stroke-width",d)}else 1==b.elements.length&&b.elements[0]instanceof ORYX.Core.Edge&&"selection"!=b.highlightId?(a.setAttributeNS(null,"d",this.getPathEdge(b.elements[0].dockers)),a.setAttributeNS(null,
"stroke",b.color?b.color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR),a.setAttributeNS(null,"stroke-opacity",b.opacity?b.opacity:0.2),a.setAttributeNS(null,"stroke-width",ORYX.CONFIG.OFFSET_EDGE_BOUNDS)):(a.setAttributeNS(null,"d",this.getPathByElements(b.elements)),a.setAttributeNS(null,"stroke",b.color?b.color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR),a.setAttributeNS(null,"stroke-opacity",b.opacity?b.opacity:1),a.setAttributeNS(null,"stroke-width",b.strokewidth?b.strokewidth:2))},getPathByElements:function(a){if(a&&
!(0>=a.length)){var b=ORYX.CONFIG.SELECTED_AREA_PADDING,c="";a.each(function(a){if(a){var e=a.absoluteBounds();e.widen(b);a=e.upperLeft();e=e.lowerRight();c+=this.getPath(a,e)}}.bind(this));return c}},getPath:function(a,b){return this.getPathCorners(a,b)},getPathCorners:function(a,b){var c=ORYX.CONFIG.SELECTION_HIGHLIGHT_SIZE,d;d="M"+a.x+" "+(a.y+c)+" l0 -"+c+" l"+c+" 0 ";d=d+"M"+a.x+" "+(b.y-c)+" l0 "+c+" l"+c+" 0 ";d=d+"M"+b.x+" "+(b.y-c)+" l0 "+c+" l-"+c+" 0 ";return d=d+"M"+b.x+" "+(a.y+c)+" l0 -"+
c+" l-"+c+" 0 "},getPathRectangle:function(a,b,c){var d=c/2,c="M"+(a.x+d)+" "+a.y,c=c+" L"+(a.x+d)+" "+(b.y-d),c=c+" L"+(b.x-d)+" "+(b.y-d),c=c+" L"+(b.x-d)+" "+(a.y+d);return c=c+" L"+(a.x+d)+" "+(a.y+d)},getPathEdge:function(a){var b=a.length,c="M"+a[0].bounds.center().x+" "+a[0].bounds.center().y;for(i=1;i<b;i++)var d=a[i].bounds.center(),c=c+" L"+d.x+" "+d.y;return c}});
ORYX.Plugins.HighlightingSelectedShapes=Clazz.extend({construct:function(a){this.facade=a;this.opacityFull=0.9;this.opacityLow=0.4},onSelectionChanged:function(a){a.elements&&1<a.elements.length?(this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"selection",elements:a.elements.without(a.subSelection),color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR,opacity:!a.subSelection?this.opacityFull:this.opacityLow}),a.subSelection?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,
highlightId:"subselection",elements:[a.subSelection],color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR,opacity:this.opacityFull}):this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"subselection"})):(this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"selection"}),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"subselection"}))}});
/* ORYX.Plugins.Edit */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.Edit=Clazz.extend({construct:function(b){this.facade=b;this.clipboard=new ORYX.Plugins.Edit.ClipBoard;this.facade.offer({name:ORYX.I18N.Edit.cut,description:ORYX.I18N.Edit.cutDesc,icon:ORYX.PATH+"images/cut.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:88,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.callEdit.bind(this,this.editCut),group:ORYX.I18N.Edit.group,index:1,minShape:1});this.facade.offer({name:ORYX.I18N.Edit.copy,description:ORYX.I18N.Edit.copyDesc,
icon:ORYX.PATH+"images/page_copy.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:67,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.callEdit.bind(this,this.editCopy,[!0,!1]),group:ORYX.I18N.Edit.group,index:2,minShape:1});this.facade.offer({name:ORYX.I18N.Edit.paste,description:ORYX.I18N.Edit.pasteDesc,icon:ORYX.PATH+"images/page_paste.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:86,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.callEdit.bind(this,
this.editPaste),isEnabled:this.clipboard.isOccupied.bind(this.clipboard),group:ORYX.I18N.Edit.group,index:3,minShape:0,maxShape:0});this.facade.offer({name:ORYX.I18N.Edit.del,description:ORYX.I18N.Edit.delDesc,icon:ORYX.PATH+"images/cross.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:8,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN},{keyCode:46,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.callEdit.bind(this,this.editDelete),group:ORYX.I18N.Edit.group,index:4,minShape:1});
this.facade.registerOnEvent(ORYX.CONFIG.EVENT_FACADE_SELECTION_DELETION_REQUEST,this.editDelete.bind(this))},callEdit:function(b,e){window.setTimeout(function(){b.apply(this,e instanceof Array?e:[])}.bind(this),1)},handleMouseDown:function(b){this._controlPressed&&(this._controlPressed=!1,this.editCopy(),this.editPaste(),b.forceExecution=!0,this.facade.raiseEvent(b,this.clipboard.shapesAsJson))},getAllShapesToConsider:function(b,e){var d=[],a=[];b.each(function(c){isChildShapeOfAnother=b.any(function(a){return a.hasChildShape(c)});
if(!isChildShapeOfAnother){d.push(c);if(c instanceof ORYX.Core.Node){var f=c.getOutgoingNodes(),f=f.findAll(function(a){return!b.include(a)});d=d.concat(f)}a=a.concat(c.getChildShapes(!0));e&&!(c instanceof ORYX.Core.Edge)&&c.getIncomingShapes().concat(c.getOutgoingShapes()).each(function(a){a instanceof ORYX.Core.Edge&&a.properties["oryx-conditionexpression"]&&""!=a.properties["oryx-conditionexpression"]||d.push(a)}.bind(this))}}.bind(this));var c=this.facade.getCanvas().getChildEdges().select(function(c){return d.include(c)||
0===c.getAllDockedShapes().size()?!1:c.getAllDockedShapes().all(function(c){return c instanceof ORYX.Core.Edge||a.include(c)})});return d=d.concat(c)},editCut:function(){this.editCopy(!1,!0);this.editDelete(!0);return!1},editCopy:function(b,e){var d=this.facade.getSelection();0!=d.length&&(this.clipboard.refresh(d,this.getAllShapesToConsider(d),this.facade.getCanvas().getStencil().stencilSet().namespace(),e),b&&this.facade.updateSelection())},editPaste:function(){var b={childShapes:this.clipboard.shapesAsJson,
stencilset:{namespace:this.clipboard.SSnamespace}};Ext.apply(b,ORYX.Core.AbstractShape.JSONHelper);var e=b.getChildShapes(!0).pluck("resourceId"),d={};b.eachChild(function(a){a.outgoing=a.outgoing.select(function(a){return e.include(a.resourceId)});a.outgoing.each(function(c){d[c.resourceId]||(d[c.resourceId]=[]);d[c.resourceId].push(a)});return a}.bind(this),!0,!0);b.eachChild(function(a){a.target&&!e.include(a.target.resourceId)&&(a.target=void 0,a.targetRemoved=!0);if(a.dockers&&1<=a.dockers.length&&
a.dockers[0].getDocker&&(a.dockers[0].getDocker().getDockedShape()&&!e.include(a.dockers[0].getDocker().getDockedShape().resourceId)||!a.getShape().dockers[0].getDockedShape()&&!d[a.resourceId]))a.sourceRemoved=!0;return a}.bind(this),!0,!0);b.eachChild(function(a){this.clipboard.useOffset&&(a.bounds={lowerRight:{x:a.bounds.lowerRight.x+ORYX.CONFIG.COPY_MOVE_OFFSET,y:a.bounds.lowerRight.y+ORYX.CONFIG.COPY_MOVE_OFFSET},upperLeft:{x:a.bounds.upperLeft.x+ORYX.CONFIG.COPY_MOVE_OFFSET,y:a.bounds.upperLeft.y+
ORYX.CONFIG.COPY_MOVE_OFFSET}});if(a.dockers)a.dockers=a.dockers.map(function(c,b){if(!0===a.targetRemoved&&b==a.dockers.length-1&&c.getDocker||!0===a.sourceRemoved&&0==b&&c.getDocker)c=c.getDocker().bounds.center();return 0==b&&c.getDocker instanceof Function&&!0!==a.sourceRemoved&&(c.getDocker().getDockedShape()||0<(d[a.resourceId]||[]).length&&(!(a.getShape()instanceof ORYX.Core.Node)||d[a.resourceId][0].getShape()instanceof ORYX.Core.Node))||b==a.dockers.length-1&&c.getDocker instanceof Function&&
!0!==a.targetRemoved&&(c.getDocker().getDockedShape()||a.target)?{x:c.x,y:c.y,getDocker:c.getDocker}:this.clipboard.useOffset?{x:c.x+ORYX.CONFIG.COPY_MOVE_OFFSET,y:c.y+ORYX.CONFIG.COPY_MOVE_OFFSET,getDocker:c.getDocker}:{x:c.x,y:c.y,getDocker:c.getDocker}}.bind(this));else if(a.getShape()instanceof ORYX.Core.Node&&a.dockers&&0<a.dockers.length&&(!a.dockers.first().getDocker||!0===a.sourceRemoved||!a.dockers.first().getDocker().getDockedShape()&&!d[a.resourceId]))a.dockers=a.dockers.map(function(c,
b){!0===a.sourceRemoved&&0==b&&c.getDocker&&(c=c.getDocker().bounds.center());return this.clipboard.useOffset?{x:c.x+ORYX.CONFIG.COPY_MOVE_OFFSET,y:c.y+ORYX.CONFIG.COPY_MOVE_OFFSET,getDocker:c.getDocker}:{x:c.x,y:c.y,getDocker:c.getDocker}}.bind(this));return a}.bind(this),!1,!0);this.clipboard.useOffset=!0;this.facade.importJSON(b)},editDelete:function(){var b=this.facade.getSelection(),e=new ORYX.Plugins.Edit.ClipBoard;e.refresh(b,this.getAllShapesToConsider(b,!0));this.facade.executeCommands([new ORYX.Plugins.Edit.DeleteCommand(e,
this.facade)])}});
ORYX.Plugins.Edit.ClipBoard=Clazz.extend({construct:function(){this.shapesAsJson=[];this.selection=[];this.SSnamespace="";this.useOffset=!0},isOccupied:function(){return 0<this.shapesAsJson.length},refresh:function(b,e,d,a){this.selection=b;this.SSnamespace=d;this.outgoings={};this.parents={};this.targets={};this.useOffset=!0!==a;this.shapesAsJson=e.map(function(a){var b=a.toJSON();b.parent={resourceId:a.getParentShape().resourceId};b.parentIndex=a.getParentShape().getChildShapes().indexOf(a);return b})}});
ORYX.Plugins.Edit.DeleteCommand=ORYX.Core.Command.extend({construct:function(b,e){this.clipboard=b;this.shapesAsJson=b.shapesAsJson;this.facade=e;this.dockers=this.shapesAsJson.map(function(b){var b=b.getShape(),a=b.getIncomingShapes().map(function(a){return a.getDockers().last()}),c=b.getOutgoingShapes().map(function(a){return a.getDockers().first()});return b.getDockers().concat(a,c).compact().map(function(a){return{object:a,referencePoint:a.referencePoint,dockedShape:a.getDockedShape()}})}).flatten()},
execute:function(){this.shapesAsJson.each(function(b){this.facade.deleteShape(b.getShape())}.bind(this));this.facade.setSelection([]);this.facade.getCanvas().update();this.facade.updateSelection()},rollback:function(){this.shapesAsJson.each(function(b){var e=b.getShape();(this.facade.getCanvas().getChildShapeByResourceId(b.parent.resourceId)||this.facade.getCanvas()).add(e,e.parentIndex)}.bind(this));this.dockers.each(function(b){b.object.setDockedShape(b.dockedShape);b.object.setReferencePoint(b.referencePoint)}.bind(this));
this.facade.setSelection(this.selectedShapes);this.facade.getCanvas().update();this.facade.updateSelection()}});
/* ORYX.Plugins.KeysMove */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.KeysMove=ORYX.Plugins.AbstractPlugin.extend({facade:void 0,construct:function(f){this.facade=f;this.copyElements=[];this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:65,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.selectAll.bind(this)});this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:ORYX.CONFIG.KEY_CODE_LEFT,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_LEFT,!1)});
this.facade.offer({keyCodes:[{keyCode:ORYX.CONFIG.KEY_CODE_LEFT,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_LEFT,!0)});this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:ORYX.CONFIG.KEY_CODE_RIGHT,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_RIGHT,!1)});this.facade.offer({keyCodes:[{keyCode:ORYX.CONFIG.KEY_CODE_RIGHT,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,
ORYX.CONFIG.KEY_CODE_RIGHT,!0)});this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:ORYX.CONFIG.KEY_CODE_UP,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_UP,!1)});this.facade.offer({keyCodes:[{keyCode:ORYX.CONFIG.KEY_CODE_UP,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_UP,!0)});this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:ORYX.CONFIG.KEY_CODE_DOWN,
keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_DOWN,!1)});this.facade.offer({keyCodes:[{keyCode:ORYX.CONFIG.KEY_CODE_DOWN,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_DOWN,!0)})},selectAll:function(f){Event.stop(f.event);this.facade.setSelection(this.facade.getCanvas().getChildShapes(!0))},move:function(f,c,g){Event.stop(g.event);var c=c?20:5,e=this.facade.getSelection(),g=this.facade.getSelection(),
d={x:0,y:0};switch(f){case ORYX.CONFIG.KEY_CODE_LEFT:d.x=-1*c;break;case ORYX.CONFIG.KEY_CODE_RIGHT:d.x=c;break;case ORYX.CONFIG.KEY_CODE_UP:d.y=-1*c;break;case ORYX.CONFIG.KEY_CODE_DOWN:d.y=c}var e=e.findAll(function(a){if(a instanceof ORYX.Core.Node&&1==a.dockers.length&&e.include(a.dockers.first().getDockedShape()))return!1;a=a.parent;do if(e.include(a))return!1;while(a=a.parent);return!0}),h=!0;if(!e.all(function(a){return a instanceof ORYX.Core.Edge?(a.isDocked()&&(h=!1),!0):!1})||h)if(e=e.map(function(a){if(a instanceof
ORYX.Core.Node)return a;if(a instanceof ORYX.Core.Edge){var b=a.dockers;e.include(a.dockers.first().getDockedShape())&&(b=b.without(a.dockers.first()));e.include(a.dockers.last().getDockedShape())&&(b=b.without(a.dockers.last()));return b}return null}).flatten().compact(),0<e.size()){var b=[this.facade.getCanvas().bounds.lowerRight().x,this.facade.getCanvas().bounds.lowerRight().y,0,0];e.each(function(a){b[0]=Math.min(b[0],a.bounds.upperLeft().x);b[1]=Math.min(b[1],a.bounds.upperLeft().y);b[2]=Math.max(b[2],
a.bounds.lowerRight().x);b[3]=Math.max(b[3],a.bounds.lowerRight().y)});0>b[0]+d.x&&(d.x=-b[0]);0>b[1]+d.y&&(d.y=-b[1]);b[2]+d.x>this.facade.getCanvas().bounds.lowerRight().x&&(d.x=this.facade.getCanvas().bounds.lowerRight().x-b[2]);b[3]+d.y>this.facade.getCanvas().bounds.lowerRight().y&&(d.y=this.facade.getCanvas().bounds.lowerRight().y-b[3]);(0!=d.x||0!=d.y)&&this.facade.executeCommands([new ORYX.Core.Command.Move(e,d,null,g,this)])}},getUndockedCommant:function(f){command=new (ORYX.Core.Command.extend({construct:function(c){this.dockers=
c.collect(function(c){return c instanceof ORYX.Core.Controls.Docker?{docker:c,dockedShape:c.getDockedShape(),refPoint:c.referencePoint}:void 0}).compact()},execute:function(){this.dockers.each(function(c){c.docker.setDockedShape(void 0)})},rollback:function(){this.dockers.each(function(c){c.docker.setDockedShape(c.dockedShape);c.docker.setReferencePoint(c.refPoint)})}}))(f);command.execute();return command}});
/* ORYX.Plugins.Layouter.EdgeLayouter */
ORYX.Plugins||(ORYX.Plugins={});ORYX.Plugins.Layouter||(ORYX.Plugins.Layouter={});
new function(){ORYX.Plugins.Layouter.EdgeLayouter=ORYX.Plugins.AbstractLayouter.extend({layouted:[],findRelatedEdges:function(a,b){edges=[];this.isIncludedInEdgeIds(a)?edges.push(a):this.getChildShapesWithout(a,b).each(function(a){edges=edges.concat(a.outgoing).concat(a.incoming).concat(this.findRelatedEdges(a,b))}.bind(this));return edges},isIncludedInEdgeIds:function(a){return"function"==typeof a.getStencil?"edge"==a.getStencil().type():!1},layout:function(a){a.each(function(a){this.findRelatedEdges(a,
[]).each(function(a){this.doLayout(a)}.bind(this))}.bind(this))},doLayout:function(a){var b=a.getIncomingNodes()[0],f=a.getOutgoingNodes()[0];b&&f&&(b=this.getPositions(b,f,a),0<b.length&&this.setDockers(a,b[0].a,b[0].b))},getPositions:function(a,b,f){var c=a.absoluteBounds(),g=b.absoluteBounds(),d=c.center(),e=g.center(),i=c.midPoint(),m=g.midPoint(),n=Object.clone(f.dockers.first().referencePoint),o=Object.clone(f.dockers.last().referencePoint),j=f.dockers.first().getAbsoluteReferencePoint(),k=
f.dockers.last().getAbsoluteReferencePoint();if(1>Math.abs(j.x-k.x)||1>Math.abs(j.y-k.y))return[];j=d.x<e.x?(e.x-g.width()/2-(d.x+c.width()/2))/2+(d.x+c.width()/2):(d.x-c.width()/2-(e.x+g.width()/2))/2+(e.x+g.width()/2);k=d.y<e.y?(e.y-g.height()/2-(d.y+c.height()/2))/2+(d.y+c.height()/2):(d.y-c.height()/2-(e.y+g.height()/2))/2+(e.y+g.height()/2);c.widen(5);g.widen(20);var l=[],h=this.getOffset.bind(this);!c.isIncluded(e.x,d.y)&&!g.isIncluded(e.x,d.y)&&l.push({a:{x:e.x+h(o,m,"x"),y:d.y+h(n,i,"y")},
z:this.getWeight(a,d.x<e.x?"r":"l",b,d.y<e.y?"t":"b",f)});!c.isIncluded(d.x,e.y)&&!g.isIncluded(d.x,e.y)&&l.push({a:{x:d.x+h(n,i,"x"),y:e.y+h(o,m,"y")},z:this.getWeight(a,d.y<e.y?"b":"t",b,d.x<e.x?"l":"r",f)});!c.isIncluded(j,d.y)&&!g.isIncluded(j,e.y)&&l.push({a:{x:j,y:d.y+h(n,i,"y")},b:{x:j,y:e.y+h(o,m,"y")},z:this.getWeight(a,"r",b,"l",f,d.x>e.x)});!c.isIncluded(d.x,k)&&!g.isIncluded(e.x,k)&&l.push({a:{x:d.x+h(n,i,"x"),y:k},b:{x:e.x+h(o,m,"x"),y:k},z:this.getWeight(a,"b",b,"t",f,d.y>e.y)});return l.sort(function(a,
b){return a.z<b.z?1:a.z==b.z?-1:-1})},getOffset:function(a,b,f){return a[f]-b[f]},getWeight:function(a,b,f,c,g,d){b=(b||"").toLowerCase();c=(c||"").toLowerCase();["t","r","b","l"].include(b)||(b="r");["t","r","b","l"].include(c)||(b="l");d&&(b="t"==b?"b":"r"==b?"l":"b"==b?"t":"l"==b?"r":"r",c="t"==c?"b":"r"==c?"l":"b"==c?"t":"l"==c?"r":"r");var d=this.facade.getRules().getLayoutingRules(a,g).out,e=this.facade.getRules().getLayoutingRules(f,g)["in"],g=d[b],d=e[c],i=function(a,b,c){switch(a){case "t":return 2>
Math.abs(b.x-c.x)&&b.y<c.y;case "r":return b.x>c.x&&2>Math.abs(b.y-c.y);case "b":return 2>Math.abs(b.x-c.x)&&b.y>c.y;case "l":return b.x<c.x&&2>Math.abs(b.y-c.y);default:return!1}},a=a.getIncomingShapes().findAll(function(a){return a instanceof ORYX.Core.Edge}).any(function(a){return i(b,a.dockers[a.dockers.length-2].bounds.center(),a.dockers.last().bounds.center())}),f=f.getOutgoingShapes().findAll(function(a){return a instanceof ORYX.Core.Edge}).any(function(a){return i(c,a.dockers[1].bounds.center(),
a.dockers.first().bounds.center())});return a||f?0:g+d},setDockers:function(a,b,f){a&&(a.dockers.each(function(b){a.removeDocker(b)}),[b,f].compact().each(function(b){a.createDocker(void 0,b).bounds.centerMoveTo(b)}),a.dockers.each(function(a){a.update()}),a._update(!0))}})};
/* ORYX.Plugins.SyntaxChecker */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.SyntaxChecker=ORYX.Plugins.AbstractPlugin.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments);this.active=!1;this.raisedEventIds=[];this.facade.offer({name:ORYX.I18N.SyntaxChecker.name,functionality:this.perform.bind(this),group:ORYX.I18N.View.jbpmgroup,icon:ORYX.PATH+"images/checker_syntax.png",description:ORYX.I18N.SyntaxChecker.desc,index:6,toggle:!0,minShape:0,maxShape:0});this.facade.registerOnEvent(ORYX.Plugins.SyntaxChecker.CHECK_FOR_ERRORS_EVENT,this.checkForErrors.bind(this));
this.facade.registerOnEvent(ORYX.Plugins.SyntaxChecker.RESET_ERRORS_EVENT,this.resetErrors.bind(this));this.facade.registerOnEvent(ORYX.Plugins.SyntaxChecker.SHOW_ERRORS_EVENT,this.doShowErrors.bind(this))},perform:function(a,b){b?this.checkForErrors({onNoErrors:function(){this.setActivated(a,!1);this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_LOADING_STATUS,text:ORYX.I18N.SyntaxChecker.noErrors,timeout:1E4});Ext.Msg.alert(ORYX.I18N.Oryx.title,ORYX.I18N.SyntaxChecker.noErrors)}.bind(this),onErrors:function(){this.enableDeactivationHandler(a)}.bind(this),
onFailure:function(){this.setActivated(a,!1);Ext.Msg.alert(ORYX.I18N.Oryx.title,ORYX.I18N.SyntaxChecker.invalid)}.bind(this)}):this.resetErrors()},enableDeactivationHandler:function(a){var b=function(){this.setActivated(a,!1);this.resetErrors();this.facade.unregisterOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,b)};this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,b.bind(this))},setActivated:function(a,b){a.toggle(b);this.active=void 0===b?!this.active:b},checkForErrors:function(a){Ext.applyIf(a||{},
{showErrors:!0,onErrors:Ext.emptyFn,onNoErrors:Ext.emptyFn,onFailure:Ext.emptyFn});Ext.Msg.wait(ORYX.I18N.SyntaxChecker.checkingMessage);this.facade.getStencilSets();var b=ORYX.EDITOR.getSerializedJSON();new Ajax.Request(ORYX.PATH+"syntaxcheck",{method:"POST",asynchronous:!1,parameters:{data:b,profile:ORYX.PROFILE,pp:ORYX.PREPROCESSING,uuid:ORYX.UUID},onSuccess:function(b){b=(b&&b.responseText?b.responseText:"{}").evalJSON();Ext.Msg.hide();if(b instanceof Object)if(b=$H(b),0<b.size())a.showErrors&&
this.showErrors(b),a.onErrors();else a.onNoErrors();else a.onFailure()}.bind(this),onFailure:function(){Ext.Msg.hide();a.onFailure()}})},doShowErrors:function(a){this.showErrors(a.errors)},showErrors:function(a){a instanceof Hash||(a=new Hash(a));a.keys().each(function(b){var c=this.facade.getCanvas().getChildShapeByResourceId(b);c?this.raiseOverlay(c,this.parseCodeToMsg(a[b])):this.raiseOverlay(this.facade.getCanvas().nodes[0],this.parseCodeToMsg(a[b]))}.bind(this));this.active=!this.active;this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_LOADING_STATUS,
text:ORYX.I18N.SyntaxChecker.notice,timeout:1E4})},parseCodeToMsg:function(a){for(var b="",c=0;c<a.length;c++)b+="   * "+a[c]+"<br />";return b},parseSingleCodeToMsg:function(a){return ORYX.I18N.SyntaxChecker[a]||a},resetErrors:function(){this.raisedEventIds.each(function(a){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_OVERLAY_HIDE,id:a})}.bind(this));this.raisedEventIds=[];this.active=!1},raiseOverlay:function(a,b){var c="syntaxchecker."+this.raisedEventIds.length,d=ORYX.Editor.provideId(),e=ORYX.Editor.graft("http://www.w3.org/2000/svg",
null,["path",{id:d,title:"","stroke-width":5,stroke:"red",d:"M20,-5 L5,-20 M5,-5 L20,-20","line-captions":"round"}]);this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_OVERLAY_SHOW,id:c,shapes:[a],node:e,nodePosition:a instanceof ORYX.Core.Edge?"SW":"SYNTAX_CHECKS"});new Ext.ToolTip({title:"\u9a8c\u8bc1\u7ed3\u679c:",showDelay:50,html:b,target:d});this.raisedEventIds.push(c);return e}});ORYX.Plugins.SyntaxChecker.CHECK_FOR_ERRORS_EVENT="checkForErrors";ORYX.Plugins.SyntaxChecker.RESET_ERRORS_EVENT="resetErrors";
ORYX.Plugins.SyntaxChecker.SHOW_ERRORS_EVENT="showErrors";ORYX.Plugins.PetrinetSyntaxChecker=ORYX.Plugins.SyntaxChecker.extend({getRDFFromDOM:function(){return this.facade.getERDF()}});
/* ORYX.Plugins.RegexTextEditor */
ORYX.Plugins||(ORYX.Plugins={});ORYX.Plugins.RegexTextEditor=Clazz.extend({construct:function(b){this.facade=b;ORYX.FieldEditors.regex=new ORYX.Plugins.RegexTextEditor.EditorFactory}});
ORYX.Plugins.RegexTextEditor.EditorFactory=Clazz.extend({construct:function(){},init:function(b,a){var c=new Ext.form.TextArea({alignment:"tl-tl",allowBlank:a.optional(),msgTarget:"title",maxLength:a.length(),regex:a._jsonProp.regex,regexText:a._jsonProp.invalidText});c.on("keyup",function(a){c.validate()&&this.editDirectly(b,a.getValue())}.bind(this));return new Ext.Editor(c)}});
/* ORYX.Plugins.ConstraintExpressionEditor */
ORYX.Plugins||(ORYX.Plugins={});var guvnorPopupEditor;
ORYX.Plugins.ConstraintExpressionEditor=Clazz.extend({construct:function(b,c){this.facade=b;ORYX.CONFIG.GUVNOR_USE_FIXED_PACKAGE=!1;ORYX.CONFIG.GUVNOR_FIXED_PACKAGE="mortgages";ORYX.CONFIG.GUVNOR_CATEGORY="Home Mortgage";ORYX.CONFIG.GUVNOR_HIDE_RHS=!0;ORYX.CONFIG.GUVNOR_HIDE_ATTRIBUTES=!0;c.properties&&c.properties.each(function(a){a.useFixedPackage&&(ORYX.CONFIG.GUVNOR_USE_FIXED_PACKAGE="true"==a.useFixedPackage);a.fixedPackage&&(ORYX.CONFIG.GUVNOR_FIXED_PACKAGE=a.fixedPackage);a.category&&(ORYX.CONFIG.GUVNOR_CATEGORY=
a.category);a.hideRHS&&(ORYX.CONFIG.GUVNOR_HIDE_RHS="true"==a.hideRHS);a.hideAttributes&&(ORYX.CONFIG.GUVNOR_HIDE_ATTRIBUTES="true"==a.hideAttributes)}.bind(this));ORYX.FieldEditors.simpleconstraintexpressioneditor=new ORYX.Plugins.ConstraintExpressionEditor.SimpleConstraintExpressionEditorFactory;ORYX.FieldEditors.contextawareconstraintexpressioneditor=new ORYX.Plugins.ConstraintExpressionEditor.ContextAwareConstraintExpressionEditorFactory}});
ORYX.Plugins.ConstraintExpressionEditor.SimpleConstraintExpressionEditorFactory=Clazz.extend({construct:function(){},init:function(b,c,a,d){return(new ORYX.Plugins.ConstraintExpressionEditor.BaseConstraintExpressionEditorFactory).createEditor.bind(this)(!1,b,c,d)}});
ORYX.Plugins.ConstraintExpressionEditor.ContextAwareConstraintExpressionEditorFactory=Clazz.extend({construct:function(){},init:function(b,c,a,d){return(new ORYX.Plugins.ConstraintExpressionEditor.BaseConstraintExpressionEditorFactory).createEditor.bind(this)(!0,b,c,d)}});
ORYX.Plugins.ConstraintExpressionEditor.BaseConstraintExpressionEditorFactory=Clazz.extend({construct:function(){},createEditor:function(b,c,a,d){var g=!0;if(a._jsonProp.showConstraintEditorWhen){g=a._jsonProp.showConstraintEditorWhen.property;if(!g)return alert("Error reading definition of showConstraintEditorWhen: 'property' is missing!"),null;var h=a._jsonProp.showConstraintEditorWhen.value;if(!h)return alert("Error reading definition of showConstraintEditorWhen: 'value' is missing!"),null;g=this.shapeSelection.shapes[0].properties[a.prefix()+
"-"+g]==h}g?guvnorPopupEditor=b=new Ext.form.GuvnorPopupEditor(b?this.shapeSelection.shapes[0]:void 0,function(a){this.editDirectly(c,a)}.bind(this)):(b=new Ext.form.ComplexTextField({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:d,facade:this.facade}),b.on("dialogClosed",this.dialogClosed,{scope:this,row:d,col:1,field:b}));return new Ext.Editor(b)}});
Ext.form.GuvnorPopupEditor=function(b,c){var a="",d="";Ext.form.GuvnorPopupEditor.superclass.constructor.call(this,{defaultAutoCreate:{tag:"textarea",rows:1,style:"height:16px;overflow:hidden;"},onTriggerClick:function(){if(!this.disabled){var g=document.body.clientWidth-20,h=document.body.clientHeight-20,c=ORYX.EXTERNAL_PROTOCOL+"://"+ORYX.EXTERNAL_HOST+"/"+ORYX.EXTERNAL_SUBDOMAIN+"/org.drools.guvnor.Guvnor/standaloneEditorServlet",e=[];e.push({name:"client",value:""});var f=ORYX.CONFIG.GUVNOR_FIXED_PACKAGE;
if(!ORYX.CONFIG.GUVNOR_USE_FIXED_PACKAGE){f=ORYX.EDITOR.getJSON();if(!(f.properties["package"]&&""!=f.properties["package"])){alert("Please configure Process' 'package' attribute first");return}f=f.properties["package"]}e.push({name:"packageName",value:f});e.push({name:"categoryName",value:ORYX.CONFIG.GUVNOR_CATEGORY});e.push({name:"hideRuleRHS",value:""+ORYX.CONFIG.GUVNOR_HIDE_RHS});e.push({name:"hideRuleAttributes",value:""+ORYX.CONFIG.GUVNOR_HIDE_ATTRIBUTES});""==a?e.push({name:"brlSource",value:"<rule><name>Condition Constraint</name><modelVersion>1.0</modelVersion><attributes></attributes><metadataList/><lhs></lhs><rhs></rhs></rule>"}):
e.push({name:"brlSource",value:a});if(b){f=collectNodesInPath(b,/ModelEntity/);f=f.concat(collectNodesInPath(b,/Model_/));if(!f||0==f.length){alert("You must define at least 1 Model Entity in your process!");return}var d=[],m=[];f.each(function(a){var g=a.properties["oryx-modelentity"],b=a.properties["oryx-fieldconstraint"],a=a.properties["oryx-constraintvalue"];g?b?a?m.push("{"+g+"--@--"+b+"--@--"+a+"}"):d.push("You must specify a value for '"+g+"."+b+"' Model Entity"):d.push("You must specify a field for '"+
g+"' Model Entity"):d.push("Fact Name is mandatory!")});if(0<d.length){this.showErrors(d);return}var k="";new Ajax.Request("/designer/workingSet",{asynchronous:!1,method:"POST",parameters:{action:"createWorkingSetWithMandatoryConstraint",config:m},onSuccess:function(a){k=a.responseText}.bind(this),onFailure:function(a){d.push("Error getting Working Set Definition: "+a.responseText)}.bind(this)});if(0<d.length){this.showErrors(d);return}alert(k);e.push({name:"workingSetXMLDefinitions",value:k})}if(0<
e.length)for(var f=0,l="",c=c+"?",f=0;f<e.length;f++){var i=e[f],i=l+i.name+"="+encodeURIComponent(i.value);""==l&&(l="&amp;");c+=i}(new Ext.Window({id:"guvnorWindow",layout:"fit",width:g,height:h,closeAction:"close",plain:!0,modal:!0,title:"Title",autoScroll:!0,resizable:!0,html:'<iframe id="guvnorFrame" name="guvnorFrame" width="'+g+'" height="'+h+'"  onload="attachCallbacksToGuvnor();" src="'+c+'"></iframe>'})).show()}},showErrors:function(a){var b="Errors:";a.each(function(a){b+="\n\t"+a});alert(b)},
encodeBRL:function(){var g="";if(a)for(var b=a.split("\n"),d=0;d<b.length;d++)var e=b[d],e=encodeURIComponent(e),e="#-#"+e,g=g+(e+"\n");return g},trimDRL:function(){var a="";if(d)for(var b=!1,c=d.split("\n"),e=0;e<c.length;e++){var f=c[e],f=f.replace(/^\s+/,"").replace(/\s+$/,"");if("then"==f)break;b&&(a+=f+"\n");"when"==f&&(b=!0)}return a},getValue:function(){var a;a=""+this.encodeBRL();return a=a+"\n"+this.trimDRL()},closeGuvnorWindow:function(){Ext.getCmp("guvnorWindow").close()},guvnorSaveAndCloseButtonCallback:function(){getGuvnorFrame(top).guvnorEditorObject.getBRL(function(a){this.setBRLValue(a);
getGuvnorFrame(top).guvnorEditorObject.getDRL(function(a){this.setDRLValue(a);this.closeGuvnorWindow();c&&c(this.getValue())}.bind(this))}.bind(this))},guvnorCancelButtonCallback:function(){this.closeGuvnorWindow()},setValue:function(b){a=d="";for(var c=/^#-#.*/,b=b.split("\n"),j=0;j<b.length;j++){var e=b[j];e.match(c)?a+=decodeURIComponent(e.substring(3))+"\n":d+=e+"\n"}},getDRLValue:function(){return d},setDRLValue:function(a){d=a},getBRLValue:function(){return a},setBRLValue:function(b){a=b}})};
Ext.extend(Ext.form.GuvnorPopupEditor,Ext.form.TriggerField,{});
function attachCallbacksToGuvnor(){getGuvnorFrame(top).guvnorEditorObject?(getGuvnorFrame(top).guvnorEditorObject.registerAfterSaveAndCloseButtonCallbackFunction(guvnorPopupEditor.guvnorSaveAndCloseButtonCallback.bind(guvnorPopupEditor)),getGuvnorFrame(top).guvnorEditorObject.registerAfterCancelButtonCallbackFunction(guvnorPopupEditor.guvnorCancelButtonCallback.bind(guvnorPopupEditor))):setTimeout("this.attachCallbacksToGuvnor()",1E3)}
function getGuvnorFrame(b){if(b.frames.guvnorFrame)return b.frames.guvnorFrame;for(var c=0;c<b.frames.length;c++){var a=getGuvnorFrame(b.frames[c]);if(a)return a}return null}function collectNodesInPath(b,c){if(!b.incoming||0==b.incoming.length)return[];var a=[];b.incoming.each(function(b){b._stencil._jsonStencil.id.match(c)&&a.push(b);a=a.concat(collectNodesInPath(b,c))});return a};
/* ORYX.Plugins.Overlay */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.Overlay=Clazz.extend({facade:void 0,styleNode:void 0,construct:function(a){this.facade=a;this.changes=[];this.facade.registerOnEvent(ORYX.CONFIG.EVENT_OVERLAY_SHOW,this.show.bind(this));this.facade.registerOnEvent(ORYX.CONFIG.EVENT_OVERLAY_HIDE,this.hide.bind(this));this.styleNode=document.createElement("style");this.styleNode.setAttributeNS(null,"type","text/css");document.getElementsByTagName("head")[0].appendChild(this.styleNode)},show:function(a){if(a&&a.shapes&&!(!a.shapes instanceof
Array||!a.id||!a.id instanceof String||0==a.id.length)){a.attributes&&a.shapes.each(function(b){!b instanceof ORYX.Core.Shape||this.setAttributes(b.node,a.attributes)}.bind(this));var c=!0;try{c=a.node&&a.node instanceof SVGElement}catch(b){}a.node&&c&&(a._temps=[],a.shapes.each(function(b){if(!(!b instanceof ORYX.Core.Shape)){var c={};c.svg=a.dontCloneNode?a.node:a.node.cloneNode(!0);b.node.firstChild.appendChild(c.svg);b instanceof ORYX.Core.Edge&&!a.nodePosition&&(a.nodePosition="START");if(a.nodePosition){var d=
b.bounds,e=a.nodePosition.toUpperCase();b instanceof ORYX.Core.Node&&"START"==e?e="NW":b instanceof ORYX.Core.Node&&"END"==e?e="SE":b instanceof ORYX.Core.Edge&&"START"==e?d=b.getDockers().first().bounds:b instanceof ORYX.Core.Edge&&"END"==e&&(d=b.getDockers().last().bounds);c.callback=function(){var a=0,f=0;if("NW"!=e)if("N"==e)a=d.width()/2;else if("NE"==e)a=d.width();else if("E"==e)a=d.width(),f=d.height()/2;else if("SE"==e)a=d.width(),f=d.height();else if("S"==e)a=d.width()/2,f=d.height();else if("SW"==
e)f=d.height();else if("W"==e)f=d.height()/2;else if("START"==e||"END"==e)a=d.width()/2,f=d.height()/2;else if("CANVAS_TITLE_FORM"==e)a=10,f=20;else if("CANVAS_TITLE"==e)a=40,f=43;else if("SYNTAX_CHECKS"==e)a=-25,f=d.height()+7.5-15;else if("SIMMODELMAX"==e)a=d.width()/2-10,f=d.height();else if("SIMMODELMIN"==e)a=d.width()/2-10,f=d.height()-10;else if("SIMMODELAVG"==e)a=d.width()/2-10,f=d.height()-20;else return;b instanceof ORYX.Core.Edge&&(a+=d.upperLeft().x,f+=d.upperLeft().y);c.svg.setAttributeNS(null,
"transform","translate("+a+", "+f+")")}.bind(this);c.element=b;c.callback();d.registerCallback(c.callback)}if(a.ghostPoint){var g={x:0,y:0},g=a.ghostPoint;c.callback=function(){var a=0,b=0,a=g.x-7,b=g.y-7;c.svg.setAttributeNS(null,"transform","translate("+a+", "+b+")")}.bind(this);c.element=b;c.callback();d.registerCallback(c.callback)}a.labelPoint&&(g={x:0,y:0},g=a.labelPoint,c.callback=function(){var a=0,b=0,a=g.x,b=g.y;c.svg.setAttributeNS(null,"transform","translate("+a+", "+b+")")}.bind(this),
c.element=b,c.callback(),d.registerCallback(c.callback));a._temps.push(c)}}.bind(this)));this.changes[a.id]||(this.changes[a.id]=[]);this.changes[a.id].push(a)}},hide:function(a){if(a&&a.id&&!(!a.id instanceof String||0==a.id.length||!this.changes[a.id]))this.changes[a.id].each(function(a){a.shapes.each(function(a){!a instanceof ORYX.Core.Shape||this.deleteAttributes(a.node)}.bind(this));a._temps&&a._temps.each(function(a){a.svg&&a.svg.parentNode&&a.svg.parentNode.removeChild(a.svg);a.callback&&a.element&&
a.element.bounds.unregisterCallback(a.callback)}.bind(this))}.bind(this)),this.changes[a.id]=null},setAttributes:function(a,c){var b=[];this.getAllChilds(a.firstChild.firstChild).each(function(a){b.push($A(a.attributes).findAll(function(a){return a.nodeValue.startsWith("url(#")}))});b=b.flatten().compact();b=b.collect(function(a){return a.nodeValue}).uniq();b=b.collect(function(a){return a.slice(5,a.length-1)});b.unshift(a.id+" .me");var h=$H(c).toJSON().gsub(",",";").gsub('"',""),i=c.stroke?h.slice(0,
h.length-1)+"; fill:"+c.stroke+";}":h,d;if(c.fill){var e=Object.clone(c);e.fill="black";d=$H(e).toJSON().gsub(",",";").gsub('"',"")}csstags=b.collect(function(a,b){return"#"+a+" * "+(!b?h:i)+""+(d?" #"+a+" text * "+d:"")});e=csstags.join(" ")+"\n";this.styleNode.appendChild(document.createTextNode(e))},deleteAttributes:function(a){$A(this.styleNode.childNodes).findAll(function(c){return c.textContent.include("#"+a.id)}).each(function(a){a.parentNode.removeChild(a)})},getAllChilds:function(a){var c=
$A(a.childNodes);$A(a.childNodes).each(function(a){c.push(this.getAllChilds(a))}.bind(this));return c.flatten()}});
/* ORYX.Plugins.Dictionary */
ORYX.Plugins||(ORYX.Plugins={});ORYX.Config||(ORYX.Config={});ORYX.Config.Dictionary={};ORYX.Dictionary||(ORYX.Dictionary={});ORYX.Dictionary.DictionaryDef=Ext.data.Record.create([{name:"name"},{name:"aliases"},{name:"description"}]);ORYX.Dictionary.DictionaryProxy=new Ext.data.MemoryProxy({root:[]});
ORYX.Dictionary.Dictionaryitems=new Ext.data.Store({autoDestroy:!0,reader:new Ext.data.JsonReader({root:"root"},ORYX.Dictionary.DictionaryDef),proxy:ORYX.Dictionary.DictionaryProxy,sorters:[{property:"name",direction:"ASC"}]});ORYX.Dictionary.Dictionaryitems.load();
ORYX.Plugins.Dictionary=Clazz.extend({construct:function(a){this.facade=a;this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DICTIONARY_ADD,this.initAndShowDictionary.bind(this));this.initDictionary()},initAndShowDictionary:function(a){this.initDictionary(this.showDictionary,a)},initDictionary:function(a,b){Ext.Ajax.request({url:ORYX.PATH+"dictionary",method:"POST",success:function(c){try{ORYX.Dictionary.Dictionaryitems.removeAll();var d=Ext.decode(c.responseText);if(0<d.length&&"false"!=d)for(c=0;c<d.length;c++){var f=
d[c],e="",j="",k="",i;for(i in f){var h=i,g=f[i];"name"==h?g&&(e=g):"aliases"==h?g&&(j=g):"description"==h?g&&(k=g):Ext.Msg.alert("Error reading Process Dictionary. Invalid item: "+h)}ORYX.Dictionary.Dictionaryitems.add(new ORYX.Dictionary.DictionaryDef({name:e,aliases:j,description:k}))}b&&b.entry&&0<b.entry.length&&ORYX.Dictionary.Dictionaryitems.add(new ORYX.Dictionary.DictionaryDef({name:b.entry,aliases:"",description:""}));ORYX.Dictionary.Dictionaryitems.commitChanges();a&&a()}catch(l){Ext.Msg.alert("Error loading Process Dictionary :\n"+
l)}}.bind(this),failure:function(){Ext.Msg.alert("Error loading Process Dictionary.")},params:{action:"load",profile:ORYX.PROFILE,uuid:ORYX.UUID}})},showDictionary:function(){var a=new Extensive.grid.ItemDeleter,b=Ext.id(),c=new Ext.grid.EditorGridPanel({store:ORYX.Dictionary.Dictionaryitems,id:b,stripeRows:!0,cm:new Ext.grid.ColumnModel([new Ext.grid.RowNumberer,{id:"name",header:"Name",width:100,dataIndex:"name",editor:new Ext.form.TextField({allowBlank:!1})},{id:"aliases",header:"Aliases",width:100,
dataIndex:"aliases",editor:new Ext.form.TextField({allowBlank:!0})},{id:"description",header:"Description",width:100,dataIndex:"description",editor:new Ext.form.TextField({allowBlank:!0})},a]),selModel:a,autoHeight:!0,tbar:[{text:"Add New Entry",handler:function(){ORYX.Dictionary.Dictionaryitems.add(new ORYX.Dictionary.DictionaryDef({name:"",aliases:"",description:""}));c.fireEvent("cellclick",c,ORYX.Dictionary.Dictionaryitems.getCount()-1,1,null)}}],clicksToEdit:1}),a=ORYX.EDITOR.getSerializedJSON(),
a=jsonPath(a.evalJSON(),"$.properties.documentation"),d="",d=a&&0<a[0].length?a[0]:"No process documentation specified.",a=new Ext.Button({text:"Process Documentation",handler:function(){Ext.getCmp("processdocs").setValue(d)}}),b=new Ext.form.FormPanel({title:"<center>From Documentation</center>",bodyStyle:"padding:5px",autoScroll:!1,height:60,items:[a],layoutConfig:{padding:"5",align:"middle"}}),a=new Ext.form.FormPanel({baseCls:"x-plain",labelWidth:50,defaultType:"textfield",autoScroll:!1,items:[{fieldLabel:"Select",
name:"subject",inputType:"file",style:"margin-bottom:10px;display:block;width:100px",itemCls:"ext_specific_window_overflow"}]}),f=new Ext.form.FormPanel({title:"<center>From File</center>",bodyStyle:"padding:5px",autoScroll:!1,height:60,items:[a],layoutConfig:{padding:"5",align:"middle"}}),b=new Ext.Panel({header:!1,width:"100%",layout:"column",border:!1,layoutConfig:{columns:2,pack:"center",align:"middle"},items:[{columnWidth:0.3,items:b},{columnWidth:0.7,items:f}]}),f=new Ext.Panel({title:'<center>Highlight text and click on "Add"</center>',
width:"100%",height:350,layout:"column",autoScroll:!1,bodyStyle:"padding:5px",items:[{id:"processdocs",xtype:"textarea",hideLabel:!0,name:"processtextbox",grow:!1,width:"100%",height:280,preventScrollbars:!1,style:{overflow:"auto"}}],tbar:[{text:"Add",handler:function(){var a=document.getElementById("processdocs");(a=a.value.substring(a.selectionStart,a.selectionEnd))&&0<a.length&&ORYX.Dictionary.Dictionaryitems.add(new ORYX.Dictionary.DictionaryDef({name:a,aliases:"",description:""}))}}]}),b=new Ext.Panel({id:"processdocspanel",
title:"<center>Extract Dictionary entries</center>",layout:"column",items:[b,f],layoutConfig:{columns:1},defaults:{columnWidth:1}}),b=new Ext.Panel({header:!1,layout:"column",items:[{columnWidth:0.4,items:c},{columnWidth:0.6,items:b}]}),e=new Ext.Window({layout:"anchor",autoCreate:!0,title:"Process Dictionary Editor",height:530,width:960,modal:!0,collapsible:!1,fixedcenter:!0,shadow:!0,resizable:!0,proxyDrag:!0,autoScroll:!0,keys:[{key:27,fn:function(){e.hide()}.bind(this)}],items:[b],listeners:{hide:function(){e.destroy()}.bind(this)},
buttons:[{text:"Save",handler:function(){ORYX.Dictionary.Dictionaryitems.commitChanges();for(var a=[],b="",b=ORYX.Dictionary.Dictionaryitems.getRange(),c=0;c<b.length;c++)a.push(b[c].data);var b=Ext.util.JSON.encode(a),d=new Ext.LoadMask(Ext.getBody(),{msg:"Storing Process Dictionary"});d.show();Ext.Ajax.request({url:ORYX.PATH+"dictionary",method:"POST",success:function(){try{d.hide(),e.hide()}catch(a){Ext.Msg.alert("Error saving Process Dictionary :\n"+a)}}.createDelegate(this),failure:function(){Ext.Msg.alert("Error saving Process Dictionary")},
params:{action:"save",profile:ORYX.PROFILE,uuid:ORYX.UUID,dvalue:b}})}.bind(this)},{text:"Cancel",handler:function(){e.hide()}.bind(this)}]});e.show();c.render();c.focus(!1,100);a.items.items[0].getEl().dom.addEventListener("change",function(a){var b=new FileReader;b.onload=function(a){Ext.getCmp("processdocs").setValue(a.target.result)};b.readAsText(a.target.files[0],"UTF-8")},!0)},_tobr:function(a){return a.replace(/(\r\n|[\r\n])/g,"<br />")}});
/* ORYX.Plugins.ExtendedDataAssignmentEditor */
ORYX.Plugins||(ORYX.Plugins={});ORYX.Plugins.ExtendedDataAssignmentEditor=Clazz.extend({facade:void 0,construct:function(a){this.facade=a;ORYX.FieldEditors.extendeddataassignment=new ORYX.Plugins.ExtendedDataAssignmentEditor.EditorFactory}});
ORYX.Plugins.ExtendedDataAssignmentEditor.EditorFactory=Clazz.extend({construct:function(){},init:function(a,b,h,c){a=new Ext.form.ExtendedDataAssignmentEditor({allowBlank:b.optional(),dataSource:this.dataSource,grid:this.grid,row:c,facade:this.facade,shapes:this.shapeSelection.shapes});a.on("dialogClosed",this.dialogClosed,{scope:this,row:c,col:1,field:a});return new Ext.Editor(a)}});
Ext.form.ExtendedDataAssignmentEditor=function(a){var b={onTriggerClick:function(){var a=Ext.form.ExtendedDataAssignmentEditor.superclass.onTriggerClick.call(this);if(!a)return null;var b=a.getColumnModel().getCellEditor;a.getColumnModel().getCellEditor=function(d,e){if(5==d){var f=a.getStore().getAt(e),g=ORYX.AssociationEditors[f.get("dataType")];if(void 0!==g)return g.init.bind(this,a,f)()}return b.call(a.getColumnModel(),d,e)}}};a?Ext.applyIf(a,b):a=b;Ext.form.ExtendedDataAssignmentEditor.superclass.constructor.call(this,
a)};Ext.extend(Ext.form.ExtendedDataAssignmentEditor,Ext.form.ComplexDataAssignmenField,{});
/* ORYX.Plugins.FieldDataAssignmentEditors */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.FieldDataAssignmentEditors=Clazz.extend({facade:void 0,construct:function(a){this.facade=a;a=new ORYX.Plugins.FieldDataAssignmentEditors.DateFieldEditorFactory;ORYX.AssociationEditors["java.util.Date"]=a;ORYX.AssociationEditors.Date=a;a=new ORYX.Plugins.FieldDataAssignmentEditors.IntegerFieldEditorFactory;ORYX.AssociationEditors["java.lang.Integer"]=a;ORYX.AssociationEditors.Integer=a;ORYX.AssociationEditors["int"]=a;a=new ORYX.Plugins.FieldDataAssignmentEditors.FloatFieldEditorFactory;ORYX.AssociationEditors["java.lang.Double"]=
a;ORYX.AssociationEditors["java.lang.Float"]=a;ORYX.AssociationEditors.Float=a;ORYX.AssociationEditors.Double=a;ORYX.AssociationEditors["float"]=a;ORYX.AssociationEditors["double"]=a;a=new ORYX.Plugins.FieldDataAssignmentEditors.BooleanFieldEditorFactory;ORYX.AssociationEditors["java.lang.Boolean"]=a;ORYX.AssociationEditors.Boolean=a;ORYX.AssociationEditors["boolean"]=a}});ORYX.Plugins.FieldDataAssignmentEditors.BooleanFieldEditorFactory=Clazz.extend({construct:function(){},init:function(){return new Ext.Editor(new Ext.form.Checkbox)}});
ORYX.Plugins.FieldDataAssignmentEditors.FloatFieldEditorFactory=Clazz.extend({construct:function(){},init:function(){return new Ext.Editor(new Ext.form.NumberField({allowDecimals:!0}))}});ORYX.Plugins.FieldDataAssignmentEditors.IntegerFieldEditorFactory=Clazz.extend({construct:function(){},init:function(){return new Ext.Editor(new Ext.form.NumberField({allowDecimals:!1}))}});ORYX.Plugins.FieldDataAssignmentEditors.DateFieldEditorFactory=Clazz.extend({construct:function(){},init:function(){return new Ext.Editor(new Ext.form.DateField)}});
/* ORYX.Plugins.NodeXMLViewer */
ORYX.Plugins||(ORYX.Plugins={});ORYX.Config||(ORYX.Config={});
ORYX.Plugins.NodeXMLViewer=Clazz.extend({sourceEditor:void 0,construct:function(a){this.facade=a;this.facade.registerOnEvent(ORYX.CONFIG.EVENT_NODEXML_SHOW,this.showNodeXML.bind(this));this.sourceMode=!1},showNodeXML:function(a){if(a&&a.nodesource){this.sourceEditor=void 0;var b=Ext.id(),a=new Ext.form.TextArea({id:b,fieldLabel:ORYX.I18N.View.NodeSource,value:a.nodesource,autoScroll:!0}),c=Ext.id();this.win=new Ext.Window({width:600,id:c,height:550,layout:"fit",title:ORYX.I18N.View.ViewNodeSource,
items:[a],buttons:[{text:ORYX.I18N.Diagram.ViewNodeSource_Close,handler:function(){this.win.hide();this.sourceEditor=void 0}.bind(this)}]});this.win.show();this.foldFunc=CodeMirror.newFoldFunction(CodeMirror.tagRangeFinder);this.sourceEditor=CodeMirror.fromTextArea(document.getElementById(b),{mode:"application/xml",lineNumbers:!0,lineWrapping:!0,onGutterClick:this.foldFunc})}else Ext.Msg.alert("Node source was not specified.")}});
/* ORYX.Plugins.TaskPropertiesUpdater */
ORYX.Plugins||(ORYX.Plugins={});ORYX.Config||(ORYX.Config={});ORYX.Plugins.TaskPropertiesUpdater=Clazz.extend({construct:function(a){this.facade=a;this.facade.registerOnEvent(ORYX.CONFIG.EVENT_PROPWINDOW_PROP_CHANGED,this.handlePropertyChanged.bind(this))},handlePropertyChanged:function(a){"oryx-tasktype"==a.key&&a.elements[0]&&this.facade.getCanvas().update()}});
/* ORYX.Plugins.PatternCreator */
ORYX.Plugins||(ORYX.Plugins={});ORYX.Config||(ORYX.Config={});
ORYX.Plugins.PatternCreator=Clazz.extend({construct:function(a){this.facade=a;this.facade.registerOnEvent(ORYX.CONFIG.CREATE_PATTERN,this.handleCreatePattern.bind(this));this.patternShapes={};this.patternPositions={};this.selectedRoots=[];this.selectedRootsCount;this.createdElementCount},handleCreatePattern:function(a){if(a&&a.pid&&a.pdata&&a.pos){this.patternShapes={};this.patternPositions={};this.selectedRoots=[];for(var c=this.createdElementCount=this.selectedRootsCount=0;c<a.pdata.length;c++){var b=
a.pdata[c];if(b.id==a.pid){b=b.elements;this.facade.getSelection().each(function(a){a instanceof ORYX.Core.Node&&(this.selectedRoots[this.selectedRootsCount]=a,this.selectedRootsCount++)}.bind(this));var d=this.getPatternRoots(b);if(0<this.selectedRoots.length&&this.selectedRoots.length!=d.length){Ext.Msg.minWidth=400;Ext.Msg.alert("Cannot attach Pattern to selected node(s).");break}for(d=0;d<b.length;d++){var f=b[d];void 0===this.patternShapes[f.id]&&this.createElement(f,a);this.createElementChildren(f,
b)}}}}else Ext.Msg.minWidth=300,Ext.Msg.alert("Invalid pattern data.")},getPatternRoots:function(a){for(var c=[],b=0,d=0;d<a.length;d++){var f=a[d];0==f.parent.length&&(c[b]=f,b++)}return c},findChildObject:function(a,c){for(var b=0;b<c.length;b++){var d=c[b];if(d.id==a)return d}},createElement:function(a,c){if(0==a.parent.length&&0<this.selectedRoots.length)this.patternShapes[a.id]=this.selectedRoots[this.createdElementCount],this.patternPositions[a.id]=this.selectedRoots[this.createdElementCount].absoluteCenterXY(),
this.createdElementCount++;else{var b={x:0,y:0};void 0===this.patternPositions[a.id]?(b.x=c.pos.x,b.y=c.pos.y):(b.x=this.patternPositions[a.id].x,b.y=this.patternPositions[a.id].y);b.x+=a.xyOffset[0];b.y+=a.xyOffset[1];this.patternShapes[a.id]=this.facade.createShape({type:a.nodetype,namespace:a.namespace,connectingType:a.connectingType,position:b,parent:ORYX.EDITOR._canvas});this.patternPositions[a.id]=b;this.patternShapes[a.id].setProperty("oryx-name",a.name);this.patternShapes[a.id].refresh();
this.facade.getCanvas().update()}},createElementChildren:function(a,c){for(var b=a.children,d=0;d<b.length;d++){var f=b[d];if(void 0===this.patternShapes[f]){var e=this.findChildObject(f,c);e&&(f={x:0,y:0},f.x=this.patternPositions[a.id].x,f.y=this.patternPositions[a.id].y,f.x+=e.xyOffset[0],f.y+=e.xyOffset[1],this.patternShapes[e.id]=this.facade.createShape({type:e.nodetype,namespace:e.namespace,connectingType:e.connectingType,connectedShape:this.patternShapes[a.id],position:f,parent:ORYX.EDITOR._canvas}),
this.patternPositions[e.id]=f,this.patternShapes[e.id].setProperty("oryx-name",e.name),this.patternShapes[e.id].refresh(),this.facade.getCanvas().update())}else{e=this.findChildObject(f,c);e=ORYX.Core.StencilSet.stencil(e.connectingType);e=new ORYX.Core.Edge({eventHandlerCallback:this.facade.raiseEvent},e);e.dockers.first().setDockedShape(this.patternShapes[a.id]);var g=this.patternShapes[a.id].getDefaultMagnet(),g=g?g.bounds.center():this.patternShapes[a.id].bounds.midPoint();e.dockers.first().setReferencePoint(g);
e.dockers.last().setDockedShape(this.patternShapes[f]);e.dockers.last().setReferencePoint(this.patternShapes[f].getDefaultMagnet().bounds.center());this.facade.getCanvas().add(e);this.facade.getCanvas().update()}}},createPatternFromSelection:function(){var a=this.facade.getSelection();if(a&&0<a.size())if((a=this.findParentShapes(a))&&0<a.size()){var a=new Ext.form.TextField({fieldLabel:"Pattern Name",allowBlank:!1,id:"patternName",regex:/^[a-z0-9 \-\.\_]*$/i}),a=new Ext.form.FormPanel({baseCls:"x-plain",
labelWidth:150,labelAlign:"right",bodyStyle:"padding:15x 15px 15px 15px",defaultType:"textfield",items:[a]}),c=new Ext.Window({layout:"anchor",autoCreate:!0,title:"Create a new Workflow Pattern",height:150,width:400,modal:!0,collapsible:!1,fixedcenter:!0,shadow:!0,resizable:!0,proxyDrag:!0,autoScroll:!0,keys:[{key:27,fn:function(){c.hide()}.bind(this)}],items:[a],listeners:{hide:function(){c.destroy()}.bind(this)},buttons:[{text:ORYX.I18N.PropertyWindow.ok,handler:function(){c.hide()}.bind(this)},
{text:ORYX.I18N.PropertyWindow.cancel,handler:function(){c.hide()}.bind(this)}]});c.show()}else Ext.Msg.alert("Invalid selection");else Ext.Msg.alert("No nodes selected")},findParentShapes:function(a){var c=[],b=0;a.each(function(d){d.getIncomingShapes()&&0<d.getIncomingShapes().size()?!this.isInSelection(a,d.getIncomingShapes())&&d instanceof ORYX.Core.Node&&(c[b]=d,b++):(c[b]=d,b++)}.bind(this));return c},isInSelection:function(a,c){var b=!1;if(!c||0==c.size())return!1;for(var d=0;d<c.length;d++)a.each(function(a){a.resourceId==
c[d].resourceId&&(b=!0)}.bind(this));return b}});
/* ORYX.Plugins.BussinessDataLoader */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.BussinessDataLoader=Clazz.extend({construct:function(a){ORYX.Log.debug("construct BussinessDataLoader");this.facade=a;this.bussinessDataCache={};a=ORYX.CONFIG.KOALA_CORE_BASE+"ws/";this.resourcePaths={actors:a+"businessResourceService/businessResourceApplication/getCustomerUser",actorsByBussiness:a+"businessResourceService/businessResourceApplication/getUsersByBussiness",groups:a+"businessResourceService/businessResourceApplication/getCustomerGroups",groupsByBussiness:a+"businessResourceService/businessResourceApplication/getGroupsByBussiness",
business:a+"businessResourceService/businessResourceApplication/getBusinessBySid",businessTree:a+"businessResourceService/businessResourceApplication/getBusinessTreeBySid",busFields:a+"businessResourceService/businessResourceApplication/getFieldsByBid",publishedProcesses:a+"businessResourceService/businessResourceApplication/getPublishedProcesses",vardefs:a+"koalaJbpmVariableService/koalaJbpmVariableApplication/getProcessPackageGlobalVariable"};this.systemId=ORYX.BusinessSystemID;ORYX.BussinessDataLoader=
this;a=ORYX.Log;try{this.loadVardefs()}catch(b){a.debug("loadVardefs failed",b)}try{this.loadBussinessRes()}catch(c){a.debug("loadBussinessRes failed",c)}try{this.setupActorsDataStore()}catch(d){a.debug("setupActorsDataStore failed",d)}try{this.setupGroupsDataStore()}catch(e){a.debug("setupGroupsDataStore failed",e)}},setupActorsDataStore:function(){if(this.bussinessDataCache.Actors)return this.bussinessDataCache.Actors;var a=new Ext.data.ScriptTagProxy({url:this.resourcePaths.actors}),b=Ext.data.Record.create([{name:"id"},
{name:"name"}]),b=new Ext.data.JsonReader({root:"data",id:"id"},b),a=new Ext.data.Store({proxy:a,baseParams:{sid:this.systemId},reader:b});a.load();return this.bussinessDataCache.Actors=a},loadActorsDataStore:function(a){var b="ActorsByBusinessForm"+a;if(this.bussinessDataCache[b])return this.bussinessDataCache[b];var c;c=a?new Ext.data.ScriptTagProxy({url:this.resourcePaths.actorsByBussiness}):new Ext.data.MemoryProxy;var d=Ext.data.Record.create([{name:"id"},{name:"name"}]),d=new Ext.data.JsonReader({root:"data",
id:"id"},d),a=new Ext.data.Store({proxy:c,baseParams:{sid:this.systemId,bid:a},reader:d});a.load();return this.bussinessDataCache[b]=a},setupGroupsDataStore:function(){if(this.bussinessDataCache.Groups)return this.bussinessDataCache.Groups;var a=new Ext.data.ScriptTagProxy({url:this.resourcePaths.groups}),b=Ext.data.Record.create([{name:"id"},{name:"name"}]),b=new Ext.data.JsonReader({root:"data",id:"id"},b),a=new Ext.data.Store({proxy:a,baseParams:{sid:this.systemId},reader:b});a.load();this.bussinessDataCache.Groups=
a},loadGroupsDataStore:function(a){var b="GroupsByBusinessForm"+a;if(this.bussinessDataCache[b])return this.bussinessDataCache[b];var c;c=a?new Ext.data.ScriptTagProxy({url:this.resourcePaths.groupsByBussiness}):new Ext.data.MemoryProxy;var d=Ext.data.Record.create([{name:"id"},{name:"name"}]),d=new Ext.data.JsonReader({root:"data",id:"id"},d),a=new Ext.data.Store({proxy:c,baseParams:{sid:this.systemId,bid:a},reader:d});a.load();return this.bussinessDataCache[b]=a},loadBussinessRes:function(){if(this.bussinessDataCache.BussinessRes)return this.bussinessDataCache.BussinessRes;
var a=Ext.data.Record.create([{name:"id"},{name:"name",mapping:"resourceName"},{name:"icon"}]),a=new Ext.data.Store({proxy:new Ext.data.ScriptTagProxy({url:this.resourcePaths.business}),baseParams:{sid:this.systemId},reader:new Ext.data.JsonReader({root:"data",id:"id"},a)});a.load();return this.bussinessDataCache.BussinessRes=a},loadBussinessResTree:function(){if(this.bussinessDataCache.BussinessResTree)return this.bussinessDataCache.BussinessResTree;var a=Ext.data.Record.create([{name:"id"},{name:"name",
mapping:"resourceName"},{name:"parentId"},{name:"isLeaf"}]),a=new Ext.data.Store({proxy:new Ext.data.ScriptTagProxy({url:this.resourcePaths.businessTree}),baseParams:{sid:this.systemId},reader:new Ext.data.JsonReader({root:"data",id:"id"},a)});a.load();return this.bussinessDataCache.BussinessResTree=a},loadBussinessResFields:function(a){var b=this.bussinessDataCache.resFields;if(b){if(b[a])return b[a]}else b=this.bussinessDataCache.resFields={};var c=new Ext.data.Store({proxy:new Ext.data.ScriptTagProxy({url:this.resourcePaths.busFields}),
baseParams:{bid:a},reader:new Ext.data.JsonReader({root:"data",id:"name"},Ext.data.Record.create([{name:"name"},{name:"type",mapping:"dataType"},{name:"descr",mapping:"description"}]))});c.load();return b[a]=c},loadVardefs:function(){if(this.bussinessDataCache.Vardefs)return this.bussinessDataCache.Vardefs;var a=ORYX.EDITOR.getSerializedJSON().evalJSON(),b=jsonPath(a,"$.properties.package"),a=jsonPath(a,"$.properties.name"),b=new Ext.data.Store({proxy:new Ext.data.ScriptTagProxy({url:this.resourcePaths.vardefs}),
baseParams:{sid:this.systemId,packageName:b,processDefineName:b+"."+a},reader:new Ext.data.JsonReader({root:"data",id:"id"},Ext.data.Record.create([{name:"key"},{name:"type"},{name:"scope"},{name:"descr",mapping:"description"},{name:"value"}]))});b.load();return this.bussinessDataCache.Vardefs=b},loadPublishedProcesses:function(){if(this.bussinessDataCache.PublishedProcesses)return this.bussinessDataCache.PublishedProcesses;var a=Ext.data.Record.create([{name:"name"},{name:"version"},{name:"imgsrc"}]),
a=new Ext.data.Store({proxy:new Ext.data.ScriptTagProxy({url:this.resourcePaths.publishedProcesses}),baseParams:{sid:this.systemId},reader:new Ext.data.JsonReader({root:"data"},a)});a.load();return this.bussinessDataCache.PublishedProcesses=a}});ORYX.getBussinessDataLoader=function(){ORYX.BussinessDataLoader||(ORYX.BussinessDataLoader=new ORYX.Plugins.BussinessDataLoader);return ORYX.BussinessDataLoader};
/* ORYX.Plugins.TaskEditor */
ORYX.Plugins||(ORYX.Plugins={});
ORYX.Plugins.TaskEditor=Clazz.extend({construct:function(c){this.facade=c;c=ORYX.Plugins.TaskEditor;ORYX.FieldEditors.actor=new c.ActorsEditorFactory;ORYX.FieldEditors.group=new c.GroupsEditorFactory;ORYX.FieldEditors.bussiness=new c.BusinessResTreeEditorFactory;ORYX.FieldEditors.brdatainput=new c.BRDataInputEditorFactory;ORYX.FieldEditors.brdataoutput=new c.BRDataOutputEditorFactory;ORYX.FieldEditors.jacondition=new c.JAConditionEditorFactory;for(var c="name,documentation,bgcolor,bordercolor,fontcolor,fontsize,tasktype,kj_jointapproval,activitytype,taskname,priority,kj_businessform,actors,groupid,kj_interface,kj_operation,kj_content,kj_contenttype,datainputset,dataoutputset,input_assignments,output_assignments,kj_approveopinion,kj_jacondition,onentryactions,onexitactions,script,script_language,content,operation,interface,ruleflowgroup,notifications,comment".split(","),a=
{},b=0;b<c.length;b++)a[c[b]]=b+1;ORYX.propertiesOrder||(ORYX.propertiesOrder={});ORYX.propertiesOrder.Task=a;ORYX.propertiesOrder["type:node"]=a}});
ORYX.Plugins.TaskEditor.ActorsEditorFactory=Clazz.extend({construct:function(){},init:function(c,a,b,d){ORYX.Log.debug("init ActorsEditor");var e=ORYX.getBussinessDataLoader(),f=b=null;try{b=e.setupActorsDataStore()}catch(g){ORYX.Log.debug("setupActorsDataStore failed",g)}var h=this.dataSource;ORYX.CONFIG.ACTORS_BY_BUSINESS_FORM&&(f=function(){var a=findBusinessformId(h);return!a?null:e.loadActorsDataStore(a)}.bind(this));b=new Ext.form.DicPopupEditor({allowBlank:a.optional(),grid:this.grid,row:d,
facade:this.facade,dataSource:b,dataSourceCallback:f,autoCreate:!1,windowTitle:ORYX.I18N.PropertyWindow.Task.selectActorsTitle});b.columnModel=new Ext.grid.ColumnModel([new Ext.grid.CheckboxSelectionModel,{id:"id",header:"ID",width:60,sortable:!0,dataIndex:"id"},{header:ORYX.I18N.PropertyWindow.Editor.UserNameHeader,width:90,sortable:!0,dataIndex:"name"}]);b.on("dialogClosed",this.dialogClosed2,{scope:this,row:d,col:1,field:b});a.labelProvider=function(){return a};ORYX.LabelProviders[a]=this.buildMultiValueLabelProvider(b);
d=new Ext.Editor(b);d.valueTooltip=this.buildMultiValueTooltip(b,c);return d}});
ORYX.Plugins.TaskEditor.GroupsEditorFactory=Clazz.extend({construct:function(){},init:function(c,a,b,d){ORYX.Log.debug("init GroupsEditor");var e=ORYX.getBussinessDataLoader(),f=b=null;try{b=e.setupGroupsDataStore()}catch(g){ORYX.Log.debug("setupGroupsDataStore failed",g)}var h=this.dataSource;ORYX.CONFIG.ACTORS_BY_BUSINESS_FORM&&(f=function(){var a=findBusinessformId(h);return!a?null:e.loadGroupsDataStore(a)}.bind(this));b=new Ext.form.DicPopupEditor({allowBlank:a.optional(),grid:this.grid,row:d,
facade:this.facade,dataSource:b,dataSourceCallback:f,autoCreate:!1,windowTitle:ORYX.I18N.PropertyWindow.Task.selectGroupsTitle});b.columnModel=new Ext.grid.ColumnModel([new Ext.grid.CheckboxSelectionModel,{id:"id",header:"ID",width:60,sortable:!0,dataIndex:"id"},{header:ORYX.I18N.PropertyWindow.Editor.NameHeader,width:90,sortable:!0,dataIndex:"name"}]);b.on("dialogClosed",this.dialogClosed2,{scope:this,row:d,col:1,field:b});a.labelProvider=function(){return a};ORYX.LabelProviders[a]=this.buildMultiValueLabelProvider(b);
d=new Ext.Editor(b);d.valueTooltip=this.buildMultiValueTooltip(b,c);return d}});
ORYX.Plugins.TaskEditor.GroupsEditor2Factory=Clazz.extend({construct:function(){},init:function(c,a,b,d){ORYX.Log.debug("init GroupsEditor2");b=ORYX.getBussinessDataLoader().setupGroupsDataStore();d=new Ext.form.MultiSelectField({allowBlank:a.optional(),grid:this.grid,row:d,facade:this.facade,dataSource:b,autoCreate:!1,typeAhead:!0,hiddenName:"groups"});a.labelProvider=function(){return a};ORYX.LabelProviders[a]=this.buildMultiValueLabelProvider(d);b=new Ext.Editor(d);b.valueTooltip=this.buildMultiValueTooltip(d,
c);return b}});
ORYX.Plugins.TaskEditor.BusinessResEditorFactory=Clazz.extend({construct:function(){},init:function(c,a){ORYX.Log.debug("init BusinessResEditor");var b=ORYX.getBussinessDataLoader().loadBussinessRes(),d=new Ext.form.ComboBox({editable:!1,store:b,displayField:"name",valueField:"id",typeAhead:!0,mode:"local",triggerAction:"all",selectOnFocus:!0});d.on("select",function(a){this.editDirectly(c,a.getValue())}.bind(this));a.labelProvider=function(){return a};ORYX.LabelProviders[a]=function(){return function(a){return!a?"":
(a=d.store.query("id",a).items[0])?a.data.name:""}};return new Ext.Editor(d)}});
ORYX.Plugins.TaskEditor.BusinessResTreeEditorFactory=Clazz.extend({construct:function(){},init:function(c,a,b,d){ORYX.Log.debug("init BusinessResTreeEditorFactory");var c=ORYX.getBussinessDataLoader().loadBussinessResTree(),e=new Ext.form.TreePopupEditor({allowBlank:a.optional(),dataSource:c,grid:this.grid,row:d,facade:this.facade,windowTitle:ORYX.I18N.PropertyWindow.Editor.BussinessForm});e.on("dialogClosed",this.dialogClosed2,{scope:this,row:d,col:1,field:e});a.labelProvider=function(){return a};
ORYX.LabelProviders[a]=function(){return function(a){return!a?"":(a=e.dataSource.query("id",a).items[0])?a.data.name:""}};return new Ext.Editor(e)}});
Ext.form.BRIO_Editor=Ext.extend(Ext.form.NameTypeEditor,{tbarConfigCallback:function(){return[{text:ORYX.I18N.PropertyWindow.Editor.SelectBussinessFields,handler:function(){var c=this.vardefsGrid.store,a=findBusinessformId(this.dataSource);if(a){var b=ORYX.getBussinessDataLoader().loadBussinessResFields(a),d=new Ext.grid.ColumnModel([new Ext.grid.CheckboxSelectionModel,{id:"name",header:ORYX.I18N.PropertyWindow.Editor.NameHeader,width:60,sortable:!0,dataIndex:"name"},{header:ORYX.I18N.PropertyWindow.Editor.TypeHeader,
width:40,sortable:!0,dataIndex:"type",renderer:function(a){for(var c=this._typesData,b=0;b<c.length;b++)if(c[b][0]===a)return c[b][1];return a}.bind(this)},{header:ORYX.I18N.PropertyWindow.Editor.DescriptionHeader,width:120,sortable:!0,dataIndex:"descr"}]),e=a,f=findBusinessformRecord(this.dataSource);if(null!=f&&(f=f.get("gridProperties").editor))(a=(f.field.store||f.field.dataSource).query("id",a).items[0])&&(e=a.get("name"));var g=new Ext.grid.GridPanel({store:b,cm:d,sm:new Ext.grid.CheckboxSelectionModel,
viewConfig:{forceFit:!0},autoHeight:!0,frame:!1,border:!1,iconCls:"icon-grid"}),h=new Ext.Window({layout:"anchor",autoCreate:!0,title:ORYX.I18N.PropertyWindow.Editor.BussinessForm+e,height:250,width:350,y:ORYX.CONFIG.EXT_WINDOW_Y,modal:!0,collapsible:!1,fixedcenter:!0,shadow:!0,resizable:!0,proxyDrag:!0,autoScroll:!0,items:[g],listeners:{},buttons:[{text:ORYX.I18N.PropertyWindow.ok,handler:function(){g.stopEditing();g.getView().refresh();var a=g.getSelectionModel();b.each(function(b){var d=b.get("name"),
e=c.query("name",d).items[0];a.isSelected(b)?e||c.add(new this.VarDef({name:d,stype:b.get("type"),ctype:""})):e&&c.remove(e)}.bind(this));h.hide()}.bind(this)},{text:ORYX.I18N.PropertyWindow.cancel,handler:function(){h.hide()}.bind(this)}]});h.show();var j=c.collect("name"),i=[];b.each(function(a){0<=j.indexOf(a.get("name"))&&i.push(a)});g.getSelectionModel().selectRecords(i,!1)}}.bind(this)}]}});
Ext.form.BRDataInputField=Ext.extend(Ext.form.BRIO_Editor,{windowTitle:ORYX.I18N.PropertyWindow.Editor.ForDataInput,addButtonLabel:ORYX.I18N.PropertyWindow.Editor.AddDataInput});
ORYX.Plugins.TaskEditor.BRDataInputEditorFactory=Clazz.extend({construct:function(){},init:function(c,a,b,d){ORYX.Log.debug("init BRDataInputEditor");a=new Ext.form.BRDataInputField({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:d,facade:this.facade});a.on("dialogClosed",this.dialogClosed2,{scope:this,row:d,col:1,field:a});d=new Ext.Editor(a);d.valueTooltip=a.buildNameTypeTooltip(a,c);return d}});
Ext.form.BRDataOutputField=Ext.extend(Ext.form.BRIO_Editor,{windowTitle:ORYX.I18N.PropertyWindow.Editor.ForDataOutput,addButtonLabel:ORYX.I18N.PropertyWindow.Editor.AddDataOutput});
ORYX.Plugins.TaskEditor.BRDataOutputEditorFactory=Clazz.extend({construct:function(){},init:function(c,a,b,d){ORYX.Log.debug("init BRDataOutputEditor");a=new Ext.form.BRDataOutputField({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:d,facade:this.facade});a.on("dialogClosed",this.dialogClosed2,{scope:this,row:d,col:1,field:a});d=new Ext.Editor(a);d.valueTooltip=a.buildNameTypeTooltip(a,c);return d}});
Ext.form.JAConditionField=Ext.extend(Ext.form.TriggerField,{onTriggerClick:function(){if(!this.disabled){var c=new Ext.form.NumberField({allowNegative:!1,width:90,minValue:0,maxValue:100,minText:"",maxText:ORYX.I18N.PropertyWindow.Editor.JAConditionPercentMaxText,style:"margin:3px;"}),a=new Ext.form.NumberField({allowDecimals:!1,allowNegative:!1,width:90,minValue:0,minText:"",maxText:"",style:"margin:3px;"}),b=new Ext.form.Radio({name:"jacr",value:"percent",style:"margin:3px;",boxLabel:ORYX.I18N.PropertyWindow.Editor.JAConditionPercent,
listeners:{check:function(b,d){d?(c.enable(),a.disable()):(a.enable(),c.disable())}}}),d=new Ext.form.Radio({name:"jacr",value:"ucount",style:"margin:3px;",boxLabel:ORYX.I18N.PropertyWindow.Editor.JAConditionUsercount}),e=new Ext.Panel({layout:"table",layoutConfig:{columns:3},items:[b,c,{html:"%",style:"margin:3px;"},d,a,{html:ORYX.I18N.PropertyWindow.Editor.JAConditionUsercountU,style:"margin:3px;"}]}),f=new Ext.Window({layout:"anchor",autoCreate:!0,title:ORYX.I18N.PropertyWindow.Editor.JAConditionTitle,
height:160,width:250,y:ORYX.CONFIG.EXT_WINDOW_Y,modal:!0,collapsible:!1,fixedcenter:!0,shadow:!0,resizable:!0,proxyDrag:!0,autoScroll:!0,items:[e],keys:[{key:27,fn:function(){f.hide()}.bind(this)}],listeners:{hide:function(){this.fireEvent("dialogClosed",this.value);f.destroy()}.bind(this)},buttons:[{text:ORYX.I18N.PropertyWindow.ok,handler:function(){var b="";b=c.disabled?a.getValue():(b=c.getValue())?b+"%":"";this.setValue(b);this.dataSource.getAt(this.row).set("value",b);this.dataSource.commitChanges();
f.hide()}.bind(this)},{text:ORYX.I18N.PropertyWindow.cancel,handler:function(){this.setValue(this.value);f.hide()}.bind(this)}]});f.show();e=this.getValue();!e||0==e.length?(a.disable(),c.setValue(100),b.setValue(!0)):"%"==e.charAt(e.length-1)?(c.setValue(e.substr(0,e.length-1)),a.disable(),b.setValue(!0)):(a.setValue(e),c.disable(),d.setValue(!0))}}});
ORYX.Plugins.TaskEditor.JAConditionEditorFactory=Clazz.extend({construct:function(){},init:function(c,a,b,d){ORYX.Log.debug("init JAConditionEditor");c=new Ext.form.JAConditionField({allowBlank:a.optional(),dataSource:this.dataSource,grid:this.grid,row:d,facade:this.facade});c.on("dialogClosed",this.dialogClosed2,{scope:this,row:d,col:1,field:c});return new Ext.Editor(c)}});
function findBusinessformRecord(c){var a=c.findBy(function(a){return"oryx-kj_businessform"==a.get("gridProperties").propId});return-1==a?(Ext.Msg.alert("",ORYX.I18N.PropertyWindow.Editor.BussinessFormNotSelected),null):c.getAt(a)}function findBusinessformId(c){c=findBusinessformRecord(c);if(null==c)return null;c=c.get("value");return""==c?(Ext.Msg.alert("",ORYX.I18N.PropertyWindow.Editor.BussinessFormNotSelected),null):c};
/* ORYX.Plugins.VardefExpressionEditor */
ORYX.Plugins||(ORYX.Plugins={});ORYX.Plugins.VardefExpressionEditor=Clazz.extend({construct:function(a){this.facade=a;a=ORYX.Plugins.VardefExpressionEditor;ORYX.FieldEditors.condition_expression=new a.CEEditorFactory;ORYX.FieldEditors.vardef2=new a.VardefEditorFactory;ORYX.FieldEditors.dataassignment2=new a.DataAssignmentEditorFactory;ORYX.FieldEditors.input_dataassignment=new a.InputDataAssignmentEditorFactory;ORYX.FieldEditors.output_dataassignment=new a.OutputDataAssignmentEditorFactory}});
ORYX.Plugins.VardefExpressionEditor.CEEditorFactory=Clazz.extend({construct:function(){},init:function(a,b,c,d){ORYX.Log.debug("init ConditionExpressionEditor");a=new Ext.form.PathExpressionField({allowBlank:b.optional(),dataSource:this.dataSource,grid:this.grid,row:d,facade:this.facade,autoCreate:!1,propertyWindow:this});a.on("dialogClosed",this.dialogClosed2,{scope:this,row:d,col:1,field:a});return new Ext.Editor(a)}});
Ext.form.PathExpressionField=Ext.extend(Ext.form.TriggerField,{onTriggerClick:function(){function a(){var b=m.getValue();if(""==b)Ext.MessageBox.alert("\u63d0\u793a","\u53d8\u91cf\u4e0d\u5141\u8bb8\u4e3a\u7a7a\uff01");else{var a=$A(d).find(function(a){return a[0]==b});if(a){var c=a[1],a=g.getValue();if(""==a&&"Boolean"!=c)Ext.MessageBox.alert("\u63d0\u793a","\u8fd0\u7b97\u7b26\u4e0d\u5141\u8bb8\u4e3a\u7a7a\uff01");else{var e=k.getValue();if(""==e&&"Boolean"!=c)Ext.MessageBox.alert("\u63d0\u793a",
"\u53d8\u91cf/\u503c\u4e0d\u5141\u8bb8\u4e3a\u7a7a\uff01"),k.focus();else{var f="java";this.dataSource.findBy(function(a){var b="oryx-conditionexpressionlanguage"==a.get("gridProperties").propId;b&&(f=a.get("value"));return b});var h=$A(d).find(function(a){return a[0]==e}),i=e;h||"String"==c&&!e.startsWith('"')&&!e.endsWith('"')&&(i='"'+e+'"');var n;"APPR_RESULT"==b&&(n="=="==a&&"1"==e?"\u901a\u8fc7":"\u4e0d\u901a\u8fc7");var l;"Boolean"==c&&""==e?""==a||"=="==a?(l=b,n="is "+l):"!="==a&&(l="!"+b,
n="not "+b):(0<=a.indexOf("=")||0<=a.indexOf(">")||0<=a.indexOf("<"))&&"java"==f&&"String"==c?"=="==a||"!="==a?(l=b+".equals("+i+")","!="==a&&(l="!"+l)):l=b+".compareTo("+i+")"+a+"0":l="startsWith"==a||"endsWith"==a||"contains"==a&&"mvel"!=f?b+"."+a+"("+i+")":b+" "+a+" "+i;c=l;"java"==f&&(c="return "+l+";");this.setValue(c);n||(n=a+" "+i);l=this.dataSource.findBy(function(a){return"oryx-name"==a.get("gridProperties").propId});n&&-1!=l&&(a=this.dataSource.getAt(l),this.dataSource.getAt(l).set("value",
n),this.propertyWindow.afterEdit({grid:this.grid,record:a,value:n}));j.hide()}}}else Ext.MessageBox.alert("\u63d0\u793a","\u53d8\u91cf"+b+"\u672a\u5b9a\u4e49\uff01")}}if(!this.disabled){var b={String:ORYX.I18N.PropertyWindow.Editor.TypeString,Integer:ORYX.I18N.PropertyWindow.Editor.TypeInteger,Float:ORYX.I18N.PropertyWindow.Editor.TypeFloat,Boolean:ORYX.I18N.PropertyWindow.Editor.TypeBoolean,Object:ORYX.I18N.PropertyWindow.Editor.TypeObject},c=ORYX.EDITOR.getSerializedJSON(),c=jsonPath(c.evalJSON(),
"$.properties.vardefs"),d=[];c&&c.forEach(function(a){if(0!=a.length)for(var a=a.split(","),c=0;c<a.length;c++){var e=a[c].split(":"),f=e[1];e.push(b[f]||f);d.push(e)}});var c=new Ext.data.SimpleStore({fields:["name","type","typeName"],data:d}),m=new Ext.form.ComboBox({store:c,displayField:"name",valueField:"name",tpl:'<tpl for="."><div class="x-combo-list-item">{[values["name"]+" "+values["typeName"]]}</div></tpl>',typeAhead:!0,mode:"local",triggerAction:"all",value:"",selectOnFocus:!0,style:"width:170px;"}),
c=new Ext.data.SimpleStore({fields:["value","display"],data:[["==","="],[">",">"],["<","<"],[">=",">="],["<=","<="],["!=","!="],["contains","\u5305\u542b"],["startsWith","\u5f00\u59cb\u4e8e"],["endsWith","\u7ed3\u675f\u4e8e"]]}),g=new Ext.form.ComboBox({store:c,displayField:"display",valueField:"value",tpl:'<tpl for="."><div class="x-combo-list-item">{[fm.htmlEncode(values["display"])]}</div></tpl>',typeAhead:!0,mode:"local",triggerAction:"all",value:"",selectOnFocus:!0,style:"width:170px;"}),k=new Ext.form.TextField({style:"width:170px;"}),
j,c=new Ext.Panel({layout:"table",layoutConfig:{columns:2},items:[{html:"\u53d8\u91cf",style:"margin:4px;"},m,{html:"\u8fd0\u7b97",style:"margin:4px;"},g,{html:"\u53d8\u91cf/\u503c",style:"margin:4px;"},k],tbar:[{text:"\uff08\u5ba1\u6279\uff09\u901a\u8fc7",handler:function(){m.setValue("APPR_RESULT");g.setValue("==");k.setValue("1");a.call(this);j.hide()}.bind(this)},{text:"\uff08\u5ba1\u6279\uff09\u4e0d\u901a\u8fc7",handler:function(){m.setValue("APPR_RESULT");g.setValue("!=");k.setValue("1");a.call(this);
j.hide()}.bind(this)}]});j=new Ext.Window({layout:"anchor",autoCreate:!0,title:"\u5206\u652f\u6761\u4ef6",height:200,width:300,y:ORYX.CONFIG.EXT_WINDOW_Y,modal:!0,collapsible:!1,fixedcenter:!0,shadow:!0,resizable:!0,proxyDrag:!0,autoScroll:!0,items:[c],keys:[{key:27,fn:function(){j.hide()}.bind(this)}],listeners:{hide:function(){this.fireEvent("dialogClosed",this.value);j.destroy()}.bind(this)},buttons:[{text:ORYX.I18N.PropertyWindow.ok,handler:a.bind(this)},{text:ORYX.I18N.PropertyWindow.cancel,
handler:function(){this.setValue(this.value);j.hide()}.bind(this)}]});j.show();var i=c="",f="",e=this.value;if(0<e.length){e.endsWith(";")&&(e=e.substring(0,e.length-1));e.startsWith("return ")&&(e=e.substring(7));var h=e.match(/!?(\w+)\.(\w+)\(("?\w+"?)\)/);h?(c=h[1],i="equals"==h[2]?e.startsWith("!")?"!=":"==":h[2],f=h[3]):(h=e.match(/!?(\w+)\.compareTo\((\w+)\)([<=>]+)0/))?(c=h[1],f=h[2],i=h[3]):(e=e.split(" "),c=e[0],1<e.length&&(i=e[1],2<e.length&&(f=e[2])));f&&f.startsWith('"')&&f.endsWith('"')&&
(f=f.substring(1,f.length-1))}m.setValue(c);g.setValue(i);k.setValue(f);this.grid.stopEditing()}}});
Ext.form.ExtendedVardefField=Ext.extend(Ext.form.TriggerField,{windowTitle:ORYX.I18N.PropertyWindow.Editor.ForVariableDefinitions,addButtonLabel:ORYX.I18N.PropertyWindow.Editor.AddVariable,single:!1,tbarConfigCallback:null,predefinedVardefs:null,_typesData:[["String",ORYX.I18N.PropertyWindow.Editor.TypeString],["Integer",ORYX.I18N.PropertyWindow.Editor.TypeInteger],["Float",ORYX.I18N.PropertyWindow.Editor.TypeFloat],["Boolean",ORYX.I18N.PropertyWindow.Editor.TypeBoolean],["Object",ORYX.I18N.PropertyWindow.Editor.TypeObject]],
renderer:function(a,b,c){if(c=c.get(b.id))c=Ext.util.Format.htmlEncode(c),b.cellAttr='title="'+c+'"';return Ext.util.Format.htmlEncode(a)},onTriggerClick:function(){if(!this.disabled){var a=this.VarDef=Ext.data.Record.create([{name:"name"},{name:"stype"},{name:"ctype"},{name:"scope"},{name:"descr"},{name:"value"}]),b=new Ext.data.MemoryProxy({root:[]}),c=new Ext.data.Store({autoDestroy:!0,reader:new Ext.data.JsonReader({root:"root"},a),proxy:b,sorters:[{property:"name",direction:"ASC"}]});c.load();
if(0<this.value.length)for(var b=this.predefinedVardefs=ORYX.getBussinessDataLoader().loadVardefs(),d=this.value.split(","),m=0;m<d.length;m++){var g=d[m];if(0<g.indexOf(":")){var g=g.split(":"),k=g[0],j="",i="",f="",e=!b?null:b.query("key",k).items[0];e&&(j=e.get("scope"),i=e.get("descr"),f=e.get("value"));"String"==g[1]||"Integer"==g[1]||"Boolean"==g[1]||"Float"==g[1]?c.add(new a({name:k,stype:g[1],ctype:"",scope:j,descr:i,value:f})):"Object"!=g[1]?c.add(new a({name:k,stype:"Object",ctype:g[1],
scope:j,descr:i,value:f})):c.add(new a({name:k,stype:g[1],ctype:"",scope:j,descr:i,value:f}))}else{k=g;f=i=j="";if(e=!b?null:b.query("key",k).items[0])j=e.get("scope"),f=e.get("value");c.add(new a({name:k,stype:"",ctype:"",scope:j,descr:i,value:f}))}}b=new Extensive.grid.ItemDeleter;d=Ext.id();Ext.form.VTypes.inputNameVal=/^[a-z0-9 \-\.\_]*$/i;Ext.form.VTypes.inputNameText="Invalid name";Ext.form.VTypes.inputName=function(a){return Ext.form.VTypes.inputNameVal.test(a)};var m=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer,
{id:"name",header:ORYX.I18N.PropertyWindow.Editor.Name,width:100,dataIndex:"name",editor:new Ext.form.TextField({allowBlank:!0,vtype:"inputName",regex:/^[a-z0-9 \-\.\_]*$/i}),renderer:Ext.util.Format.htmlEncode},{id:"stype",header:ORYX.I18N.PropertyWindow.Editor.StandardType,width:80,dataIndex:"stype",editor:new Ext.form.ComboBox({id:"typeCombo",valueField:"name",displayField:"value",labelStyle:"display:none",submitValue:!0,typeAhead:!1,queryMode:"local",mode:"local",triggerAction:"all",selectOnFocus:!0,
hideTrigger:!1,forceSelection:!1,selectOnFocus:!0,autoSelect:!1,store:new Ext.data.SimpleStore({fields:["name","value"],data:this._typesData})}),renderer:function(a){for(var b=this._typesData,c=0;c<b.length;c++)if(b[c][0]===a)return b[c][1];return a}.bind(this)},{id:"scope",header:ORYX.I18N.PropertyWindow.Editor.VardefSource,width:80,dataIndex:"scope",renderer:this.renderer.bind(this)},{id:"descr",header:ORYX.I18N.PropertyWindow.Editor.VardefDescription,width:140,dataIndex:"descr",renderer:this.renderer.bind(this)},
{id:"value",header:ORYX.I18N.PropertyWindow.Editor.VardefValue,width:160,dataIndex:"value",renderer:this.renderer.bind(this)},b]),h=this.vardefsGrid=new Ext.grid.EditorGridPanel({autoScroll:!0,autoHeight:!0,store:c,id:d,stripeRows:!0,autoExpandColumn:"value",cm:m,selModel:b,autoHeight:!0,tbar:function(){var b={text:this.addButtonLabel,handler:function(){this.single&&0<c.getCount()?Ext.Msg.alert(ORYX.I18N.PropertyWindow.Editor.OnlySingleEntryAllowed):(c.add(new a({name:"",stype:"String",ctype:"",scope:"",
descr:"",value:""})),h.fireEvent("cellclick",h,c.getCount()-1,1,null))}.bind(this)},d=[b];this.tbarConfigCallback&&"function"===typeof this.tbarConfigCallback&&(d=this.tbarConfigCallback(),d.unshift(b));return d}.call(this),clicksToEdit:1}),o=new Ext.Window({layout:"anchor",autoCreate:!0,title:this.windowTitle,height:300,width:640,y:ORYX.CONFIG.EXT_WINDOW_Y,modal:!0,collapsible:!1,fixedcenter:!0,shadow:!0,resizable:!0,proxyDrag:!0,autoScroll:!0,keys:[{key:27,fn:function(){o.hide()}.bind(this)}],items:[h],
listeners:{hide:function(){this.fireEvent("dialogClosed",this.value);o.destroy()}.bind(this)},buttons:[{text:ORYX.I18N.PropertyWindow.ok,handler:function(){var a="";h.stopEditing();h.getView().refresh();c.data.each(function(){0<this.data.name.length&&(a=0<this.data.stype.length?"Object"==this.data.stype&&0<this.data.ctype.length?a+(this.data.name+":"+this.data.ctype+","):a+(this.data.name+":"+this.data.stype+","):0<this.data.ctype.length?a+(this.data.name+":"+this.data.ctype+","):a+(this.data.name+
","))});0<a.length&&(a=a.slice(0,-1));this.setValue(a);this.dataSource.getAt(this.row).set("value",a);this.dataSource.commitChanges();o.hide()}.bind(this)},{text:ORYX.I18N.PropertyWindow.cancel,handler:function(){this.setValue(this.value);o.hide()}.bind(this)}]});o.show();h.render();this.grid.stopEditing();h.focus(!1,100)}},buildNameTypeTooltip:function(a,b){return function(){var c=this.dataSource.findBy(function(a){return a.get("gridProperties").propId==b});if(-1==c)return null;if((c=this.dataSource.getAt(c).get("value"))&&
0<c.length){var d=a.valueSeparator||",",c=c.replace(/\:/g," ");return c.split(d).join("&#10;")}return null}.bind(this)}});
Ext.form.VardefEditor=Ext.extend(Ext.form.ExtendedVardefField,{tbarConfigCallback:function(){return[{text:ORYX.I18N.PropertyWindow.Editor.LoadVardefs,handler:function(){var a=this.vardefsGrid.store;this.predefinedVardefs||(this.predefinedVardefs=ORYX.getBussinessDataLoader().loadVardefs());var b=this.predefinedVardefs;if(b){var c=function(){b.each(function(b){var c=b.get("key");-1==a.findBy(function(a){return a.get("name")==c})&&a.add(new this.VarDef({name:c,stype:b.get("type"),ctype:"",scope:b.get("scope"),
descr:b.get("descr"),value:b.get("value")}))}.bind(this))};if(0<b.getCount())c.call(this);else b.on("load",c.bind(this))}else Ext.Msg.alert("",ORYX.I18N.PropertyWindow.Editor.NoVardefs)}.bind(this)},{text:ORYX.I18N.PropertyWindow.Editor.ClearVardefs,handler:function(){this.vardefsGrid.store.removeAll()}.bind(this)}]}});
ORYX.Plugins.VardefExpressionEditor.VardefEditorFactory=Clazz.extend({construct:function(){},init:function(a,b,c,d){ORYX.Log.debug("init VardefEditor");b=new Ext.form.VardefEditor({allowBlank:b.optional(),dataSource:this.dataSource,grid:this.grid,row:d,facade:this.facade,autoCreate:!1});b.on("dialogClosed",this.dialogClosed2,{scope:this,row:d,col:1,field:b});d=new Ext.Editor(b);d.valueTooltip=b.buildNameTypeTooltip(b,a);return d}});
Ext.form.NameMappingDataAssignmentField=Ext.extend(Ext.form.ComplexDataAssignmenField,{tbarConfigCallback:function(){return[{text:"\u6620\u5c04\u540c\u540d\uff08\u53d8\u91cf => \u8f93\u5165\uff09",handler:function(){var a=this.varNamesMap;this.assignByName.call(this,a.processVars,a.dataInputs)}.bind(this)},{text:"\u6620\u5c04\u540c\u540d\uff08\u8f93\u51fa => \u53d8\u91cf\uff09",handler:function(){var a=this.varNamesMap;this.assignByName.call(this,a.dataOutputs,a.processVars)}.bind(this)}]}});
ORYX.Plugins.VardefExpressionEditor.DataAssignmentEditorFactory=Clazz.extend({construct:function(){},init:function(a,b,c,d){ORYX.Log.debug("init DataAssignmentEditor");b=new Ext.form.NameMappingDataAssignmentField({allowBlank:b.optional(),dataSource:this.dataSource,grid:this.grid,row:d,facade:this.facade,autoCreate:!1});b.on("dialogClosed",this.dialogClosed2,{scope:this,row:d,col:1,field:b});d=new Ext.Editor(b);d.valueTooltip=b.buildAssignmentTooltip(b,a);return d}});
Ext.form.InputDataAssignmentField=Ext.extend(Ext.form.ComplexDataAssignmenField,{windowTitle:ORYX.I18N.PropertyWindow.Editor.ForInputAssignments,assignTarget:"input",tbarConfigCallback:function(){return[{text:ORYX.I18N.PropertyWindow.Editor.MappingVariables,handler:function(){var a=this.varNamesMap;this.assignByName.call(this,a.processVars,a.dataInputs)}.bind(this)}]}});
ORYX.Plugins.VardefExpressionEditor.InputDataAssignmentEditorFactory=Clazz.extend({construct:function(){},init:function(a,b,c,d){ORYX.Log.debug("init InputDataAssignmentEditor");b=new Ext.form.InputDataAssignmentField({allowBlank:b.optional(),dataSource:this.dataSource,grid:this.grid,row:d,facade:this.facade,autoCreate:!1});b.on("dialogClosed",this.dialogClosed2,{scope:this,row:d,col:1,field:b});d=new Ext.Editor(b);d.valueTooltip=b.buildAssignmentTooltip(b,a);return d}});
Ext.form.OutputDataAssignmentField=Ext.extend(Ext.form.ComplexDataAssignmenField,{windowTitle:ORYX.I18N.PropertyWindow.Editor.ForOutputAssignments,assignTarget:"output",tbarConfigCallback:function(){return[{text:ORYX.I18N.PropertyWindow.Editor.MappingVariables,handler:function(){var a=this.varNamesMap;this.assignByName.call(this,a.dataOutputs,a.processVars)}.bind(this)}]}});
ORYX.Plugins.VardefExpressionEditor.OutputDataAssignmentEditorFactory=Clazz.extend({construct:function(){},init:function(a,b,c,d){ORYX.Log.debug("init OutputDataAssignmentEditor");b=new Ext.form.OutputDataAssignmentField({allowBlank:b.optional(),dataSource:this.dataSource,grid:this.grid,row:d,facade:this.facade,autoCreate:!1});b.on("dialogClosed",this.dialogClosed2,{scope:this,row:d,col:1,field:b});d=new Ext.Editor(b);d.valueTooltip=b.buildAssignmentTooltip(b,a);return d}});
